(function(){angular.module("nativeQDAApp",["ngRoute","ngSanitize","ui.bootstrap","ngTable"]);e.$inject=["$routeProvider","$locationProvider"];function e(e,a){e.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/complete-survey",{templateUrl:"/survey/completeSurvey/completeSurvey.view.html",controller:"CompleteSurveyCtrl",controllerAs:"vm"}).when("/analysis/map",{templateUrl:"/analysis/map/analysisMapDetail.view.html",controller:"mapCtrl",controllerAs:"vm"}).when("/analysis/data",{templateUrl:"/analysis/data/analysisDataDetail.view.html",controller:"analysisDataCtrl",controllerAs:"vm"}).when("/analysis/visualisation",{templateUrl:"/analysis/visualisation/analysisVisualisationDetail.view.html",controller:"analysisVisCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});a.html5Mode(true)}function a(e,a,n){e.$on("$routeChangeStart",function(e,t,o){if(t.$$route.templateUrl=="/survey/completeSurvey/completeSurvey.view.html"){a.path("/complete-survey")}else if(!n.isLoggedIn()){a.path("/login")}})}angular.module("nativeQDAApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",a])})();(function(){angular.module("nativeQDAApp").controller("homeCtrl",e);e.$inject=["$scope","nativeQDAData","geolocation","GoogleMapsInitialiser"];function e(e,a,n,t){var o=this;o.pageHeader={title:"Dashboard",strapline:"summary of recent activity"};var i=-34.406749;var r=150.878473;o.getData=function(e){i=e.coords.latitude;r=e.coords.longitude;l(i,r)};o.showError=function(a){e.$apply(function(){o.message=a.message;console.log(o.message);l(i,r)})};o.noGeo=function(){e.$apply(function(){o.message="Geolocation is not supported by this browser.";console.log(o.message);l(i,r)})};n.getPosition(o.getData,o.showError,o.noGeo);function l(e,a){t.mapsInitialised.then(function(){var n=new google.maps.LatLng(e,a);var t=document.getElementById("map-homepage");var o={center:n,zoom:4,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var i=new google.maps.Map(t,o);var r={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var l=[{position:new google.maps.LatLng(-34.195122,145.61361),type:"australia"},{position:new google.maps.LatLng(-27.782105,144.988068),type:"australia"},{position:new google.maps.LatLng(-31.617175,149.755251),type:"australia"},{position:new google.maps.LatLng(-34.183426,145.531326),type:"australia"},{position:new google.maps.LatLng(-23.004057,150.208288),type:"australia"},{position:new google.maps.LatLng(-23.36721,148.562199),type:"australia"},{position:new google.maps.LatLng(-27.149085,148.392517),type:"australia"},{position:new google.maps.LatLng(-27.171054,148.692928),type:"australia"},{position:new google.maps.LatLng(-21.676721,166.040641),type:"newCaledonia"},{position:new google.maps.LatLng(-21.198481,165.322936),type:"newCaledonia"},{position:new google.maps.LatLng(-20.650302,164.73978),type:"newCaledonia"},{position:new google.maps.LatLng(-20.51384,164.399452),type:"newCaledonia"},{position:new google.maps.LatLng(-20.765698,164.41047),type:"newCaledonia"},{position:new google.maps.LatLng(-20.625109,164.786398),type:"newCaledonia"},{position:new google.maps.LatLng(-22.259586,166.453261),type:"newCaledonia"},{position:new google.maps.LatLng(-40.768675,175.207908),type:"newZealand"},{position:new google.maps.LatLng(-41.114069,174.107308),type:"newZealand"},{position:new google.maps.LatLng(-41.101032,175.183516),type:"newZealand"},{position:new google.maps.LatLng(-40.145982,176.593862),type:"newZealand"},{position:new google.maps.LatLng(-39.454753,173.929295),type:"newZealand"},{position:new google.maps.LatLng(-39.060873,176.168224),type:"newZealand"},{position:new google.maps.LatLng(-43.974486,169.417745),type:"newZealand"},{position:new google.maps.LatLng(-45.77995,170.528945),type:"newZealand"}];var s=[];var p=[];var u=[];var c='<div class="info-window">'+"<h3>Data</h3>"+'<div class="info-content">'+"<p>Data collected from interview</p>"+'<a href="/files">Interview.doc</a>'+"</div>"+"</div>";var g=new google.maps.InfoWindow({content:c,maxWidth:400});l.forEach(function(e){var a=new google.maps.Marker({position:e.position,icon:r[e.type].icon});a.addListener("click",function(){g.open(i,a)});if(a.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){s.push(a)}else if(a.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){p.push(a)}else if(a.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){u.push(a)}});var m=new MarkerClusterer(i,s,{imagePath:"/images/map/icons/kangaroo-markers/m"});var d=new MarkerClusterer(i,p,{imagePath:"/images/map/icons/kiwi-markers/m"});var v=new MarkerClusterer(i,u,{imagePath:"/images/map/icons/kagu-markers/m"})})}}})();(function(){angular.module("nativeQDAApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About nativeQDA"};e.main={content:"nativeQDA Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim accumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. Vestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper tellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, accumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper.\n\nSuspendisse tincidunt, lectus non suscipit pharetra, purus ipsum vehicula sapien, a volutpat mauris ligula vel dui. Proin varius interdum elit, eu porttitor quam consequat et. Quisque vitae felis sed ante fringilla fermentum in vitae sem. Quisque fermentum metus at neque sagittis imperdiet. Phasellus non laoreet massa, eu laoreet nibh. Pellentesque vel magna vulputate, porta augue vel, dapibus nisl. Phasellus aliquet nibh nec nunc posuere fringilla. Quisque sit amet dignissim erat. Nulla facilisi. Donec in sollicitudin ante. Cras rhoncus accumsan rutrum. Sed aliquet ligula dui, eget laoreet turpis tempor vitae."}}})();(function(){angular.module("nativeQDAApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,a){var n=this;n.pageHeader={title:"Sign in to nativeQDA"};n.credentials={email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";a.login(n.credentials).then(function(a){e.search("page",null);e.path(n.returnPage)},function(e){n.formError=e.data.message})}}})();(function(){angular.module("nativeQDAApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,a){var n=this;n.pageHeader={title:"Create a new nativeQDA account"};n.credentials={name:"",email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";a.register(n.credentials).then(function(){e.search("page",null);e.path(n.returnPage)},function(e){n.formError=e})}}})();(function(){angular.module("nativeQDAApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","$uibModal","nativeQDAData","authentication"];function e(e,a,n,t,o){var i=this;i.locationid=e.locationid;i.isLoggedIn=o.isLoggedIn();i.currentPath=a.path();t.locationById(i.locationid).then(function(e){var a=e.data;i.data={location:a};i.pageHeader={title:i.data.location.name}},function(e){console.log(e)});i.popupReviewForm=function(){var e=n.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:i.locationid,locationName:i.data.location.name}}}});e.result.then(function(e){i.data.location.reviews.push(e)})}}})();(function(){angular.module("nativeQDAApp").controller("mapCtrl",e);e.$inject=["$scope","nativeQDAData","geolocation","GoogleMapsInitialiser"];function e(e,a,n,t){var o=this;var i=-34.406749;var r=150.878473;o.getData=function(e){i=e.coords.latitude;r=e.coords.longitude;l(i,r)};o.showError=function(a){e.$apply(function(){o.message=a.message;console.log(o.message);l(i,r)})};o.noGeo=function(){e.$apply(function(){o.message="Geolocation is not supported by this browser.";console.log(o.message);l(i,r)})};n.getPosition(o.getData,o.showError,o.noGeo);function l(e,a){t.mapsInitialised.then(function(){var n=new google.maps.LatLng(e,a);var t=document.getElementById("map");var o={center:n,zoom:5,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var i=new google.maps.Map(t,o);var r={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var l=[{position:new google.maps.LatLng(-34.195122,145.61361),type:"australia"},{position:new google.maps.LatLng(-27.782105,144.988068),type:"australia"},{position:new google.maps.LatLng(-31.617175,149.755251),type:"australia"},{position:new google.maps.LatLng(-34.183426,145.531326),type:"australia"},{position:new google.maps.LatLng(-23.004057,150.208288),type:"australia"},{position:new google.maps.LatLng(-23.36721,148.562199),type:"australia"},{position:new google.maps.LatLng(-27.149085,148.392517),type:"australia"},{position:new google.maps.LatLng(-27.171054,148.692928),type:"australia"},{position:new google.maps.LatLng(-21.676721,166.040641),type:"newCaledonia"},{position:new google.maps.LatLng(-21.198481,165.322936),type:"newCaledonia"},{position:new google.maps.LatLng(-20.650302,164.73978),type:"newCaledonia"},{position:new google.maps.LatLng(-20.51384,164.399452),type:"newCaledonia"},{position:new google.maps.LatLng(-20.765698,164.41047),type:"newCaledonia"},{position:new google.maps.LatLng(-20.625109,164.786398),type:"newCaledonia"},{position:new google.maps.LatLng(-22.259586,166.453261),type:"newCaledonia"},{position:new google.maps.LatLng(-40.768675,175.207908),type:"newZealand"},{position:new google.maps.LatLng(-41.114069,174.107308),type:"newZealand"},{position:new google.maps.LatLng(-41.101032,175.183516),type:"newZealand"},{position:new google.maps.LatLng(-40.145982,176.593862),type:"newZealand"},{position:new google.maps.LatLng(-39.454753,173.929295),type:"newZealand"},{position:new google.maps.LatLng(-39.060873,176.168224),type:"newZealand"},{position:new google.maps.LatLng(-43.974486,169.417745),type:"newZealand"},{position:new google.maps.LatLng(-45.77995,170.528945),type:"newZealand"}];var s=[];var p=[];var u=[];var c='<div class="info-window">'+"<h3>Data</h3>"+'<div class="info-content">'+"<p>Data collected from interview</p>"+'<a href="/files">Interview.doc</a>'+"</div>"+"</div>";var g=new google.maps.InfoWindow({content:c,maxWidth:400});l.forEach(function(e){var a=new google.maps.Marker({position:e.position,icon:r[e.type].icon});a.addListener("click",function(){g.open(i,a)});if(a.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){s.push(a)}else if(a.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){p.push(a)}else if(a.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){u.push(a)}});var m=new MarkerClusterer(i,s,{imagePath:"/images/map/icons/kangaroo-markers/m"});var d=new MarkerClusterer(i,p,{imagePath:"/images/map/icons/kiwi-markers/m"});var v=new MarkerClusterer(i,u,{imagePath:"/images/map/icons/kagu-markers/m"})})}}})();(function(){angular.module("nativeQDAApp").controller("analysisDataCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,a,n,t,o){var i=this;i.pageHeader={title:"Data",strapline:"where the Datasets live"};i.popupNewDatasetForm=function(){var e=o.open({templateUrl:"/newDatasetModal/newDatasetModal.view.html",controller:"newDatasetModalCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{dataset:"English vs French",createdBy:"Anu",description:"Interviews from French speakers in New Caledonia",dateCreated:"2011/04/25",command:"id1"},{dataset:"Inheritance of Bunuban",createdBy:"Anu",description:"Bunuban inheritance study",dateCreated:"2009/01/12",command:"id2"},{dataset:"Qualitative study of the Moriori",createdBy:"Michael",description:"Moriori language evolution",dateCreated:"2012/03/29",command:"id3"},{dataset:"Kanaks - Drehu",createdBy:"Michael",description:"Drehu",dateCreated:"2008/11/28",command:"id4"},{dataset:"Kanaks French dialect",createdBy:"Holly",description:"French",dateCreated:"2012/12/02",command:"id29"},{dataset:"Decline of the Bunuban family",createdBy:"Anu",description:"Bunuban Family study",dateCreated:"2011/07/25",command:"id30"}];i.tableParams=new n({},{dataset:r});e.confirmDelete=function(){a.confirm("Are ya sure?")}}})();(function(){angular.module("nativeQDAApp").controller("analysisVisCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce"];function e(e,a,n,t){var o=this;o.pageHeader={title:"Visualisation",strapline:"visualise data sets here"};var i=[{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id1"},{visual:"Word Cloud",visualThumb:"word-cloud-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/01/12",command:"id2"},{visual:"Chord Diagram",visualThumb:"chord-diagram-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/03/29",command:"id3"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/09/15",command:"id4"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id5"},{visual:"Word Frequency Chart",visualThumb:"bar-chart-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/01/12",command:"id6"},{visual:"Word Tree",visualThumb:"word-tree-thumb.png",dataSet:"Qualitative study of the Moriori language",createdBy:"Michael",dateCreated:"2017/03/29",command:"id7"}];o.tableParams=new n({},{dataset:i});e.confirmDelete=function(){a.confirm("Are ya sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newDatasetModalCtrl",e);e.$inject=["$uibModalInstance","nativeQDAData"];function e(e,a){var n=this;n.onSubmit=function(){n.formError="";if(angular.isDefined(n.formData)){if(!n.formData.datasetName||!n.formData.description){n.formError="All fields required, please try again";return false}else{console.log("Create Dataset!")}}else{n.formError="All fields required, please try again";return false}};n.modal={close:function(a){e.close(a)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("CompleteSurveyCtrl",e);function e(){var e=this;e.surveyCode="";e.onSubmit=function(){e.formError="";if(!e.surveyCode){e.formError="All fields required, please try again";return false}else{console.log("Find survey and display to user!")}}}})();(function(){angular.module("nativeQDAApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,a){var n=function(e){a.localStorage["nativeQDA-token"]=e};var t=function(){return a.localStorage["nativeQDA-token"]};var o=function(){var e=t();if(e){var n=JSON.parse(a.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var i=function(){if(o()){var e=t();var n=JSON.parse(a.atob(e.split(".")[1]));return{email:n.email,name:n.name}}};register=function(a){return e.post("/api/register",a).then(function(e){n(e.data.token)})};login=function(a){return e.post("/api/login",a).then(function(e){n(e.data.token)})};logout=function(){a.localStorage.removeItem("nativeQDA-token")};return{currentUser:i,saveToken:n,getToken:t,isLoggedIn:o,register:register,login:login,logout:logout}}})();(function(){angular.module("nativeQDAApp").service("geolocation",e);function e(){var e=function(e,a,n){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,a)}else{n()}};return{getPosition:e}}})();(function(){angular.module("nativeQDAApp").service("nativeQDAData",e);e.$inject=["$http","authentication"];function e(e,a){var n=function(n,t){return e.get("/api/locations?lng="+t+"&lat="+n+"&maxDistance=200000",{headers:{Authorization:"Bearer "+a.getToken()}})};var t=function(n){return e.get("/api/locations/"+n,{headers:{Authorization:"Bearer "+a.getToken()}})};var o=function(n,t){return e.post("/api/locations/"+n+"/reviews",t,{headers:{Authorization:"Bearer "+a.getToken()}})};return{locationByCoords:n,locationById:t,addReviewById:o}}})();(function(){angular.module("nativeQDAApp").service("GoogleMapsInitialiser",e);e.$inject=["$window","$q"];function e(e,a){var n="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEMpLtx0n2Pk4ggQonEyD0iPZbGHYhR5o&callback=",t=a.defer();e.googleMapsInitialised=t.resolve;var o=function(e,a){var n=document.createElement("script");n.src=e+a;document.body.appendChild(n)};o(n,"googleMapsInitialised");return{mapsInitialised:t.promise}}})();(function(){angular.module("nativeQDAApp").filter("formatDistance",a);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function a(){return function(a){var n=a/1e3;var t;if(a&&e(a)){if(n>1){n=parseFloat(n).toFixed(1);t=" km"}else{n=parseInt(n*1e3,10);t=" m"}return n+t}else{return"?"}}}})();(function(){angular.module("nativeQDAApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var a=e.replace(/\n/g,"<br/>");return a}}})();(function(){angular.module("nativeQDAApp").directive("initBind",e);e.$inject=["$compile"];function e(e){return{restrict:"A",link:function(a,n,t){t.$observe("ngBindHtml",function(){if(t.ngBindHtml){e(n[0].children)(a)}})}}}})();(function(){angular.module("nativeQDAApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,a){var n=this;n.currentPath=e.path();n.isLoggedIn=a.isLoggedIn();n.currentUser=a.currentUser();n.logout=function(){a.logout();e.path("/$logged-out")}}})();(function(){angular.module("nativeQDAApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("nativeQDAApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("nativeQDAApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("nativeQDAApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();