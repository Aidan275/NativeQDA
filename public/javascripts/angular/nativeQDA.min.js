(function(){angular.module("nativeQDAApp",["ngRoute","ngSanitize","ngTable","ui.bootstrap","ui.bootstrap.datepicker","rzModule","ngFileUpload","ngTagsInput","jp.ng-bs-animated-button"]);e.$inject=["$routeProvider","$locationProvider"];function e(e,t){e.when("/login",{templateUrl:"/pages/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm",loginRequired:false}).when("/register",{templateUrl:"/pages/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm",loginRequired:true}).when("/forgot-password",{templateUrl:"/pages/auth/forgotPass/forgotPass.view.html",controller:"forgotPassCtrl",controllerAs:"vm",loginRequired:false}).when("/",{templateUrl:"/pages/home/home.view.html",controller:"homeCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/map",{templateUrl:"/pages/analysis/map/map.view.html",controller:"mapCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/data",{templateUrl:"/pages/analysis/data/data.view.html",controller:"dataCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/visualisation",{templateUrl:"/pages/analysis/visualisation/visualisation.view.html",controller:"visualisationCtrl",controllerAs:"vm",loginRequired:true}).when("/survey",{templateUrl:"/pages/survey/survey.view.html",controller:"surveyCtrl",controllerAs:"vm",loginRequired:true}).when("/files",{templateUrl:"/pages/files/files.view.html",controller:"filesCtrl",controllerAs:"vm",loginRequired:true}).when("/settings",{templateUrl:"/pages/settings/settings.view.html",controller:"settingsCtrl",controllerAs:"vm",loginRequired:true}).when("/complete-survey",{templateUrl:"/pages/survey/completeSurvey/completeSurvey.view.html",controller:"CompleteSurveyCtrl",controllerAs:"vm",loginRequired:false}).when("/heatmap-example",{templateUrl:"/pages/heatmapExample/heatmapExample.view.html",controller:"heatmapCtrl",controllerAs:"vm",loginRequired:true}).otherwise({redirectTo:"/"});t.html5Mode(true)}function t(e,t,a){e.$on("$routeChangeStart",function(e,n,o){var i;if(n.loginRequired&&!a.isLoggedIn()){i=t.path();t.path("/login").replace();t.search("page",i)}else if(n.loginRequired&&a.isLoggedIn()){t.path(i).replace();i=null}})}angular.module("nativeQDAApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",t])})();(function(){"use strict";angular.module("nativeQDAApp").config(e);e.$inject=["$qProvider","$logProvider"];function e(e,t){e.errorOnUnhandledRejections(true);toastr.options.closeButton=true;toastr.options.timeOut=3e3;toastr.options.positionClass="toast-top-right";if(t.debugEnabled){t.debugEnabled(true)}}})();(function(){"use strict";angular.module("nativeQDAApp").controller("homeCtrl",e);e.$inject=["mapService","filesService","$scope","$filter","$compile","$window","$uibModal","logger"];function e(e,t,a,n,o,i,r,l){var s=this;var c=-34.4054039;var u=150.87842999999998;var g=null;var p=null;var m=[];var d=[];var f=[];var h=null;var v=null;var w=null;s.getFileList=A;s.viewFile=M;s.popupFileDetails=S;s.confirmDelete=x;s.pageHeader={title:"Dashboard",strapline:"summary of recent activity"};y();function y(){L(c,u)}function L(t,a){var n=new google.maps.LatLng(t,a);var o=document.getElementById("map-homepage");var i={center:n,zoom:4,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};p=new google.maps.Map(o,i);e.getPosition(D);A()}function D(e){c=e.coords.latitude;u=e.coords.longitude;k()}function k(){var e=new google.maps.LatLng(c,u);var t=new google.maps.Marker({position:e,map:p,title:"Your Position"});p.setZoom(13);p.panTo(e)}function A(){t.getFileListDB().then(function(e){g=e.data;b();C()})}function b(){for(var e=0;e<m.length;e++){m[e].setMap(null)}for(var e=0;e<d.length;e++){d[e].setMap(null)}for(var e=0;e<f.length;e++){f[e].setMap(null)}m=[];d=[];f=[];if(h)h.clearMarkers();if(v)v.clearMarkers();if(w)w.clearMarkers()}function C(){var e={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var t=new google.maps.InfoWindow;g.forEach(function(i){var r=new google.maps.Marker({position:new google.maps.LatLng(i.coords.lat,i.coords.lng),icon:e["australia"].icon,title:i.name});var l='<div class="info-window">'+"<h3>"+i.name+"</h3>"+"<p>Created By: "+i.createdBy+"</p>"+"<p>Size: "+n("formatFileSize")(i.size,2)+"</p>"+"<p>Last Modified: "+n("date")(i.lastModified,"dd MMMM, yyyy h:mm a")+"</p>";if(i.tags.length!=0){l+="<p>Tags: </p>"+"<ul>";i.tags.forEach(function(e){l+="<li>"+e+"</li>"});l+="</ul>"}l+="<a ng-click=\"vm.viewFile('"+i.key+'\')" class="btn btn-success" role="button">View</a> '+"<a ng-click=\"vm.popupFileDetails('"+i.key+'\')" class="btn btn-primary" role="button">Details</a> '+"<a ng-click=\"vm.confirmDelete('"+i.key+"', '"+i.name+'\')" class="btn btn-danger" role="button">Delete</a>'+"</div>";var s=o(l)(a);r.addListener("click",function(){t.setContent(s[0]);t.open(p,r)});if(r.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){m.push(r)}else if(r.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){d.push(r)}else if(r.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){f.push(r)}});h=new MarkerClusterer(p,m,{imagePath:"/images/map/icons/kangaroo-markers/m"});v=new MarkerClusterer(p,d,{imagePath:"/images/map/icons/kiwi-markers/m"});w=new MarkerClusterer(p,f,{imagePath:"/images/map/icons/kagu-markers/m"})}function M(e){t.signDownloadS3(e).then(function(e){i.open(e.data,"_blank")})}function S(e){var t=r.open({templateUrl:"/pages/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}});t.result.then(function(){})}function x(e,t){var a=i.confirm("Are you sure you want to delete "+t+"?");if(a){T(e,t)}}function T(e,a){t.deleteFileDB(e).then(function(t){F(e,a)})}function F(e,a){t.deleteFileS3({key:e}).then(function(e){l.success("File "+a+" deleted successfully","","Success");A()})}}})();(function(){angular.module("nativeQDAApp").controller("loginCtrl",e);e.$inject=["$location","authentication","events","logger"];function e(e,t,a,n){var o=this;o.onSubmit=i;o.login=r;o.credentials={email:"",password:""};o.pageHeader={title:"Sign in to nativeQDA"};o.returnPage=e.search().page||"/";function i(){if(!o.credentials.email||!o.credentials.password){n.error("All fields required, please try again","Error","Error");return false}else{r()}}function r(){a.event({email:o.credentials.email,desc:"Login"});t.login(o.credentials).then(function(t){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("nativeQDAApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var a=this;a.pageHeader={title:"Create a new nativeQDA account"};a.credentials={name:"",email:"",password:""};a.returnPage=e.search().page||"/";a.onSubmit=function(){a.formError="";if(!a.credentials.name||!a.credentials.email||!a.credentials.password){a.formError="All fields required, please try again";return false}else{a.doRegister()}};a.doRegister=function(){a.formError="";t.register(a.credentials).then(function(){e.search("page",null);e.path(a.returnPage)},function(e){a.formError=e})}}})();(function(){angular.module("nativeQDAApp").controller("forgotPassCtrl",e);e.$inject=["authentication"];function e(e){var t=this;t.pageHeader={title:"Forgot Password"};t.credentials={email:""};t.onSubmit=function(){t.formError="";if(!t.credentials.email){t.formError="All fields required, please try again";return false}else{console.log("Send email to "+t.credentials.email+" to reset password!")}}}})();(function(){angular.module("nativeQDAApp").controller("mapCtrl",e);e.$inject=["mapService","filesService","$scope","$filter","$compile","$window","$uibModal","logger"];function e(e,t,a,n,o,i,r,l){var s=this;var c=null;var u;s.currentMarker=null;s.getFileList=y;s.viewFile=k;s.popupFileDetails=A;s.confirmDelete=b;var g=L.Icon.extend({options:{shadowUrl:"/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}});var p=new g({iconUrl:"/markers/marker-icon.png"});var m=new g({iconUrl:"/markers/marker-icon-pos.png"});d();function d(){f()}function f(e){mapOptions={center:[-34.4054039,150.87842999999998],zoom:4};c=L.map("map",mapOptions);var t=22;var a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var l=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t}).addTo(c);var s=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var g=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var p=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var m=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var f=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:t});var v=L.gridLayer.googleMutant({maxZoom:t,type:"roadmap"});var w=L.gridLayer.googleMutant({maxZoom:t,type:"satellite"});var D=L.gridLayer.googleMutant({maxZoom:t,type:"terrain"});var k=L.gridLayer.googleMutant({maxZoom:t,type:"hybrid"});var A=L.gridLayer.googleMutant({maxZoom:t,type:"roadmap"});A.addGoogleLayer("TrafficLayer");L.control.layers({"Mapbox Light":a,"Mapbox Dark":n,"Mapbox Satellite":o,"Mapbox Streets Satellite":i,"Mapbox Wheatpaste":r,"Mapbox Streets Basic":l,"Mapbox Outdoors":u,"Mapbox Run Bike Hike":g,"Mapbox Pencil":p,"Mapbox Pirates":m,"Mapbox Emerald":d,"Mapbox High Contrast":f,"Google Roadmap":v,"Google Aerial":w,"Google Terrain":D,"Google Hybrid":k,"Google Traffic":A},{},{collapsed:true}).addTo(c);h();y()}function h(e){c.on("locationfound",v);c.on("locationerror",w);c.locate({setView:true,maxZoom:15})}function v(e){var t=e.accuracy/2;var a=e.latlng;var n=L.marker(a,{icon:m,title:"Your Position"}).addTo(c).bindPopup("You are within "+t+" meters from this point");var o=L.circle(a,{radius:t,color:"#cb2529"});n.on("popupopen",function(){o.addTo(c);c.setView(a,18)});n.on("popupclose",function(){c.removeLayer(o)});l.success("User's location found",e,"Success")}function w(e){l.error(e.message,e,"Error")}function y(){t.getFileListDB().then(function(e){var t=e.data;D(t)})}function D(e){u=L.markerClusterGroup({showCoverageOnHover:false});e.forEach(function(e){var t=L.marker([e.coords.lat,e.coords.lng],{icon:p,title:e.name});var i='<div class="info-window">'+"<h3>"+e.name+"</h3>"+"<p>Created By: "+e.createdBy+"</p>"+"<p>Size: "+n("formatFileSize")(e.size,2)+"</p>"+"<p>Last Modified: "+n("date")(e.lastModified,"dd MMMM, yyyy h:mm a")+"</p>";if(e.tags.length!=0){i+="<p>Tags: </p>"+"<ul>";e.tags.forEach(function(e){i+="<li>"+e+"</li>"});i+="</ul>"}i+="<a ng-click=\"vm.viewFile('"+e.key+'\')" class="btn btn-success" role="button">View</a> '+"<a ng-click=\"vm.popupFileDetails('"+e.key+'\')" class="btn btn-primary" role="button">Details</a> '+"<a ng-click=\"vm.confirmDelete('"+e.key+"', '"+e.name+'\')" class="btn btn-danger" role="button">Delete</a>'+"</div>";var r=o(i)(a);t.bindPopup(r[0]);t.on("popupopen",function(){s.currentMarker=this});u.addLayer(t)});c.addLayer(u)}function k(e){t.signDownloadS3(e).then(function(e){i.open(e.data,"_blank")})}function A(e){var t=r.open({templateUrl:"/pages/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}});t.result.then(function(){})}function b(e,t){var a=i.confirm("Are you sure you want to delete "+t+"?");if(a){C(e,t)}}function C(e,a){t.deleteFileDB(e).then(function(t){M(e,a)})}function M(e,a){t.deleteFileS3({key:e}).then(function(e){l.success("File "+a+" deleted successfully","","Success");S()})}function S(){u.removeLayer(s.currentMarker)}}})();(function(){angular.module("nativeQDAApp").controller("dataCtrl",e);e.$inject=["$window","$sce","$uibModal","NgTableParams","datasets"];function e(e,t,a,n,o){var i=this;var r;i.pageHeader={title:"Data",strapline:"where the Datasets live"};i.popupViewDatasetForm=function(e){var t=a.open({templateUrl:"/pages/analysis/data/viewDataset/viewDataset.view.html",controller:"viewDatasetCtrl as vm",size:"lg",resolve:{datasetid:function(){return e}}});t.result.then(function(){})};i.popupEditDatasetForm=function(e,t){var n=a.open({templateUrl:"/pages/analysis/data/editDataset/editDataset.view.html",controller:"editDatasetCtrl as vm",size:"xl"});n.result.then(function(){i.getDatasetList()})};i.popupNewDatasetForm=function(){var e=a.open({templateUrl:"/pages/analysis/data/newDataset/newDataset.view.html",controller:"newDatasetCtrl as vm",size:"xl"});e.result.then(function(){i.getDatasetList()})};i.doListDatasets=function(e){r=e;i.tableParams=new n({sorting:{dateCreated:"desc"}},{dataset:r})};i.getDatasetList=function(){o.listDatasets().then(function(e){i.doListDatasets(e.data)},function(e){console.log(e)});return false};i.getDatasetList();i.doDeleteDataset=function(e){o.datasetDeleteOne(e).then(function(e){i.getDatasetList()},function(e){console.log(e)});return false};i.confirmDelete=function(t,a){deleteDataset=e.confirm("Are you sure you want to delete "+t+"?");if(deleteDataset){i.doDeleteDataset(a)}}}})();(function(){angular.module("nativeQDAApp").controller("newDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets"];function e(e,t){var a=this;a.onSubmit=function(){a.formError="";if(angular.isDefined(a.formData)){if(!a.formData.datasetName||!a.formData.description){a.formError="All fields required, please try again";return false}else{a.doCreateDataset(a.formData)}}else{a.formError="All fields required, please try again";return false}};a.doCreateDataset=function(e){t.datasetCreate({name:a.formData.datasetName,desc:a.formData.description}).then(function(e){a.modal.close(e.data)},function(e){a.formError="The Dataset was not saved, please try again"});return false};a.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("viewDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets","datasetid"];function e(e,t,a){var n=this;n.datasetid=a;t.datasetReadOne(n.datasetid).then(function(e){n.data=e.data},function(e){console.log(e)});n.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("editDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets"];function e(e,t){var a=this;a.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("visualisationCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,t,a,n,o){var i=this;i.pageHeader={title:"Visualisation",strapline:"visualise datasets here"};i.popupVisualisationForm=function(){var e=o.open({templateUrl:"/pages/analysis/visualisation/newVisualisation/newVisualisation.view.html",controller:"newVisualisationCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id1"},{visual:"Word Cloud",visualThumb:"word-cloud-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/01/12",command:"id2"},{visual:"Chord Diagram",visualThumb:"chord-diagram-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/03/29",command:"id3"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/09/15",command:"id4"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id5"},{visual:"Word Frequency Chart",visualThumb:"bar-chart-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/01/12",command:"id6"},{visual:"Word Tree",visualThumb:"word-tree-thumb.png",dataSet:"Qualitative study of the Moriori language",createdBy:"Michael",dateCreated:"2017/03/29",command:"id7"}];i.tableParams=new a({},{dataset:r});e.confirmDelete=function(){t.confirm("Are you sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newVisualisationCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.onSubmit=function(){t.formError="";if(angular.isDefined(t.formData)){if(!t.formData.visualisationName){t.formError="All fields required, please try again";return false}else{console.log("Create Visualisation!")}}else{t.formError="All fields required, please try again";return false}};t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("CompleteSurveyCtrl",e);function e(){var e=this;e.surveyCode="";e.onSubmit=function(){e.formError="";if(!e.surveyCode){e.formError="All fields required, please try again";return false}else{console.log("Find survey and display to user!")}}}})();(function(){angular.module("nativeQDAApp").controller("surveyCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,t,a,n,o){var i=this;i.pageHeader={title:"Surveys",strapline:"for the masses"};i.popupNewSurveyForm=function(){var e=o.open({templateUrl:"/pages/survey/newSurvey/newSurvey.view.html",controller:"newSurveyCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{survey:"Survey",createdBy:"Anu",responses:12,dateCreated:"2017/05/26",command:"id1"},{survey:"Survey2",createdBy:"Michael",responses:50,dateCreated:"2017/05/02",command:"id1"},{survey:"Survey3",createdBy:"Michael",responses:23,dateCreated:"2017/02/12",command:"id1"},{survey:"Survey4",createdBy:"Anu",responses:50,dateCreated:"2017/02/15",command:"id1"},{survey:"Survey5",createdBy:"Holly",responses:11,dateCreated:"2017/04/02",command:"id1"},{survey:"Survey6",createdBy:"Anu",responses:1,dateCreated:"2017/01/11",command:"id1"},{survey:"Survey7",createdBy:"Michael",responses:100,dateCreated:"2017/01/23",command:"id1"}];i.tableParams=new a({},{dataset:r});e.confirmDelete=function(){t.confirm("Are ya sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newSurveyCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.onSubmit=function(){t.formError="";if(angular.isDefined(t.formData)){if(!t.formData.surveyName){t.formError="All fields required, please try again";return false}else{console.log("Create Survey!")}}else{t.formError="All fields required, please try again";return false}};t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("heatmapCtrl",e);e.$inject=["$scope","geolocation","GoogleMapsInitialiser","authentication","events"];function e(e,t,a,n,o){var i=this;var r=-33.848192;var l=151.061857;var s=10;o.event({email:n.currentUser().email});i.bothOver=true;i.fatherOver=true;i.MotherOver=true;i.bothAus=true;c(r,l);function c(e,t){a.mapsInitialised.then(function(){var a=new google.maps.LatLng(e,t);var n=document.getElementById("map");var o={center:a,zoom:s,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var r=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:9029},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:358},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:3235},{location:new google.maps.LatLng(-33.76288,150.99212),weight:7427},{location:new google.maps.LatLng(-33.771,150.9063),weight:21538},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:4163},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:8865},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:1618},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:5627},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:3383},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:27386},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:11435},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:1552},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:979},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}];var l=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:187},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:18},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:64},{location:new google.maps.LatLng(-33.76288,150.99212),weight:141},{location:new google.maps.LatLng(-33.771,150.9063),weight:224},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:130},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:202},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:96},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:132},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:165},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:179},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:123},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:107},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:128},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}];var c=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:129},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:15},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:53},{location:new google.maps.LatLng(-33.76288,150.99212),weight:127},{location:new google.maps.LatLng(-33.771,150.9063),weight:151},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:106},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:173},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:60},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:83},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:98},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:145},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:98},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:59},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:95},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}];var u=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:68},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:13},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:45},{location:new google.maps.LatLng(-33.76288,150.99212),weight:66},{location:new google.maps.LatLng(-33.771,150.9063),weight:99},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:62},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:116},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:65},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:69},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:96},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:84},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:43},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:47},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:106},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110}];var g=new google.maps.Map(n,o);var p=new google.maps.visualization.HeatmapLayer;var m=null;i.radiusSlider={value:100,options:{floor:0,ceil:200,onChange:function(){p.set("radius",i.radiusSlider.value)}}};i.opacitySlider={value:.6,options:{floor:0,ceil:1,step:.01,precision:10,onChange:function(){p.set("opacity",i.opacitySlider.value)}}};i.updateMap=function(){if(p){p.setMap(null)}var e=[];if(i.bothOver){Array.prototype.push.apply(e,r)}if(i.fatherOver){Array.prototype.push.apply(e,l)}if(i.MotherOver){Array.prototype.push.apply(e,c)}if(i.bothAus){Array.prototype.push.apply(e,u)}p.setData(e);p.setOptions({radius:i.radiusSlider.value,opacity:i.opacitySlider.value,gradient:m});p.setMap(g)};i.removeGrtSyd=function(){if(i.rmGrtSyd){r.pop();l.pop();c.pop();u.pop()}else{r.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088});l.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219});c.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681});u.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110})}i.updateMap()};i.changeGradient=function(){if(i.changeGrad){m=["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]}else{m=null}i.updateMap()};i.updateMap()})}}})();(function(){"use strict";angular.module("nativeQDAApp").controller("filesCtrl",e);e.$inject=["mapService","$http","$window","$scope","$uibModal","Upload","NgTableParams","filesService","authentication","logger"];function e(e,t,a,n,o,i,r,l,s,c){var u=this;var g=null;var p=null;var m=null;u.lat=-34.4054039;u.lng=150.87842999999998;u.tags=[];u.address="";u.formattedAddress="";u.currentPercentage="0";u.popupFileDetails=k;u.getFileListS3=S;u.confirmDelete=A;u.onFileSelect=M;u.geocodeAddress=w;u.viewFile=D;d();function d(){f();y()}function f(){var t=new google.maps.LatLng(u.lat,u.lng);var a=document.getElementById("map-files-page");var o={center:t,zoom:4,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};g=new google.maps.Map(a,o);p=new google.maps.Marker({draggable:true,position:t,map:g,title:"Latitude: "+u.lat+"\nLongitude: "+u.lng});google.maps.event.addListener(p,"dragend",function(e){u.lat=e.latLng.lat();u.lng=e.latLng.lng();p.setTitle("Latitude: "+u.lat+"\nLongitude: "+u.lng);n.$apply()});google.maps.event.addListener(g,"click",function(e){u.lat=e.latLng.lat();u.lng=e.latLng.lng();p.setPosition(e.latLng);p.setTitle("Latitude: "+u.lat+"\nLongitude: "+u.lng);n.$apply()});e.getPosition(h)}function h(e){u.lat=e.coords.latitude;u.lng=e.coords.longitude;v()}function v(){var e=new google.maps.LatLng(u.lat,u.lng);p.setPosition(e);p.setTitle("Latitude: "+u.lat+"\nLongitude: "+u.lng);g.setZoom(13);g.panTo(e);n.$apply()}function w(){var e=new google.maps.Geocoder;e.geocode({address:u.address},function(e,t){if(t==="OK"){u.lat=e[0].geometry.location.lat();u.lng=e[0].geometry.location.lng();u.formattedAddress=e[0].formatted_address;p.setPosition(e[0].geometry.location);p.setTitle("Latitude: "+u.lat+"\nLongitude: "+u.lng);g.panTo(new google.maps.LatLng(u.lat,u.lng));n.$apply()}else if(t==="ZERO_RESULTS"){toastr.warning("Warning: Address not found","Warning",{positionClass:"toast-top-center"})}else{toastr.error("Geocode failed: "+t,"Error",{positionClass:"toast-top-center"})}})}function y(){l.getFileListDB().then(function(e){m=e.data;L()})}function L(){u.tableParams=new r({sorting:{LastModified:"desc"}},{dataset:m})}function D(e){l.signDownloadS3(e).then(function(e){a.open(e.data,"_blank")})}function k(e){var t=o.open({templateUrl:"/pages/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}});t.result.then(function(){})}function A(e,t){var n=a.confirm("Are you sure you want to delete "+t+"?");if(n){b(e,t)}}function b(e,t){l.deleteFileDB(e).then(function(a){C(e,t)})}function C(e,t){l.deleteFileS3({key:e}).then(function(e){c.success("File "+t+" deleted successfully","","Success");y()})}function M(e){if(e.length>0){var t=e[0].name;var a=e[0].type;var n={filename:t,type:a};l.signUploadS3(n).then(function(a){i.upload({method:"POST",url:a.data.url,fields:a.data.fields,file:e[0]}).progress(function(e){u.currentPercentage=parseInt(100*e.loaded/e.total)}).then(function(e){console.log(e.config.file.name+" successfully uploaded to S3");var n=$.parseXML(e.data);var o=u.tags.map(function(e){return e["text"]});var i=a.data.fields.key;var r=a.data.url+"/"+i;var g={name:t,key:i,size:e.config.file.size,url:r,createdBy:s.currentUser().name,lat:u.lat,lng:u.lng,tags:o};l.addFileDB(g).then(function(e){console.log(t+" successfully added to DB");c.success(t+" successfully uploaded","","Success");y()})},function(e){var t=$.parseXML(e.data);c.error($(t).find("Message").text(),"","Error")})})}}function S(){l.getFileListS3().then(function(e){doListFilesS3(e.data.Contents)},function(e){console.log(e)})}}})();(function(){angular.module("nativeQDAApp").controller("fileDetails",e);e.$inject=["$uibModalInstance","$window","key","filesService"];function e(e,t,a,n){var o=this;o.isSubmittingButton=null;o.resultButton=null;o.makePublicOptions={
buttonDefaultText:"Make Public"};o.makePrivateOptions={buttonDefaultText:"Make Private"};o.updateAclS3=r;i();function i(){n.fileReadOneDB(a).then(function(e){o.file=e.data})}function r(e,t){o.isSubmittingButton=true;n.objectAclS3({key:e,acl:t}).then(function(a){l(e,t)},function(e){o.resAclBtn="error"})}function l(e,t){n.objectAclDB({key:e,acl:t}).then(function(e){o.resultButton="success";o.file.acl=t},function(e){o.resultButton="error"})}o.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("settingsCtrl",e);function e(){var e=this;e.pageHeader={title:"Settings",strapline:"change how things work"}}})();(function(){"use strict";angular.module("nativeQDAApp").service("exception",e);e.$inject=["$q","logger"];function e(e,t){return{catcher:a};function a(a){return function(n){var o;var i;if(a)a+="\n";if(n.data&&n.data.description){i=a+n.data.description;n.data.description=i}else if(n.data&&n.data.message){i=a+n.data.message;n.data.message=i}t.error(i,n,"Error");return e.reject(n)}}}})();(function(){"use strict";angular.module("nativeQDAApp").service("logger",e);e.$inject=["$log"];function e(e){return{showToasts:true,error:t,info:a,success:n,warning:o,log:e.log};function t(t,a,n){toastr.error(t,n);e.error("Error: "+t,a)}function a(t,a,n){toastr.info(t,n);e.info("Info: "+t,a)}function n(t,a,n){toastr.success(t,n);e.info("Success: "+t,a)}function o(t,a,n){toastr.warning(t,n);e.warn("Warning: "+t,a)}}})();(function(){"use strict";angular.module("nativeQDAApp").service("filesService",e);e.$inject=["$http","authentication","exception"];function e(e,t,a){return{signUploadS3:n,addFileDB:o,signDownloadS3:i,getFileListS3:l,getFileListDB:s,deleteFileS3:c,deleteFileDB:u,fileReadOneDB:r,objectAclS3:g,objectAclDB:p,syncDBwithS3:m};function n(n){return e.post("/api/files/signUploadS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for signUploadS3")(e)}}function o(n){return e.post("/api/files/addFileDB",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for addFileDB")(e)}}function i(n){return e.get("/api/files/signDownloadS3?key="+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for signDownloadS3")(e)}}function r(n){return e.get("/api/files/fileReadOneDB?key="+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for fileReadOneDB")(e)}}function l(){return e.get("/api/files/getFileListS3",{headers:{Authorization:"Bearer "+t.getToken()}}).then(n).catch(o);function n(e){return e}function o(e){return a.catcher("XHR Failed for getFileListS3")(e)}}function s(){return e.get("/api/files/getFileListDB",{headers:{Authorization:"Bearer "+t.getToken()}}).then(n).catch(o);function n(e){return e}function o(e){return a.catcher("XHR Failed for getFileListDB")(e)}}function c(n){return e.post("/api/files/deleteFileS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for deleteFileS3")(e)}}function u(n){return e.delete("/api/files/deleteFileDB?key="+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for deleteFileDB")(e)}}function g(n){return e.post("/api/files/objectAclS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for objectAclS3")(e)}}function p(n){return e.post("/api/files/objectAclDB",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for objectAclDB")(e)}}function m(n){return e.post("/api/files/syncDBwithS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for syncDBwithS3")(e)}}}})();(function(){angular.module("nativeQDAApp").service("datasets",e);e.$inject=["$http","authentication","exception"];function e(e,t,a){return{datasetCreate:n,listDatasets:o,datasetReadOne:i,datasetDeleteOne:r};function n(n){return e.post("/api/analysis/data/create",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for datasetCreate")(e)}}function o(){return e.get("/api/analysis/data/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(n).catch(o);function n(e){return e}function o(e){return a.catcher("XHR Failed for listDatasets")(e)}}function i(n){return e.get("/api/analysis/data/read/"+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for datasetReadOne")(e)}}function r(n){return e.delete("/api/analysis/data/delete/"+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return a.catcher("XHR Failed for datasetDeleteOne")(e)}}}})();(function(){angular.module("nativeQDAApp").service("authentication",e);e.$inject=["$http","$window","exception"];function e(e,t,a){return{currentUser:r,saveToken:n,getToken:o,isLoggedIn:i,register:l,login:s,logout:c};function n(e){t.localStorage["nativeQDA-token"]=e}function o(){return t.localStorage["nativeQDA-token"]}function i(){var e=o();if(e){var a=JSON.parse(t.atob(e.split(".")[1]));return a.exp>Date.now()/1e3}else{return false}}function r(){if(i()){var e=o();var a=JSON.parse(t.atob(e.split(".")[1]));return{email:a.email,name:a.name}}}function l(t){return e.post("/api/register",t).then(function(e){n(e.data.token)})}function s(t){return e.post("/api/login",t).then(o).catch(i);function o(e){n(e.data.token)}function i(e){return a.catcher("Login Failed")(e)}}function c(a){t.localStorage.removeItem("nativeQDA-token");return e.post("/api/event",a)}}})();(function(){angular.module("nativeQDAApp").service("events",e);e.$inject=["$http"];function e(e){return{event:t};function t(t){return e.post("/api/event",t)}}})();(function(){"use strict";angular.module("nativeQDAApp").service("mapService",e);e.$inject=["logger"];function e(e){return{getPosition:t};function t(t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(t,a)}else{n()}function a(t){if(t.code==1)e.warning(t.message,t,"Warning");else e.error(t.message,t,"Error")}function n(){e.error("Geolocation is not supported by this browser","Error","Error")}}}})();(function(){angular.module("nativeQDAApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var a=t/1e3;var n;if(t&&e(t)){if(a>1){a=parseFloat(a).toFixed(1);n=" km"}else{a=parseInt(a*1e3,10);n=" m"}return a+n}else{return"?"}}}})();(function(){angular.module("nativeQDAApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("nativeQDAApp").filter("formatFileSize",e);function e(){return function(e,t){if(e===0||isNaN(parseFloat(e))||!isFinite(e)){return"-"}if(typeof t==="undefined"){t=1}var a=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+a[n]}}})();(function(){angular.module("nativeQDAApp").controller("navigationCtrl",e);e.$inject=["$location","authentication","events"];function e(e,t,a){var n=this;a.event({email:t.currentUser().email});n.currentPath=e.path();n.isLoggedIn=t.isLoggedIn();n.currentUser=t.currentUser();n.logout=function(){t.logout({email:t.currentUser().email,desc:"Logout"});e.path("/login")}}})();(function(){angular.module("nativeQDAApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("nativeQDAApp").directive("dynamicCompile",e);e.$inject=["$compile"];function e(e){var t={link:a,restrict:"A",replace:true};return t;function a(t,a,n){t.$watch(n.dynamicCompile,function(n){a.html(n);e(a.contents())(t)})}}})();(function(){angular.module("nativeQDAApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("nativeQDAApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();