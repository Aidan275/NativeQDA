(function(){angular.module("nativeQDAApp",["ngRoute","ngSanitize","ngTable","ui.bootstrap","ui.bootstrap.datepicker","rzModule","ngFileUpload","ngTagsInput","jp.ng-bs-animated-button"]);e.$inject=["$routeProvider","$locationProvider"];function e(e,t){e.when("/login",{templateUrl:"/pages/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm",loginRequired:false}).when("/register",{templateUrl:"/pages/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm",loginRequired:true}).when("/forgot-password",{templateUrl:"/pages/auth/forgotPass/forgotPass.view.html",controller:"forgotPassCtrl",controllerAs:"vm",loginRequired:false}).when("/",{templateUrl:"/pages/home/home.view.html",controller:"homeCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/map",{templateUrl:"/pages/analysis/map/map.view.html",controller:"mapCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/data",{templateUrl:"/pages/analysis/data/data.view.html",controller:"dataCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/visualisation",{templateUrl:"/pages/analysis/visualisation/visualisation.view.html",controller:"visualisationCtrl",controllerAs:"vm",loginRequired:true}).when("/survey",{templateUrl:"/pages/survey/survey.view.html",controller:"surveyCtrl",controllerAs:"vm",loginRequired:true}).when("/files",{templateUrl:"/pages/files/files.view.html",controller:"filesCtrl",controllerAs:"vm",loginRequired:true}).when("/settings",{templateUrl:"/pages/settings/settings.view.html",controller:"settingsCtrl",controllerAs:"vm",loginRequired:true}).when("/complete-survey",{templateUrl:"/pages/survey/completeSurvey/completeSurvey.view.html",controller:"CompleteSurveyCtrl",controllerAs:"vm",loginRequired:false}).when("/heatmap-example",{templateUrl:"/pages/heatmapExample/heatmapExample.view.html",controller:"heatmapCtrl",controllerAs:"vm",loginRequired:true}).otherwise({redirectTo:"/"});t.html5Mode(true)}function t(e,t,n){e.$on("$routeChangeStart",function(e,a,o){var i;if(a.loginRequired&&!n.isLoggedIn()){i=t.path();t.path("/login").replace();t.search("page",i)}else if(a.loginRequired&&n.isLoggedIn()){t.path(i).replace();i=null}})}angular.module("nativeQDAApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",t])})();(function(){"use strict";angular.module("nativeQDAApp").config(e);e.$inject=["$qProvider","$logProvider"];function e(e,t){e.errorOnUnhandledRejections(false);toastr.options.closeButton=true;toastr.options.timeOut=14e3;toastr.options.positionClass="toast-top-right";if(t.debugEnabled){t.debugEnabled(true)}}})();(function(){"use strict";angular.module("nativeQDAApp").controller("homeCtrl",e);e.$inject=["$scope","$filter","$compile","geolocService","initMapService","filesService","authentication","logger"];function e(e,t,n,a,o,i,r,l){var s=this;var c=-34.4054039;var u=150.87842999999998;var g;s.getGeoData=m;s.getFileList=d;s.noGeo=h;s.showGeoError=f;s.viewFile=v;s.pageHeader={title:"Dashboard",strapline:"summary of recent activity"};p();function p(){d()}function d(){i.getFileListDB().then(function(e){g=e.data;a.getPosition(s.getGeoData,s.showGeoError,s.noGeo)},function(e){console.log(e)});return false}function m(e){w(e.coords.latitude,e.coords.longitude)}function f(t){e.$apply(function(){s.message=t.message;w(c,u)})}function h(){e.$apply(function(){s.message="Geolocation is not supported by this browser.";w(c,u)})}function v(e){i.signDownloadS3(e).then(function(e){var t=e.data;$window.open(e.data,"_blank")},function(e){console.log(e)})}function w(a,i){o.init.then(function(){var o=new google.maps.LatLng(a,i);var r=document.getElementById("map-homepage");var l={center:o,zoom:4,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var s=new google.maps.Map(r,l);var c={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var u=[];var p=[];var d=[];g.forEach(function(a){var o=new google.maps.Marker({position:new google.maps.LatLng(a.coords.lat,a.coords.lng),icon:c["australia"].icon,title:a.key});var i='<div class="info-window">'+"<h3>"+a.key+"</h3>"+"<p>Created By: "+a.createdBy+"</p>"+"<p>Size: "+t("formatFileSize")(a.size,2)+"</p>"+"<p>Last Modified: "+a.lastModified+"</p>"+"<p>Tags: ";a.tags.forEach(function(e){i+=e+", "});i+="<p><a ng-click=\"vm.viewFile('"+a.key+'\')" class="btn btn-success" role="button">View file</a></p>'+"</div>";var r=n(i)(e);var l=new google.maps.InfoWindow({content:r[0]});o.addListener("click",function(){l.open(s,o)});if(o.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){u.push(o)}else if(o.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){p.push(o)}else if(o.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){d.push(o)}});var m=new MarkerClusterer(s,u,{imagePath:"/images/map/icons/kangaroo-markers/m"});var f=new MarkerClusterer(s,p,{imagePath:"/images/map/icons/kiwi-markers/m"});var h=new MarkerClusterer(s,d,{imagePath:"/images/map/icons/kagu-markers/m"})})}}})();(function(){angular.module("nativeQDAApp").controller("loginCtrl",e);e.$inject=["$location","geolocation","authentication","events"];function e(e,t,n,a){var o=this;o.credentials={email:"",password:""};o.pageHeader={title:"Sign in to nativeQDA"};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";a.event({email:o.credentials.email,desc:"Login"});n.login(o.credentials).then(function(t){e.search("page",null);e.path(o.returnPage)},function(e){o.formError=e.data.message})}}})();(function(){angular.module("nativeQDAApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.pageHeader={title:"Create a new nativeQDA account"};n.credentials={name:"",email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";t.register(n.credentials).then(function(){e.search("page",null);e.path(n.returnPage)},function(e){n.formError=e})}}})();(function(){angular.module("nativeQDAApp").controller("forgotPassCtrl",e);e.$inject=["authentication"];function e(e){var t=this;t.pageHeader={title:"Forgot Password"};t.credentials={email:""};t.onSubmit=function(){t.formError="";if(!t.credentials.email){t.formError="All fields required, please try again";return false}else{console.log("Send email to "+t.credentials.email+" to reset password!")}}}})();(function(){angular.module("nativeQDAApp").controller("mapCtrl",e);e.$inject=["$scope","$compile","$window","$filter","geolocService","initMapService","authentication","events","filesService"];function e(e,t,n,a,o,i,r,l,s){var c=this;var u=-34.406749;var g=150.878473;var p=5;var d;c.getData=function(e){u=e.coords.latitude;g=e.coords.longitude;l.event({email:r.currentUser().email});p=13;m(u,g)};c.showError=function(t){e.$apply(function(){c.message=t.message;console.log(c.message);m(u,g)})};c.noGeo=function(){e.$apply(function(){c.message="Geolocation is not supported by this browser.";console.log(c.message);m(u,g)})};c.getFileList=function(){s.getFileListDB().then(function(e){d=e.data;o.getPosition(c.getData,c.showError,c.noGeo)},function(e){console.log(e)});return false};c.getFileList();c.viewFile=function(e){s.signDownloadS3(e).then(function(e){var t=e.data;n.open(e.data,"_blank")},function(e){console.log(e)})};function m(n,o){i.init.then(function(){var i=new google.maps.LatLng(n,o);var r=document.getElementById("map");var l={center:i,zoom:p,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var s=new google.maps.Map(r,l);var c={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var u=[];var g=[];var m=[];d.forEach(function(n){var o=new google.maps.Marker({position:new google.maps.LatLng(n.coords.lat,n.coords.lng),icon:c["australia"].icon,title:n.key});var i='<div class="info-window">'+"<h3>"+n.key+"</h3>"+"<p>Created By: "+n.createdBy+"</p>"+"<p>Size: "+a("formatFileSize")(n.size,2)+"</p>"+"<p>Last Modified: "+n.lastModified+"</p>"+"<p>Tags: ";n.tags.forEach(function(e){i+=e+", "});i+="<p><a ng-click=\"vm.viewFile('"+n.key+'\')" class="btn btn-success" role="button">View file</a></p>'+"</div>";var r=t(i)(e);var l=new google.maps.InfoWindow({content:r[0]});o.addListener("click",function(){l.open(s,o)});if(o.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){u.push(o)}else if(o.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){g.push(o)}else if(o.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){m.push(o)}});var f=new MarkerClusterer(s,u,{imagePath:"/images/map/icons/kangaroo-markers/m"});var h=new MarkerClusterer(s,g,{imagePath:"/images/map/icons/kiwi-markers/m"});var v=new MarkerClusterer(s,m,{imagePath:"/images/map/icons/kagu-markers/m"})})}}})();(function(){angular.module("nativeQDAApp").controller("dataCtrl",e);e.$inject=["$window","$sce","$uibModal","NgTableParams","datasets"];function e(e,t,n,a,o){var i=this;var r;i.pageHeader={title:"Data",strapline:"where the Datasets live"};i.popupViewDatasetForm=function(e){var t=n.open({templateUrl:"/pages/analysis/data/viewDataset/viewDataset.view.html",controller:"viewDatasetCtrl as vm",size:"lg",resolve:{datasetid:function(){return e}}});t.result.then(function(){})};i.popupEditDatasetForm=function(e,t){var a=n.open({templateUrl:"/pages/analysis/data/editDataset/editDataset.view.html",controller:"editDatasetCtrl as vm",size:"xl"});a.result.then(function(){i.getDatasetList()})};i.popupNewDatasetForm=function(){var e=n.open({templateUrl:"/pages/analysis/data/newDataset/newDataset.view.html",controller:"newDatasetCtrl as vm",size:"xl"});e.result.then(function(){i.getDatasetList()})};i.doListDatasets=function(e){r=e;i.tableParams=new a({sorting:{dateCreated:"desc"}},{dataset:r})};i.getDatasetList=function(){o.listDatasets().then(function(e){i.doListDatasets(e.data)},function(e){console.log(e)});return false};i.getDatasetList();i.doDeleteDataset=function(e){o.datasetDeleteOne(e).then(function(e){i.getDatasetList()},function(e){console.log(e)});return false};i.confirmDelete=function(t,n){deleteDataset=e.confirm("Are you sure you want to delete "+t+"?");if(deleteDataset){i.doDeleteDataset(n)}}}})();(function(){angular.module("nativeQDAApp").controller("newDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets"];function e(e,t){var n=this;n.onSubmit=function(){n.formError="";if(angular.isDefined(n.formData)){if(!n.formData.datasetName||!n.formData.description){n.formError="All fields required, please try again";return false}else{n.doCreateDataset(n.formData)}}else{n.formError="All fields required, please try again";return false}};n.doCreateDataset=function(e){t.datasetCreate({name:n.formData.datasetName,desc:n.formData.description}).then(function(e){n.modal.close(e.data)},function(e){n.formError="The Dataset was not saved, please try again"});return false};n.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("viewDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets","datasetid"];function e(e,t,n){var a=this;a.datasetid=n;t.datasetReadOne(a.datasetid).then(function(e){a.data=e.data},function(e){console.log(e)});a.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("editDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets"];function e(e,t){var n=this;n.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("visualisationCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,t,n,a,o){var i=this;i.pageHeader={title:"Visualisation",strapline:"visualise datasets here"};i.popupVisualisationForm=function(){var e=o.open({templateUrl:"/pages/analysis/visualisation/newVisualisation/newVisualisation.view.html",controller:"newVisualisationCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id1"},{visual:"Word Cloud",visualThumb:"word-cloud-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/01/12",command:"id2"},{visual:"Chord Diagram",visualThumb:"chord-diagram-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/03/29",command:"id3"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/09/15",command:"id4"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id5"},{visual:"Word Frequency Chart",visualThumb:"bar-chart-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/01/12",command:"id6"},{visual:"Word Tree",visualThumb:"word-tree-thumb.png",dataSet:"Qualitative study of the Moriori language",createdBy:"Michael",dateCreated:"2017/03/29",command:"id7"}];i.tableParams=new n({},{dataset:r});e.confirmDelete=function(){t.confirm("Are you sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newVisualisationCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.onSubmit=function(){t.formError="";if(angular.isDefined(t.formData)){if(!t.formData.visualisationName){t.formError="All fields required, please try again";return false}else{console.log("Create Visualisation!")}}else{t.formError="All fields required, please try again";return false}};t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("CompleteSurveyCtrl",e);function e(){var e=this;e.surveyCode="";e.onSubmit=function(){e.formError="";if(!e.surveyCode){e.formError="All fields required, please try again";return false}else{console.log("Find survey and display to user!")}}}})();(function(){angular.module("nativeQDAApp").controller("surveyCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,t,n,a,o){var i=this;i.pageHeader={title:"Surveys",strapline:"for the masses"};i.popupNewSurveyForm=function(){var e=o.open({templateUrl:"/pages/survey/newSurvey/newSurvey.view.html",controller:"newSurveyCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{survey:"Survey",createdBy:"Anu",responses:12,dateCreated:"2017/05/26",command:"id1"},{survey:"Survey2",createdBy:"Michael",responses:50,dateCreated:"2017/05/02",command:"id1"},{survey:"Survey3",createdBy:"Michael",responses:23,dateCreated:"2017/02/12",command:"id1"},{survey:"Survey4",createdBy:"Anu",responses:50,dateCreated:"2017/02/15",command:"id1"},{survey:"Survey5",createdBy:"Holly",responses:11,dateCreated:"2017/04/02",command:"id1"},{survey:"Survey6",createdBy:"Anu",responses:1,dateCreated:"2017/01/11",command:"id1"},{survey:"Survey7",createdBy:"Michael",responses:100,dateCreated:"2017/01/23",command:"id1"}];i.tableParams=new n({},{dataset:r});e.confirmDelete=function(){t.confirm("Are ya sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newSurveyCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.onSubmit=function(){t.formError="";if(angular.isDefined(t.formData)){if(!t.formData.surveyName){t.formError="All fields required, please try again";return false}else{console.log("Create Survey!")}}else{t.formError="All fields required, please try again";return false}};t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("heatmapCtrl",e);e.$inject=["$scope","geolocation","GoogleMapsInitialiser","authentication","events"];function e(e,t,n,a,o){var i=this;var r=-33.848192;var l=151.061857;var s=10;o.event({email:a.currentUser().email});i.bothOver=true;i.fatherOver=true;i.MotherOver=true;i.bothAus=true;c(r,l);function c(e,t){n.mapsInitialised.then(function(){var n=new google.maps.LatLng(e,t);var a=document.getElementById("map");var o={center:n,zoom:s,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var r=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:9029},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:358},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:3235},{location:new google.maps.LatLng(-33.76288,150.99212),weight:7427},{location:new google.maps.LatLng(-33.771,150.9063),weight:21538},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:4163},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:8865},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:1618},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:5627},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:3383},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:27386},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:11435},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:1552},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:979},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}];var l=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:187},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:18},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:64},{location:new google.maps.LatLng(-33.76288,150.99212),weight:141},{location:new google.maps.LatLng(-33.771,150.9063),weight:224},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:130},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:202},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:96},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:132},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:165},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:179},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:123},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:107},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:128},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}];var c=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:129},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:15},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:53},{location:new google.maps.LatLng(-33.76288,150.99212),weight:127},{location:new google.maps.LatLng(-33.771,150.9063),weight:151},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:106},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:173},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:60},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:83},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:98},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:145},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:98},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:59},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:95},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}];var u=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:68},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:13},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:45},{location:new google.maps.LatLng(-33.76288,150.99212),weight:66},{location:new google.maps.LatLng(-33.771,150.9063),weight:99},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:62},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:116},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:65},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:69},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:96},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:84},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:43},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:47},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:106},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110}];var g=new google.maps.Map(a,o);var p=new google.maps.visualization.HeatmapLayer;var d=null;i.radiusSlider={value:100,options:{floor:0,ceil:200,onChange:function(){p.set("radius",i.radiusSlider.value)}}};i.opacitySlider={value:.6,options:{floor:0,ceil:1,step:.01,precision:10,onChange:function(){p.set("opacity",i.opacitySlider.value)}}};i.updateMap=function(){if(p){p.setMap(null)}var e=[];if(i.bothOver){Array.prototype.push.apply(e,r)}if(i.fatherOver){Array.prototype.push.apply(e,l)}if(i.MotherOver){Array.prototype.push.apply(e,c)}if(i.bothAus){Array.prototype.push.apply(e,u)}p.setData(e);p.setOptions({radius:i.radiusSlider.value,opacity:i.opacitySlider.value,gradient:d});p.setMap(g)};i.removeGrtSyd=function(){if(i.rmGrtSyd){r.pop();l.pop();c.pop();u.pop()}else{r.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088});l.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219});c.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681});u.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110})}i.updateMap()};i.changeGradient=function(){if(i.changeGrad){d=["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]}else{d=null}i.updateMap()};i.updateMap()})}}})();(function(){angular.module("nativeQDAApp").controller("filesCtrl",e);e.$inject=["$http","$window","$scope","$uibModal","Upload","NgTableParams","filesService","authentication","initMapService"];function e(e,t,n,a,o,i,r,l,s){var c=this;var u=null;var g=null;c.tags=[];c.address="";c.formattedAddress="";c.currentPercentage="0";c.popupViewFile=d;c.getFileListS3=f;c.doDeleteFile=w;c.confirmDelete=L;c.onFileSelect=y;c.geocodeAddress=k;p();function p(){A();h()}function d(e){var t=a.open({templateUrl:"/pages/files/viewFile/viewFile.view.html",controller:"viewFileCtrl as vm",size:"lg",resolve:{key:function(){return e}}});t.result.then(function(){})}function m(e){fileList=e;c.tableParams=new i({sorting:{LastModified:"desc"}},{dataset:fileList})}function f(){r.getFileListS3().then(function(e){doListFilesS3(e.data.Contents)},function(e){console.log(e)})}function h(){r.getFileListDB().then(function(e){m(e.data)},function(e){console.log(e)})}function v(e){r.deleteFileDB(e).then(function(e){h()},function(e){console.log(e)})}function w(e){r.deleteFileS3({key:e}).then(function(t){v(e)})}function L(e,n){var a=t.confirm("Are you sure you want to delete "+n+"?");if(a){c.doDeleteFile(e)}}function y(e){if(e.length>0){var t=e[0].name;var n=e[0].type;var a={filename:t,type:n};r.signUploadS3(a).then(function(n){o.upload({method:"POST",url:n.data.url,fields:n.data.fields,file:e[0]}).progress(function(e){c.currentPercentage=parseInt(100*e.loaded/e.total);console.log("progress: "+parseInt(100*e.loaded/e.total))}).then(function(e){console.log("file "+e.config.file.name+"is uploaded successfully. Response: "+e.data);console.log(e);var n=$.parseXML(e.data);var a=c.tags.map(function(e){return e["text"]});var o={name:t,eTag:$(n).find("ETag").text(),key:$(n).find("Key").text(),size:e.config.file.size,url:$(n).find("Location").text(),createdBy:l.currentUser().name,lat:c.lat,lng:c.lng,tags:a};r.addFileDB(o).then(function(e){console.log(e);h()},function(e){console.log(e)})},function(e){console.log(e)})},function(e){console.log(e)})}}function A(){s.init.then(function(){D()})}function D(){var e=new google.maps.LatLng(-34.406749,150.878473);var t=document.getElementById("file-map");var a={zoom:13,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};g=new google.maps.Map(t,a);u=new google.maps.Marker({draggable:true,position:e,map:g,title:"Latitude: "+e.lat()+"\nLongitude: "+e.lng()});google.maps.event.addListener(u,"dragend",function(e){u.setTitle("Latitude: "+e.latLng.lat()+"\nLongitude: "+e.latLng.lng());c.lat=e.latLng.lat();c.lng=e.latLng.lng();n.$apply()});google.maps.event.addListener(g,"click",function(e){u.setPosition(e.latLng);u.setTitle("Latitude: "+e.latLng.lat()+"\nLongitude: "+e.latLng.lng());c.lat=e.latLng.lat();c.lng=e.latLng.lng();n.$apply()})}function k(){var e=new google.maps.Geocoder;e.geocode({address:c.address},function(e,t){if(t==="OK"){c.lat=e[0].geometry.location.lat();c.lng=e[0].geometry.location.lng();c.formattedAddress=e[0].formatted_address;u.setPosition(e[0].geometry.location);u.setTitle("Latitude: "+c.lat+"\nLongitude: "+c.lng);g.panTo(new google.maps.LatLng(c.lat,c.lng));n.$apply()}else if(t==="ZERO_RESULTS"){toastr.warning("Warning: Address not found","Warning",{positionClass:"toast-top-center"})}else{toastr.error("Geocode failed: "+t,"Error",{positionClass:"toast-top-center"})}})}}})();(function(){angular.module("nativeQDAApp").controller("viewFileCtrl",e);e.$inject=["$uibModalInstance","$window","key","filesService"];function e(e,t,n,a){var o=this;o.updateAcl=s;o.viewFile=r;o.isSubmittingButton=null;o.resultButton=null;o.makePublicOptions={buttonDefaultText:"Make Public"};o.makePrivateOptions={buttonDefaultText:"Make Private"};i();function i(){a.fileReadOneDB(n).then(function(e){o.file=e.data;o.acl=o.file.acl},function(e){console.log(e)})}function r(e){a.signDownloadS3(e).then(function(e){var n=e.data;t.open(e.data,"_blank")},function(e){console.log(e)})}function l(e,t){a.objectAclDB({key:e,acl:t}).then(function(e){o.resultButton="success";o.acl=t},function(e){o.resultButton="error";console.log(e)})}function s(e,t){o.isSubmittingButton=true;a.objectAclS3({key:e,acl:t}).then(function(n){l(e,t)},function(e){o.resAclBtn="error";console.log(e)})}o.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("settingsCtrl",e);function e(){var e=this;e.pageHeader={title:"Settings",strapline:"change how things work"}}})();(function(){"use strict";angular.module("nativeQDAApp").service("exception",e);e.$inject=["$q","logger"];function e(e,t){return{catcher:n};function n(n){return function(a){var o;var i;if(a.data&&a.data.description){o="\n"+a.data.description;i=n+o;a.data.description=i}else if(a.data&&a.data.message){o="\n"+a.data.message;i=n+o;a.data.message=i}t.error(i,a,"Error");return e.reject(a)}}}})();(function(){"use strict";angular.module("nativeQDAApp").service("logger",e);e.$inject=["$log"];function e(e){return{showToasts:true,error:t,info:n,success:a,warning:o,log:e.log};function t(t,n,a){toastr.error(t,a);e.error("Error: "+t,n)}function n(t,n,a){toastr.info(t,a);e.info("Info: "+t,n)}function a(t,n,a){toastr.success(t,a);e.info("Success: "+t,n)}function o(t,n,a){toastr.warning(t,a);e.warn("Warning: "+t,n)}}})();(function(){"use strict";angular.module("nativeQDAApp").service("filesService",e);e.$inject=["$http","authentication","exception"];function e(e,t,n){return{signUploadS3:a,signDownloadS3:o,getFileListS3:i,deleteFileS3:r,addFileDB:l,getFileListDB:s,fileReadOneDB:c,deleteFileDB:u,syncDBwithS3:g,objectAclS3:p,objectAclDB:d};function a(a){return e.post("/api/files/signUploadS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for signUploadS3")(e)}}function o(a){return e.get("/api/files/signDownloadS3?key="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for signDownloadS3")(e)}}function i(){return e.get("/api/files/getFileListS3",{headers:{Authorization:"Bearer "+t.getToken()}}).then(a).catch(o);function a(e){return e}function o(e){return n.catcher("XHR Failed for getFileListS3")(e)}}function r(a){return e.post("/api/files/deleteFileS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for deleteFileS3")(e)}}function l(a){return e.post("/api/files/addFileDB",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for addFileDB")(e)}}function s(){return e.get("/api/files/getFileListDB",{headers:{Authorization:"Bearer "+t.getToken()}}).then(a).catch(o);function a(e){return e}function o(e){return n.catcher("XHR Failed for getFileListDB")(e)}}function c(a){return e.get("/api/files/fileReadOneDB?key="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for fileReadOneDB")(e)}}function u(a){return e.delete("/api/files/deleteFileDB?key="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for deleteFileDB")(e)}}function g(a){return e.post("/api/files/syncDBwithS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for syncDBwithS3")(e)}}function p(a){return e.post("/api/files/objectAclS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for objectAclS3")(e)}}function d(a){return e.post("/api/files/objectAclDB",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(i);function o(e){return e}function i(e){return n.catcher("XHR Failed for objectAclDB")(e)}}}})();(function(){angular.module("nativeQDAApp").service("datasets",e);e.$inject=["$http","authentication"];function e(e,t){var n=function(n){return e.post("/api/analysis/data/create",n,{headers:{Authorization:"Bearer "+t.getToken()}})};var a=function(){return e.get("/api/analysis/data/list",{headers:{Authorization:"Bearer "+t.getToken()}})};var o=function(n){return e.get("/api/analysis/data/read/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})};var i=function(n){return e.delete("/api/analysis/data/delete/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})};return{datasetCreate:n,listDatasets:a,datasetReadOne:o,datasetDeleteOne:i}}})();(function(){angular.module("nativeQDAApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var n=function(e){t.localStorage["nativeQDA-token"]=e};var a=function(){
return t.localStorage["nativeQDA-token"]};var o=function(){var e=a();if(e){var n=JSON.parse(t.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var i=function(){if(o()){var e=a();var n=JSON.parse(t.atob(e.split(".")[1]));return{email:n.email,name:n.name}}};var r=function(t){return e.post("/api/register",t).then(function(e){n(e.data.token)})};var l=function(t){return e.post("/api/login",t).then(function(e){n(e.data.token)})};var s=function(n){t.localStorage.removeItem("nativeQDA-token");return e.post("/api/event",n)};return{currentUser:i,saveToken:n,getToken:a,isLoggedIn:o,register:r,login:l,logout:s}}})();(function(){angular.module("nativeQDAApp").service("events",e);e.$inject=["$http"];function e(e){var t=function(t){return e.post("/api/event",t)};return{event:t}}})();(function(){angular.module("nativeQDAApp").service("geolocService",e);function e(){return{getPosition:e};function e(e,t,n){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{n()}}}})();(function(){angular.module("nativeQDAApp").service("initMapService",e);e.$inject=["$window","$q"];function e(e,t){var n="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEMpLtx0n2Pk4ggQonEyD0iPZbGHYhR5o&libraries=visualization&callback=",a=t.defer();e.googleMapsInitialised=a.resolve;var o=function(e,t){var n=document.createElement("script");n.src=e+t;document.body.appendChild(n)};o(n,"googleMapsInitialised");return{init:a.promise}}})();(function(){angular.module("nativeQDAApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var n=t/1e3;var a;if(t&&e(t)){if(n>1){n=parseFloat(n).toFixed(1);a=" km"}else{n=parseInt(n*1e3,10);a=" m"}return n+a}else{return"?"}}}})();(function(){angular.module("nativeQDAApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("nativeQDAApp").filter("formatFileSize",e);function e(){return function(e,t){if(e===0||isNaN(parseFloat(e))||!isFinite(e)){return"-"}if(typeof t==="undefined"){t=1}var n=["bytes","kB","MB","GB","TB","PB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+" "+n[a]}}})();(function(){angular.module("nativeQDAApp").controller("navigationCtrl",e);e.$inject=["$location","authentication","events"];function e(e,t,n){var a=this;n.event({email:t.currentUser().email});a.currentPath=e.path();a.isLoggedIn=t.isLoggedIn();a.currentUser=t.currentUser();a.logout=function(){t.logout({email:t.currentUser().email,desc:"Logout"});e.path("/login")}}})();(function(){angular.module("nativeQDAApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("nativeQDAApp").directive("dynamicCompile",e);e.$inject=["$compile"];function e(e){var t={link:n,restrict:"A",replace:true};return t;function n(t,n,a){t.$watch(a.dynamicCompile,function(a){n.html(a);e(n.contents())(t)})}}})();(function(){angular.module("nativeQDAApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("nativeQDAApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();