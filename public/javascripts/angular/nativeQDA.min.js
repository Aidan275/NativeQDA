(function(){angular.module("nativeQDAApp",["ngRoute","ngSanitize","ngTable","ui.bootstrap","ui.bootstrap.datepicker","rzModule","ngFileUpload","ngTagsInput"]);e.$inject=["$routeProvider","$locationProvider"];function e(e,t){e.when("/login",{templateUrl:"/pages/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm",loginRequired:false}).when("/register",{templateUrl:"/pages/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm",loginRequired:true}).when("/forgot-password",{templateUrl:"/pages/auth/forgotPass/forgotPass.view.html",controller:"forgotPassCtrl",controllerAs:"vm",loginRequired:false}).when("/",{templateUrl:"/pages/home/home.view.html",controller:"homeCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/map",{templateUrl:"/pages/analysis/map/map.view.html",controller:"mapCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/data",{templateUrl:"/pages/analysis/data/data.view.html",controller:"dataCtrl",controllerAs:"vm",loginRequired:true}).when("/analysis/visualisation",{templateUrl:"/pages/analysis/visualisation/visualisation.view.html",controller:"visualisationCtrl",controllerAs:"vm",loginRequired:true}).when("/survey",{templateUrl:"/pages/survey/survey.view.html",controller:"surveyCtrl",controllerAs:"vm",loginRequired:true}).when("/files",{templateUrl:"/pages/files/files.view.html",controller:"filesCtrl",controllerAs:"vm",loginRequired:true}).when("/settings",{templateUrl:"/pages/settings/settings.view.html",controller:"settingsCtrl",controllerAs:"vm",loginRequired:true}).when("/complete-survey",{templateUrl:"/pages/survey/completeSurvey/completeSurvey.view.html",controller:"CompleteSurveyCtrl",controllerAs:"vm",loginRequired:false}).when("/heatmap-example",{templateUrl:"/pages/heatmapExample/heatmapExample.view.html",controller:"heatmapCtrl",controllerAs:"vm",loginRequired:true}).otherwise({redirectTo:"/"});t.html5Mode(true)}function t(e,t,a){e.$on("$routeChangeStart",function(e,n,o){var i;if(n.loginRequired&&!a.isLoggedIn()){i=t.path();t.path("/login").replace();t.search("page",i)}else if(n.loginRequired&&a.isLoggedIn()){t.path(i).replace();i=null}})}angular.module("nativeQDAApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",t])})();(function(){angular.module("nativeQDAApp").controller("homeCtrl",e);e.$inject=["$scope","geolocation","GoogleMapsInitialiser","authentication","events"];function e(e,t,a,n,o){var i=this;i.pageHeader={title:"Dashboard",strapline:"summary of recent activity"};var r=-34.406749;var l=150.878473;i.getData=function(e){r=e.coords.latitude;l=e.coords.longitude;s(r,l);var t={email:n.currentUser().email,lat:r,lng:l};o.event(t)};i.showError=function(t){e.$apply(function(){i.message=t.message;console.log(i.message);s(r,l)})};i.noGeo=function(){e.$apply(function(){i.message="Geolocation is not supported by this browser.";console.log(i.message);s(r,l)})};t.getPosition(i.getData,i.showError,i.noGeo);function s(e,t){a.mapsInitialised.then(function(){var a=new google.maps.LatLng(e,t);var n=document.getElementById("map-homepage");var o={center:a,zoom:4,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var i=new google.maps.Map(n,o);var r={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var l=[{position:new google.maps.LatLng(-34.195122,145.61361),type:"australia"},{position:new google.maps.LatLng(-27.782105,144.988068),type:"australia"},{position:new google.maps.LatLng(-31.617175,149.755251),type:"australia"},{position:new google.maps.LatLng(-34.183426,145.531326),type:"australia"},{position:new google.maps.LatLng(-23.004057,150.208288),type:"australia"},{position:new google.maps.LatLng(-23.36721,148.562199),type:"australia"},{position:new google.maps.LatLng(-27.149085,148.392517),type:"australia"},{position:new google.maps.LatLng(-27.171054,148.692928),type:"australia"},{position:new google.maps.LatLng(-21.676721,166.040641),type:"newCaledonia"},{position:new google.maps.LatLng(-21.198481,165.322936),type:"newCaledonia"},{position:new google.maps.LatLng(-20.650302,164.73978),type:"newCaledonia"},{position:new google.maps.LatLng(-20.51384,164.399452),type:"newCaledonia"},{position:new google.maps.LatLng(-20.765698,164.41047),type:"newCaledonia"},{position:new google.maps.LatLng(-20.625109,164.786398),type:"newCaledonia"},{position:new google.maps.LatLng(-22.259586,166.453261),type:"newCaledonia"},{position:new google.maps.LatLng(-40.768675,175.207908),type:"newZealand"},{position:new google.maps.LatLng(-41.114069,174.107308),type:"newZealand"},{position:new google.maps.LatLng(-41.101032,175.183516),type:"newZealand"},{position:new google.maps.LatLng(-40.145982,176.593862),type:"newZealand"},{position:new google.maps.LatLng(-39.454753,173.929295),type:"newZealand"},{position:new google.maps.LatLng(-39.060873,176.168224),type:"newZealand"},{position:new google.maps.LatLng(-43.974486,169.417745),type:"newZealand"},{position:new google.maps.LatLng(-45.77995,170.528945),type:"newZealand"}];var s=[];var g=[];var c=[];var u='<div class="info-window">'+"<h3>Data</h3>"+'<div class="info-content">'+"<p>Data collected from interview</p>"+'<a href="/files">Interview.doc</a>'+"</div>"+"</div>";var p=new google.maps.InfoWindow({content:u,maxWidth:400});l.forEach(function(e){var t=new google.maps.Marker({position:e.position,icon:r[e.type].icon});t.addListener("click",function(){p.open(i,t)});if(t.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){s.push(t)}else if(t.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){g.push(t)}else if(t.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){c.push(t)}});var m=new MarkerClusterer(i,s,{imagePath:"/images/map/icons/kangaroo-markers/m"});var d=new MarkerClusterer(i,g,{imagePath:"/images/map/icons/kiwi-markers/m"});var f=new MarkerClusterer(i,c,{imagePath:"/images/map/icons/kagu-markers/m"})})}}})();(function(){angular.module("nativeQDAApp").controller("loginCtrl",e);e.$inject=["$location","geolocation","authentication","events"];function e(e,t,a,n){var o=this;o.credentials={email:"",password:""};o.pageHeader={title:"Sign in to nativeQDA"};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";n.event({email:o.credentials.email,desc:"Login"});a.login(o.credentials).then(function(t){e.search("page",null);e.path(o.returnPage)},function(e){o.formError=e.data.message})}}})();(function(){angular.module("nativeQDAApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var a=this;a.pageHeader={title:"Create a new nativeQDA account"};a.credentials={name:"",email:"",password:""};a.returnPage=e.search().page||"/";a.onSubmit=function(){a.formError="";if(!a.credentials.name||!a.credentials.email||!a.credentials.password){a.formError="All fields required, please try again";return false}else{a.doRegister()}};a.doRegister=function(){a.formError="";t.register(a.credentials).then(function(){e.search("page",null);e.path(a.returnPage)},function(e){a.formError=e})}}})();(function(){angular.module("nativeQDAApp").controller("forgotPassCtrl",e);e.$inject=["authentication"];function e(e){var t=this;t.pageHeader={title:"Forgot Password"};t.credentials={email:""};t.onSubmit=function(){t.formError="";if(!t.credentials.email){t.formError="All fields required, please try again";return false}else{console.log("Send email to "+t.credentials.email+" to reset password!")}}}})();(function(){angular.module("nativeQDAApp").controller("mapCtrl",e);e.$inject=["$scope","$compile","$window","$filter","geolocation","GoogleMapsInitialiser","authentication","events","files"];function e(e,t,a,n,o,i,r,l,s){var g=this;var c=-34.406749;var u=150.878473;var p=5;var m;g.getData=function(e){c=e.coords.latitude;u=e.coords.longitude;userDetails={email:r.currentUser().email,lat:c,lng:u};l.event(userDetails);p=13;d(c,u)};g.showError=function(t){e.$apply(function(){g.message=t.message;console.log(g.message);d(c,u)})};g.noGeo=function(){e.$apply(function(){g.message="Geolocation is not supported by this browser.";console.log(g.message);d(c,u)})};g.getFileList=function(){s.getFileListDB().then(function(e){m=e.data;o.getPosition(g.getData,g.showError,g.noGeo)},function(e){console.log(e)});return false};g.getFileList();g.viewFile=function(e){s.signDownloadS3(e).then(function(e){var t=e.data;a.open(e.data,"_blank")},function(e){console.log(e)})};function d(a,o){i.mapsInitialised.then(function(){var i=new google.maps.LatLng(a,o);var r=document.getElementById("map");var l={center:i,zoom:p,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var s=new google.maps.Map(r,l);var g={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}};var c=[];var u=[];var d=[];m.forEach(function(a){var o=new google.maps.Marker({position:new google.maps.LatLng(a.coords.lat,a.coords.lng),icon:g["australia"].icon,title:a.key});var i='<div class="info-window">'+"<h3>"+a.key+"</h3>"+"<p>Created By: "+a.createdBy+"</p>"+"<p>Size: "+n("formatFileSize")(a.size,2)+"</p>"+"<p>Last Modified: "+a.lastModified+"</p>"+"<p>Tags: ";a.tags.forEach(function(e){i+=e+", "});i+="<p><a ng-click=\"vm.viewFile('"+a.key+'\')" class="btn btn-success" role="button">View file</a></p>'+"</div>";var r=t(i)(e);var l=new google.maps.InfoWindow({content:r[0]});o.addListener("click",function(){l.open(s,o)});if(o.icon=="/images/map/icons/kangaroo-markers/kangaroo-marker.png"){c.push(o)}else if(o.icon=="/images/map/icons/kiwi-markers/kiwi-marker.png"){u.push(o)}else if(o.icon=="/images/map/icons/kagu-markers/kagu-marker.png"){d.push(o)}});var f=new MarkerClusterer(s,c,{imagePath:"/images/map/icons/kangaroo-markers/m"});var v=new MarkerClusterer(s,u,{imagePath:"/images/map/icons/kiwi-markers/m"});var h=new MarkerClusterer(s,d,{imagePath:"/images/map/icons/kagu-markers/m"})})}}})();(function(){angular.module("nativeQDAApp").controller("dataCtrl",e);e.$inject=["$window","$sce","$uibModal","NgTableParams","datasets"];function e(e,t,a,n,o){var i=this;var r;i.pageHeader={title:"Data",strapline:"where the Datasets live"};i.popupViewDatasetForm=function(e){var t=a.open({templateUrl:"/pages/analysis/data/viewDataset/viewDataset.view.html",controller:"viewDatasetCtrl as vm",size:"lg",resolve:{datasetid:function(){return e}}});t.result.then(function(){})};i.popupEditDatasetForm=function(e,t){var n=a.open({templateUrl:"/pages/analysis/data/editDataset/editDataset.view.html",controller:"editDatasetCtrl as vm",size:"xl"});n.result.then(function(){i.getDatasetList()})};i.popupNewDatasetForm=function(){var e=a.open({templateUrl:"/pages/analysis/data/newDataset/newDataset.view.html",controller:"newDatasetCtrl as vm",size:"xl"});e.result.then(function(){i.getDatasetList()})};i.doListDatasets=function(e){r=e;i.tableParams=new n({sorting:{dateCreated:"desc"}},{dataset:r})};i.getDatasetList=function(){o.listDatasets().then(function(e){i.doListDatasets(e.data)},function(e){console.log(e)});return false};i.getDatasetList();i.doDeleteDataset=function(e){o.datasetDeleteOne(e).then(function(e){i.getDatasetList()},function(e){console.log(e)});return false};i.confirmDelete=function(t,a){deleteDataset=e.confirm("Are you sure you want to delete "+t+"?");if(deleteDataset){i.doDeleteDataset(a)}}}})();(function(){angular.module("nativeQDAApp").controller("newDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets"];function e(e,t){var a=this;a.onSubmit=function(){a.formError="";if(angular.isDefined(a.formData)){if(!a.formData.datasetName||!a.formData.description){a.formError="All fields required, please try again";return false}else{a.doCreateDataset(a.formData)}}else{a.formError="All fields required, please try again";return false}};a.doCreateDataset=function(e){t.datasetCreate({name:a.formData.datasetName,desc:a.formData.description}).then(function(e){a.modal.close(e.data)},function(e){a.formError="The Dataset was not saved, please try again"});return false};a.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("viewDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets","datasetid"];function e(e,t,a){var n=this;n.datasetid=a;t.datasetReadOne(n.datasetid).then(function(e){n.data=e.data},function(e){console.log(e)});n.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("editDatasetCtrl",e);e.$inject=["$uibModalInstance","datasets"];function e(e,t){var a=this;a.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("visualisationCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,t,a,n,o){var i=this;i.pageHeader={title:"Visualisation",strapline:"visualise datasets here"};i.popupVisualisationForm=function(){var e=o.open({templateUrl:"/pages/analysis/visualisation/newVisualisation/newVisualisation.view.html",controller:"newVisualisationCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id1"},{visual:"Word Cloud",visualThumb:"word-cloud-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/01/12",command:"id2"},{visual:"Chord Diagram",visualThumb:"chord-diagram-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/03/29",command:"id3"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/09/15",command:"id4"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",command:"id5"},{visual:"Word Frequency Chart",visualThumb:"bar-chart-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/01/12",command:"id6"},{visual:"Word Tree",visualThumb:"word-tree-thumb.png",dataSet:"Qualitative study of the Moriori language",createdBy:"Michael",dateCreated:"2017/03/29",command:"id7"}];i.tableParams=new a({},{dataset:r});e.confirmDelete=function(){t.confirm("Are you sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newVisualisationCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.onSubmit=function(){t.formError="";if(angular.isDefined(t.formData)){if(!t.formData.visualisationName){t.formError="All fields required, please try again";return false}else{console.log("Create Visualisation!")}}else{t.formError="All fields required, please try again";return false}};t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("CompleteSurveyCtrl",e);function e(){var e=this;e.surveyCode="";e.onSubmit=function(){e.formError="";if(!e.surveyCode){e.formError="All fields required, please try again";return false}else{console.log("Find survey and display to user!")}}}})();(function(){angular.module("nativeQDAApp").controller("surveyCtrl",e);e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"];function e(e,t,a,n,o){var i=this;i.pageHeader={title:"Surveys",strapline:"for the masses"};i.popupNewSurveyForm=function(){var e=o.open({templateUrl:"/pages/survey/newSurvey/newSurvey.view.html",controller:"newSurveyCtrl as vm",size:"xl"});e.result.then(function(){})};var r=[{survey:"Survey",createdBy:"Anu",responses:12,dateCreated:"2017/05/26",command:"id1"},{survey:"Survey2",createdBy:"Michael",responses:50,dateCreated:"2017/05/02",command:"id1"},{survey:"Survey3",createdBy:"Michael",responses:23,dateCreated:"2017/02/12",command:"id1"},{survey:"Survey4",createdBy:"Anu",responses:50,dateCreated:"2017/02/15",command:"id1"},{survey:"Survey5",createdBy:"Holly",responses:11,dateCreated:"2017/04/02",command:"id1"},{survey:"Survey6",createdBy:"Anu",responses:1,dateCreated:"2017/01/11",command:"id1"},{survey:"Survey7",createdBy:"Michael",responses:100,dateCreated:"2017/01/23",command:"id1"}];i.tableParams=new a({},{dataset:r});e.confirmDelete=function(){t.confirm("Are ya sure?")}}})();(function(){angular.module("nativeQDAApp").controller("newSurveyCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.onSubmit=function(){t.formError="";if(angular.isDefined(t.formData)){if(!t.formData.surveyName){t.formError="All fields required, please try again";return false}else{console.log("Create Survey!")}}else{t.formError="All fields required, please try again";return false}};t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("heatmapCtrl",e);e.$inject=["$scope","geolocation","GoogleMapsInitialiser","authentication","events"];function e(e,t,a,n,o){var i=this;var r=-33.848192;var l=151.061857;var s=10;o.event({email:n.currentUser().email});i.bothOver=true;i.fatherOver=true;i.MotherOver=true;i.bothAus=true;g(r,l);function g(e,t){a.mapsInitialised.then(function(){var a=new google.maps.LatLng(e,t);var n=document.getElementById("map");var o={center:a,zoom:s,panControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};var r=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:9029},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:358},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:3235},{location:new google.maps.LatLng(-33.76288,150.99212),weight:7427},{location:new google.maps.LatLng(-33.771,150.9063),weight:21538},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:4163},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:8865},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:1618},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:5627},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:3383},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:27386},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:11435},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:1552},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:979},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}];var l=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:187},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:18},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:64},{location:new google.maps.LatLng(-33.76288,150.99212),weight:141},{location:new google.maps.LatLng(-33.771,150.9063),weight:224},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:130},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:202},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:96},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:132},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:165},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:179},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:123},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:107},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:128},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}];var g=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:129},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:15},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:53},{location:new google.maps.LatLng(-33.76288,150.99212),weight:127},{location:new google.maps.LatLng(-33.771,150.9063),weight:151},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:106},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:173},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:60},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:83},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:98},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:145},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:98},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:59},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:95},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}];var c=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:68},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:13},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:45},{location:new google.maps.LatLng(-33.76288,150.99212),weight:66},{location:new google.maps.LatLng(-33.771,150.9063),weight:99},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:62},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:116},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:65},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:69},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:96},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:84},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:43},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:47},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:106},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110}];var u=new google.maps.Map(n,o);var p=new google.maps.visualization.HeatmapLayer;var m=null;i.radiusSlider={value:100,options:{floor:0,ceil:200,onChange:function(){p.set("radius",i.radiusSlider.value)}}};i.opacitySlider={value:.6,options:{floor:0,ceil:1,step:.01,precision:10,onChange:function(){p.set("opacity",i.opacitySlider.value)}}};i.updateMap=function(){if(p){p.setMap(null)}var e=[];if(i.bothOver){Array.prototype.push.apply(e,r)}if(i.fatherOver){Array.prototype.push.apply(e,l)}if(i.MotherOver){Array.prototype.push.apply(e,g)}if(i.bothAus){Array.prototype.push.apply(e,c)}p.setData(e);p.setOptions({radius:i.radiusSlider.value,opacity:i.opacitySlider.value,gradient:m});p.setMap(u)};i.removeGrtSyd=function(){if(i.rmGrtSyd){r.pop();l.pop();g.pop();c.pop()}else{r.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088});l.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219});g.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681});c.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110})}i.updateMap()};i.changeGradient=function(){if(i.changeGrad){m=["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]}else{m=null}i.updateMap()};i.updateMap()})}}})();(function(){angular.module("nativeQDAApp").controller("filesCtrl",e);e.$inject=["$http","$window","$scope","$uibModal","Upload","NgTableParams","files","authentication","GoogleMapsInitialiser"];function e(e,t,a,n,o,i,r,l,s){var g=this;g.tags=[];g.address="Wollongong";g.formattedAddress="";g.currentPercentage="0";g.popupViewFile=function(e){var t=n.open({templateUrl:"/pages/files/viewFile/viewFile.view.html",controller:"viewFileCtrl as vm",size:"xl",resolve:{file:function(){return e}}});t.result.then(function(){})};doListFilesDB=function(e){fileList=e;g.tableParams=new i({sorting:{LastModified:"desc"}},{dataset:fileList})};g.getFileListS3=function(){r.getFileListS3().then(function(e){doListFilesS3(e.data.Contents)},function(e){console.log(e)})};getFileListDB=function(){r.getFileListDB().then(function(e){console.log(e.data);doListFilesDB(e.data)},function(e){console.log(e)})};doDeleteFileDB=function(e){r.deleteFileDB(e).then(function(e){getFileListDB()},function(e){console.log(e)})};g.doDeleteFile=function(e){r.deleteFileS3({key:e}).then(function(t){doDeleteFileDB(e)},function(e){console.log(e)})};g.confirmDelete=function(e,a){var n=t.confirm("Are you sure you want to delete "+a+"?");if(n){g.doDeleteFile(e)}};g.onFileSelect=function(e){if(e.length>0){var t=e[0].name;var a=e[0].type;var n={filename:t,type:a};r.signUploadS3(n).then(function(a){o.upload({method:"POST",url:a.data.url,fields:a.data.fields,file:e[0]}).progress(function(e){g.currentPercentage=parseInt(100*e.loaded/e.total);console.log("progress: "+parseInt(100*e.loaded/e.total))}).then(function(e){console.log("file "+e.config.file.name+"is uploaded successfully. Response: "+e.data);console.log(e);var a=$.parseXML(e.data);var n=g.tags.map(function(e){return e["text"]});var o={name:t,eTag:$(a).find("ETag").text(),key:$(a).find("Key").text(),size:e.config.file.size,url:$(a).find("Location").text(),createdBy:l.currentUser().name,lat:g.lat,lng:g.lng,tags:n};r.addFileDB(o).then(function(e){console.log(e);getFileListDB()},function(e){console.log(e)})},function(e){console.log(e)})},function(e){console.log(e)})}};initMap=function(){s.mapsInitialised.then(function(){var e=new google.maps.LatLng(-34.406749,150.878473);var t={zoom:13,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};var n=new google.maps.Map(document.getElementById("file-map"),t);var o=new google.maps.Marker({draggable:true,position:e,map:n,title:"Latitude: "+e.lat()+"\nLongitude: "+e.lng()});google.maps.event.addListener(o,"dragend",function(e){o.setTitle("Latitude: "+e.latLng.lat()+"\nLongitude: "+e.latLng.lng());g.lat=e.latLng.lat();g.lng=e.latLng.lng();a.$apply()});google.maps.event.addListener(n,"click",function(e){o.setPosition(e.latLng);o.setTitle("Latitude: "+e.latLng.lat()+"\nLongitude: "+e.latLng.lng());g.lat=e.latLng.lat();g.lng=e.latLng.lng();a.$apply()});g.geocodeAddress=function(){var e=new google.maps.Geocoder;e.geocode({address:g.address},function(e,t){if(t==="OK"){var i=e[0].geometry.location.lat();var r=e[0].geometry.location.lng();o.setPosition(e[0].geometry.location);o.setTitle("Latitude: "+i+"\nLongitude: "+r);n.panTo(new google.maps.LatLng(i,r));g.lat=i;g.lng=r;g.formattedAddress=e[0].formatted_address;a.$apply()}else{alert("Geocode was not successful for the following reason: "+t)}})}})};initMap();getFileListDB()}})();(function(){angular.module("nativeQDAApp").controller("viewFileCtrl",e);e.$inject=["$uibModalInstance","$window","files","file"];function e(e,t,a,n){var o=this;o.file=n;o.acl=o.file.acl;o.viewFile=function(e){a.signDownloadS3(e).then(function(e){var a=e.data;t.open(e.data,"_blank")},function(e){console.log(e)})};updateAclDB=function(e,t){a.objectAclDB({key:e,acl:t}).then(function(e){o.acl=t},function(e){console.log(e)})};o.updateAcl=function(e,t){a.objectAclS3({key:e,acl:t}).then(function(a){updateAclDB(e,t)},function(e){console.log(e)})};o.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("nativeQDAApp").controller("settingsCtrl",e);function e(){var e=this;e.pageHeader={title:"Settings",strapline:"change how things work"}}})();(function(){angular.module("nativeQDAApp").service("files",e);e.$inject=["$http","authentication"];function e(e,t){var a=function(a){return e.post("/api/files/signUploadS3",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var n=function(a){return e.get("/api/files/signDownloadS3?key="+a,{headers:{Authorization:"Bearer "+t.getToken()}})};var o=function(){return e.get("/api/files/getFileListS3",{headers:{Authorization:"Bearer "+t.getToken()}})};var i=function(a){return e.post("/api/files/deleteFileS3",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var r=function(a){return e.post("/api/files/addFileDB",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var l=function(){return e.get("/api/files/getFileListDB",{headers:{Authorization:"Bearer "+t.getToken()}})};var s=function(a){return e.delete("/api/files/deleteFileDB?key="+a,{headers:{Authorization:"Bearer "+t.getToken()}})};var g=function(a){return e.post("/api/files/syncDBwithS3",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var c=function(a){return e.post("/api/files/objectAclS3",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var u=function(a){return e.post("/api/files/objectAclDB",a,{headers:{Authorization:"Bearer "+t.getToken()}})};return{signUploadS3:a,signDownloadS3:n,getFileListS3:o,deleteFileS3:i,addFileDB:r,getFileListDB:l,deleteFileDB:s,syncDBwithS3:g,objectAclS3:c,objectAclDB:u}}})();(function(){angular.module("nativeQDAApp").service("datasets",e);e.$inject=["$http","authentication"];function e(e,t){var a=function(a){return e.post("/api/analysis/data/create",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var n=function(){return e.get("/api/analysis/data/list",{headers:{Authorization:"Bearer "+t.getToken()}})};var o=function(a){return e.get("/api/analysis/data/read/"+a,{headers:{Authorization:"Bearer "+t.getToken()}})};var i=function(a){return e.delete("/api/analysis/data/delete/"+a,{headers:{Authorization:"Bearer "+t.getToken()}})};return{datasetCreate:a,listDatasets:n,datasetReadOne:o,datasetDeleteOne:i}}})();(function(){angular.module("nativeQDAApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var a=function(e){t.localStorage["nativeQDA-token"]=e};var n=function(){return t.localStorage["nativeQDA-token"]};var o=function(){var e=n();if(e){var a=JSON.parse(t.atob(e.split(".")[1]));return a.exp>Date.now()/1e3}else{return false}};var i=function(){if(o()){var e=n();var a=JSON.parse(t.atob(e.split(".")[1]));return{email:a.email,name:a.name}}};var r=function(t){return e.post("/api/register",t).then(function(e){a(e.data.token)})};var l=function(t){return e.post("/api/login",t).then(function(e){a(e.data.token)})};var s=function(a){t.localStorage.removeItem("nativeQDA-token");return e.post("/api/event",a)};return{currentUser:i,saveToken:a,getToken:n,isLoggedIn:o,register:r,login:l,logout:s}}})();(function(){angular.module("nativeQDAApp").service("events",e);e.$inject=["$http"];function e(e){var t=function(t){return e.post("/api/event",t)};return{event:t}}})();(function(){angular.module("nativeQDAApp").service("geolocation",e);function e(){var e=function(e,t,a){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{a()}};return{getPosition:e}}})();(function(){angular.module("nativeQDAApp").service("GoogleMapsInitialiser",e);e.$inject=["$window","$q"];function e(e,t){var a="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEMpLtx0n2Pk4ggQonEyD0iPZbGHYhR5o&libraries=visualization&callback=",n=t.defer();e.googleMapsInitialised=n.resolve;var o=function(e,t){var a=document.createElement("script");a.src=e+t;document.body.appendChild(a)};o(a,"googleMapsInitialised");return{mapsInitialised:n.promise}}})();(function(){
angular.module("nativeQDAApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var a=t/1e3;var n;if(t&&e(t)){if(a>1){a=parseFloat(a).toFixed(1);n=" km"}else{a=parseInt(a*1e3,10);n=" m"}return a+n}else{return"?"}}}})();(function(){angular.module("nativeQDAApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("nativeQDAApp").filter("formatFileSize",e);function e(){return function(e,t){if(e===0||isNaN(parseFloat(e))||!isFinite(e)){return"-"}if(typeof t==="undefined"){t=1}var a=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+a[n]}}})();(function(){angular.module("nativeQDAApp").controller("navigationCtrl",e);e.$inject=["$location","authentication","events"];function e(e,t,a){var n=this;a.event({email:t.currentUser().email});n.currentPath=e.path();n.isLoggedIn=t.isLoggedIn();n.currentUser=t.currentUser();n.logout=function(){t.logout({email:t.currentUser().email,desc:"Logout"});e.path("/login")}}})();(function(){angular.module("nativeQDAApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("nativeQDAApp").directive("dynamic",e);e.$inject=["$compile"];function e(e){return{restrict:"A",replace:true,link:function(t,a,n){t.$watch(n.dynamic,function(n){a.html(n);e(a.contents())(t)})}}}})();(function(){angular.module("nativeQDAApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("nativeQDAApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();