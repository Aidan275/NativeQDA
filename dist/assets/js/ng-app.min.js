!function(){"use strict";function e(e,t){e.when("/login",{title:"NativeQDA | Login",templateUrl:"/components/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm",loginRequired:!1}).when("/register",{title:"NativeQDA | Register",templateUrl:"/components/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm",loginRequired:!1}).when("/forgot-password",{title:"NativeQDA | Forgot Password",templateUrl:"/components/auth/forgotPass/forgotPass.view.html",controller:"forgotPassCtrl",controllerAs:"vm",loginRequired:!1}).when("/",{title:"NativeQDA | Home",templateUrl:"/components/home/home.view.html",controller:"homeCtrl",controllerAs:"vm",loginRequired:!0}).when("/analysis",{title:"NativeQDA | Analysis",templateUrl:"/components/analysis/analysis.view.html",controller:"analysisCtrl",controllerAs:"vm",loginRequired:!0}).when("/visualisations/:id",{title:"NativeQDA | Visualisations",templateUrl:"/components/visualisations/visualisations.view.html",controller:"visualisationsCtrl",controllerAs:"vm",loginRequired:!0}).when("/map",{title:"NativeQDA | Map",templateUrl:"/components/map/map.view.html",controller:"mapCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey",{title:"NativeQDA | Surveys",templateUrl:"/components/survey/survey.view.html",controller:"surveyCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey/new",{title:"NativeQDA | Create Survey",templateUrl:"/components/survey/newSurvey/newSurvey.view.html",controller:"newSurveyCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey/view/:accessID",{title:"NativeQDA | View Survey",templateUrl:"/components/survey/viewSurvey/viewSurvey.view.html",controller:"viewSurveyCtrl",controllerAs:"vm",loginRequired:!0}).when("/complete-survey",{title:"NativeQDA | Complete Survey",templateUrl:"/components/survey/completeSurvey/completeSurvey.view.html",controller:"completeSurveyCtrl",controllerAs:"vm",loginRequired:!1}).when("/survey/responses/:accessID",{title:"NativeQDA | Survey Responses",templateUrl:"/components/survey/surveyResponses/surveyResponses.view.html",controller:"surveyResponsesCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey/responses/:accessID/:responseID",{title:"NativeQDA | Survey Responses",templateUrl:"/components/survey/viewResponse/viewResponse.view.html",controller:"viewResponseCtrl",controllerAs:"vm",loginRequired:!0}).when("/files/upload",{title:"NativeQDA | Upload File",templateUrl:"/components/files/filesUpload/filesUpload.view.html",controller:"filesUploadCtrl",controllerAs:"vm",loginRequired:!0}).when("/files",{title:"NativeQDA | File Browser",templateUrl:"/components/files/filesBrowse/filesBrowse.view.html",controller:"filesBrowseCtrl",controllerAs:"vm",loginRequired:!0}).when("/files/:folder?/:file*",{title:"NativeQDA | File XYZ",templateUrl:"/components/files/filesBrowse/filesBrowse.view.html",controller:"filesBrowseCtrl",controllerAs:"vm",loginRequired:!0}).when("/datasets",{title:"NativeQDA | Datasets",templateUrl:"/components/files/datasets/datasets.view.html",controller:"datasetsCtrl",controllerAs:"vm",loginRequired:!0}).when("/settings/system-settings",{title:"NativeQDA | System Settings",templateUrl:"/components/settings/systemSettings/systemSettings.view.html",controller:"systemSettingsCtrl",controllerAs:"vm",loginRequired:!0}).when("/settings/user-management",{title:"NativeQDA | User Management",templateUrl:"/components/settings/userManagement/userManagement.view.html",controller:"userManagementCtrl",controllerAs:"vm",loginRequired:!0}).when("/bubble-chart/:type/:id",{title:"NativeQDA | Bubble Chart",templateUrl:"/components/visualisations/visuals/bubbleChart/bubbleChart.view.html",controller:"bubbleChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/pie-chart/:type/:id",{title:"NativeQDA | Pie Chart",templateUrl:"components/visualisations/visuals/pieChart/pieChart.view.html",controller:"pieChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/donut-chart/:type/:id",{title:"NativeQDA | Donut Chart",templateUrl:"components/visualisations/visuals/donutChart/donutChart.view.html",controller:"donutChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/radar-chart/:type/:id",{title:"NativeQDA | Radar Chart",templateUrl:"/components/visualisations/visuals/radarChart/radarChart.view.html",controller:"radarChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/treemap-chart/:type/:id",{title:"NativeQDA | Treemap Chart",templateUrl:"/components/visualisations/visuals/treemapChart/treemapChart.view.html",controller:"treemapChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/basic-table/:type/:id",{title:"NativeQDA | Basic Table",templateUrl:"/components/visualisations/visuals/basicTable/basicTable.view.html",controller:"basicTableCtrl",controllerAs:"vm",loginRequired:!0}).when("/bar-chart/:type/:id",{title:"NativeQDA | Bar Chart",templateUrl:"/components/visualisations/visuals/barChart/barChart.view.html",controller:"barChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/heatmap-example",{title:"NativeQDA | Heatmap Example",templateUrl:"/components/heatmapExample/heatmapExample.view.html",controller:"heatmapCtrl",controllerAs:"vm",loginRequired:!0}).when("/test-analysis/aylien",{title:"NativeQDA | Test Analysis - AYLIEN",templateUrl:"/components/testAnalysis/aylien/testAylien.view.html",controller:"testAylienCtrl",controllerAs:"vm",loginRequired:!0}).when("/test-analysis/watson",{title:"NativeQDA | Test Analysis - Watson",templateUrl:"/components/testAnalysis/watson/testWatson.view.html",controller:"testWatsonCtrl",controllerAs:"vm",loginRequired:!0}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}e.$inject=["$routeProvider","$locationProvider"],angular.module("nativeQDAApp",["ngRoute","ngSanitize","ngTable","ngAnimate","ui.bootstrap","ui.bootstrap.datepicker","ngFileUpload","ngTagsInput","jp.ng-bs-animated-button","bsLoadingOverlay","color.picker","swipe","angular-carousel-3d"]),angular.module("nativeQDAApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication","bsLoadingOverlayService",function(e,t,n,a){e.$on("$routeChangeStart",function(e,a,o){var r;a.loginRequired&&!n.isLoggedIn()?(r=t.path(),t.path("/login").replace(),t.search("page",r)):a.loginRequired&&n.isLoggedIn()&&(n.checkJWT(),t.path(r).replace(),r=null)}),e.$on("$routeChangeSuccess",function(t,n,a){n.$$route.title?e.title=n.$$route.title:e.title="NativeQDA"}),a.setGlobalConfig({templateUrl:"/common/views/loadingOverlayTemplate4.html",delay:300})}])}(),function(){"use strict";function e(e,t){e.errorOnUnhandledRejections(!0),toastr.options.closeButton=!0,toastr.options.timeOut=3e3,toastr.options.positionClass="toast-top-right",t.debugEnabled&&t.debugEnabled(!0)}e.$inject=["$qProvider","$logProvider"],angular.module("nativeQDAApp").config(e)}(),function(){angular.module("nativeQDAApp").directive("footerGeneric",function(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}})}(),function(){function e(e,t,n,a,o){var r=this;r.logout=function(){t.logout({email:i,desc:"Logout"}),e.path("/login")},r.popupEditProfile=function(e){a.open({templateUrl:"/components/settings/editProfile/editProfile.view.html",controller:"editProfileCtrl as vm",size:"xl",resolve:{userEmail:function(){return e}}}).result.then(function(){r.currentUser=t.currentUser()})},r.currentPath=e.path(),r.isLoggedIn=t.isLoggedIn(),r.currentUser=t.currentUser();var i=r.currentUser.email;n.event({email:i})}e.$inject=["$location","authentication","events","$uibModal","$scope"],angular.module("nativeQDAApp").controller("navigationCtrl",e)}(),function(){angular.module("nativeQDAApp").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}})}(),function(){angular.module("nativeQDAApp").directive("pageHeader",function(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}})}(),function(){angular.module("nativeQDAApp").directive("pwCheck",function(){return{require:"ngModel",link:function(e,t,n,a){var o="#"+n.pwCheck;$(t).add(o).on("keyup",function(){e.$apply(function(){var e=t.val()===$(o).val();a.$setValidity("pwcheck",e)})})}}})}(),function(){angular.module("nativeQDAApp").filter("addHtmlLineBreaks",function(){return function(e){return e.replace(/\n/g,"<br/>")}})}(),function(){angular.module("nativeQDAApp").filter("capitalise",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}})}(),function(){function e(e){return function(t,n){if(angular.isDefined(n)){var a,o=[],r=n.toLowerCase();for(a=0;a<t.length;a++){var i=t[a].name.toLowerCase(),s=t[a].createdBy.toLowerCase(),l=e("date")(t[a].lastModified,"dd MMMM, yyyy").toLowerCase();(i.indexOf(r)>=0||s.indexOf(r)>=0||l.indexOf(r)>=0)&&o.push(t[a])}return o}return t}}e.$inject=["$filter"],angular.module("nativeQDAApp").filter("fileSearch",e)}(),function(){angular.module("nativeQDAApp").filter("formatDistance",function(){return function(t){var n,a=t/1e3;return t&&e(t)?(a>1?(a=parseFloat(a).toFixed(1),n=" km"):(a=parseInt(1e3*a,10).toFixed(1),n=" m"),a+n):"?"}});var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)}}(),function(){angular.module("nativeQDAApp").filter("formatFileSize",function(){return function(e,t){if(0===e||isNaN(parseFloat(e))||!isFinite(e))return"";void 0===t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+" "+n[a]}})}(),function(){"use strict";function e(e,t,n){return{aylienConceptAnalysis:function(a){return e.post("/api/analysis/aylien/concept",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed ALYIEN concept analysis.")(e)})},watsonAnalysis:function(a){return e.post("/api/analysis/watson",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed Watson analysis.")(e)})},saveWatsonAnalysis:function(a){return e.post("/api/analysis/watson/save",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed saving the analysis.")(e)})},readWatsonAnalysis:function(a){return e.get("/api/analysis/watson/read?id="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed reading the analysis.")(e)})},listWatsonAnalysis:function(){return e.get("/api/analysis/watson/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed listing the analyses.")(e)})},deleteWatsonAnalysis:function(a){var o=encodeURIComponent(a);return e.delete("/api/analysis/watson/delete?id="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed deleting the analysis.")(e)})}}}e.$inject=["$http","authentication","exception"],angular.module("nativeQDAApp").service("analysisService",e)}(),function(){function e(e,t,n,a){function o(e){t.localStorage["nativeQDA-token"]=e}function r(){return t.localStorage["nativeQDA-token"]}function i(){var e=r();return!!e&&(JSON.parse(t.atob(e.split(".")[1])).exp<Date.now()/1e3&&swal({title:"You have been logged out",text:"Your security token has expired, please login again to continue",type:"warning",confirmButtonColor:"#d9534f",confirmButtonText:"Okay"},function(){return l(),a.path("/login"),!1}),!0)}function s(){return e.get("/api/user/last-modified",{headers:{Authorization:"Bearer "+r()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed getting the user's last modified date.")(e)})}function l(n){return t.localStorage.removeItem("nativeQDA-token"),e.post("/api/event",n)}return{currentUser:function(){if(i()){var e=r(),n=JSON.parse(t.atob(e.split(".")[1]));return{email:n.email,firstName:n.firstName,settings:n.settings,avatar:n.avatar,iat:n.iat}}},saveToken:o,getToken:r,isLoggedIn:i,checkJWT:function(){var e=r();if(e){var n=JSON.parse(t.atob(e.split(".")[1]));s().then(function(e){var t=new Date(e.data.lastModified);parseInt(t.getTime()/1e3)>n.iat&&swal({title:"You have been logged out",text:"Your security token is not up to date, please login again to continue",type:"warning",confirmButtonColor:"#d9534f",confirmButtonText:"Okay"},function(){return l(),a.path("/login"),!1})})}},lastModified:s,register:function(t){return e.post("/api/register",t).then(function(e){o(e.data.token)}).catch(function(e){return n.catcher("Registration Failed")(e)})},login:function(t){return e.post("/api/login",t).then(function(e){o(e.data.token)}).catch(function(e){return n.catcher("Login Failed")(e)})},logout:l,setavatar:function(t){return e.post("/api/user/setavatar")}}}e.$inject=["$http","$window","exception","$location"],angular.module("nativeQDAApp").service("authentication",e)}(),function(){function e(e,t,n){return{datasetCreate:function(a){return e.post("/api/analysis/data/create",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed creating the dataset.")(e)})},listDatasets:function(){return e.get("/api/analysis/data/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed listing the datasets.")(e)})},datasetReadOne:function(a){return e.get("/api/analysis/data/read/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed reading the dataset.")(e)})},deleteDatasetDB:function(a){var o=encodeURIComponent(a);return e.delete("/api/analysis/data/delete?key="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed deleting the dataset from the DB.")(e)})}}}e.$inject=["$http","authentication","exception"],angular.module("nativeQDAApp").service("datasetService",e)}(),function(){function e(e){return{event:function(t){return e.post("/api/event",t)}}}e.$inject=["$http"],angular.module("nativeQDAApp").service("events",e)}(),function(){"use strict";function e(e,t){return{catcher:function(n){return function(a){var o;return n&&(n+="\n"),a.data&&a.data.description?(o=n+a.data.description,a.data.description=o):a.data&&a.data.message?(o=n+a.data.message,a.data.message=o):a.data&&a.data.errmsg?11e3===a.data.code?o=n+"Email already exists in the database":(o=n+a.data.errmsg,a.data.errmsg=o):a.data&&a.data.error&&(o=n+a.data.error,a.data.error=o),t.error(o,a,"Error"),e.reject(a)}}}}e.$inject=["$q","logger"],angular.module("nativeQDAApp").service("exception",e)}(),function(){"use strict";function e(e,t,n){return{signUploadS3:function(a){return e.post("/api/file/signUploadS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed signing the S3 upload URL.")(e)})},addFileDB:function(a){function o(e){return e}function r(e){return n.catcher("Failed adding the file to the DB.")(e)}return"/"==a.path?e.put("/api/files/"+a.name,a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(r):e.put("/api/files/"+a.path+"/"+a.name,a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(o).catch(r)},signDownloadS3:function(a,o,r){if(r||(r=!1),"/"==o)i="/api/files/"+a+"/download?getTextFile="+r;else var i="/api/files/"+o+"/"+a+"/download?getTextFile="+r;return e.get(i,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed signing the S3 download URL.")(e)})},getFileListS3:function(){return e.get("/api/files/getFileListS3",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed listing the files from S3.")(e)})},getFileListDB:function(a){return e.get("/api/map/?getTextFile="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed listing the files from the DB.")(e)})},getFileDB:function(a,o){return o||(o=!1),e.get("/api/files/"+a+"?getTextFile="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed getting the file/folder from the DB.")(e)})},deleteFileS3:function(a){return e.post("/api/files/deleteFileS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed deleting the file from S3.")(e)})},deleteFileDB:function(a){var o=encodeURIComponent(a);return e.delete("/api/files/deleteFileDB?key="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed deleting the file from the DB.")(e)})},fileReadOneDB:function(a){return e.get("/api/files/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed reading the file form the DB.")(e)})},objectAclS3:function(a){return e.post("/api/files/objectAclS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed changing the file's permissions on S3.")(e)})},objectAclDB:function(a){return e.post("/api/files/objectAclDB",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed changing the file's permissions in the DB.")(e)})},syncDBwithS3:function(a){return e.post("/api/files/syncDBwithS3",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed syncDBwithS3.")(e)})}}}e.$inject=["$http","authentication","exception"],angular.module("nativeQDAApp").service("filesService",e)}(),function(){"use strict";function e(e){return{showToasts:!0,error:function(t,n,a){toastr.error(t,a),e.error("Error: "+t,n)},info:function(t,n,a){toastr.info(t,a),e.info("Info: "+t,n)},success:function(t,n,a){toastr.success(t,a),e.info("Success: "+t,n)},warning:function(t,n,a){toastr.warning(t,a),e.warn("Warning: "+t,n)},log:e.log}}e.$inject=["$log"],angular.module("nativeQDAApp").service("logger",e)}(),function(){"use strict";function e(e,t,n){return{putLink:function(a){return e.put("/api/map/link/",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed saving the marker link.")(e)})},getLinks:function(a){var o=a.lat,r=a.lng;return e.get("/api/map/link?lat="+o+"&lng="+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed getting the marker links.")(e)})}}}e.$inject=["$http","authentication","exception"],angular.module("nativeQDAApp").service("mapService",e)}(),function(){"use strict";function e(e,t,n){return{saveSurvey:function(a){return e.post("/api/survey/save",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed saving survey.")(e)})},readSurvey:function(a){var o=encodeURIComponent(a);return e.get("/api/survey/read?accessID="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed reading survey.")(e)})},listSurveys:function(){return e.get("/api/survey/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed listing surveys.")(e)})},deleteSurvey:function(a){var o=encodeURIComponent(a);return e.delete("/api/survey/delete?id="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed deleting survey.")(e)})},saveSurveyResponse:function(a){return e.post("/api/survey/response/save",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed saving survey response.")(e)})},readSurveyResponses:function(a){var o=encodeURIComponent(a);return e.get("/api/survey/responses/read?accessID="+o,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed reading survey response.")(e)})}}}e.$inject=["$http","authentication","exception"],angular.module("nativeQDAApp").service("surveyService",e)}(),function(){"use strict";function e(e,t,n){return{getUserInfo:function(a){return e.get("/api/user/info?email="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed getting the user's info.")(e)})},getAllUsersInfo:function(){return e.get("/api/users/info",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed getting all user's info.")(e)})},updateProfile:function(a){return e.put("/api/user",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return n.catcher("Failed updating the user's profile.")(e)})}}}e.$inject=["$http","authentication","exception"],angular.module("nativeQDAApp").service("usersService",e)}(),function(){function e(e,t,n,a,o,r,i,s){function l(){r.listWatsonAnalysis().then(function(e){p.analyses=e.data,c()},function(e){i.stop({referenceId:"analysis-list"})})}function c(){p.tableParams=new n({sorting:{dateCreated:"desc"}},{dataset:p.analyses}),i.stop({referenceId:"analysis-list"})}function u(e,t){r.deleteWatsonAnalysis(t).then(function(){d(t),s.success("'"+e+"' was deleted successfully","","Success")})}function d(e){var t=p.analyses.findIndex(function(t){return t._id==e});t>-1&&p.analyses.splice(t,1),c()}var p=this;p.getAnalysesList=l,p.confirmDelete=function(e,t){swal({title:"Are you sure?",text:"Confirm to delete the analysis '"+name+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){u(e,t)})},p.popupNewAnalysis=function(){o.open({templateUrl:"/components/analysis/newAnalysis/newAnalysis.view.html",controller:"newAnalysisCtrl as vm",size:"xl"}).result.then(function(e){p.analyses.push(e),c()})},p.analyses=[],p.pageHeader={title:"Analysis",strapline:"where the magic happens"},i.start({referenceId:"analysis-list"}),l()}e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal","analysisService","bsLoadingOverlayService","logger"],angular.module("nativeQDAApp").controller("analysisCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l){function c(){l.start({referenceId:"data-list"}),g.data=[],g.formData.selectedID=null,a.listDatasets().then(function(e){e.data.forEach(function(e){e.type="Dataset",g.data.push(e)}),u()},function(e){l.stop({referenceId:"data-list"})})}function u(){o.getFileDB(g.currentPath,"true").then(function(e){e.data.forEach(function(e){g.data.push(e)}),""!=g.currentPath&&g.data.push({name:"..",lastModified:"",createdBy:"",size:"",type:"parent-dir"}),d()},function(e){l.stop({referenceId:"data-list"})})}function d(){g.tableParams=new n({sorting:{type:"desc"}},{dataset:g.data}),l.stop({referenceId:"data-list"})}function p(){f(!0,null);var e=g.data.findIndex(function(e){return e._id===g.formData.selectedID}),t=g.data[e].name,n=g.data[e].path;g.formData.sourceDataKey=g.data[e].textFileKey,o.signDownloadS3(t,n,"true").then(function(e){r.watsonAnalysis({url:e.data.url}).then(function(e){g.analysisResults=e.data,m()},function(e){f(!1,"error")})},function(e){f(!1,"error")})}function m(){var e={name:g.formData.analysisName,description:g.formData.description,createdBy:i.currentUser().firstName,sourceDataKey:g.formData.sourceDataKey,language:g.analysisResults.language,categories:g.analysisResults.categories,concepts:g.analysisResults.concepts,entities:g.analysisResults.entities,keywords:g.analysisResults.keywords,relations:g.analysisResults.relations,semanticRoles:g.analysisResults.semantic_roles};r.saveWatsonAnalysis(e).then(function(e){s.success('Analysis "'+g.formData.analysisName+'" successfully completed',"","Success"),f(!1,"success"),setTimeout(function(){g.modal.close(e.data)},1e3)},function(e){f(!1,"error")})}function f(e,t){g.isSubmittingButton=e,g.resultButton=t,g.isProcessing=e}var g=this;g.onSubmit=function(){g.formData.analysisName&&g.formData.description?g.formData.selectedID?p():s.error("Please select data for analysis","","Error"):s.error("All fields required, please try again","","Error")},g.viewFile=function(e,n,a,r,i){if("folder"===a)g.currentPath="/"===n?e:n+"/"+e,g.pathsArray=g.currentPath.split("/"),c();else if("parent-dir"===a)g.currentPath=g.currentPath.substr(0,g.currentPath.lastIndexOf("/")),g.pathsArray=g.currentPath.split("/"),c();else if(r)g.formData.selectedID=i;else{var s=t.open("about:blank","_blank");s.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),o.signDownloadS3(e,n,"true").then(function(e){setTimeout(function(){s.document.getElementById("loader").remove()},1e3),s.location=e.data.url},function(){s.close()})}},g.data=[],g.currentPath="",g.pathsArray=[""],g.tableParams,g.formData={},g.analysisResults,g.isSubmittingButton=null,g.resultButton=null,g.analyseButtonOptions={buttonDefaultText:"Analyse",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},g.isProcessing=!1,c(),g.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}e.$inject=["$uibModalInstance","$window","NgTableParams","datasetService","filesService","analysisService","authentication","logger","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("newAnalysisCtrl",e)}(),function(){function e(e,t,n,a){function o(){n.event({email:r.credentials.email,desc:"Login"}),t.login(r.credentials).then(function(t){e.search("page",null),e.path(r.returnPage)})}var r=this;r.onSubmit=function(){if(!r.credentials.email||!r.credentials.password)return a.error("All fields required, please try again","Error","Error"),!1;o()},r.login=o,r.credentials={email:"",password:""},r.pageHeader={title:"Sign in to nativeQDA"},r.returnPage=e.search().page||"/"}angular.module("nativeQDAApp").controller("loginCtrl",e),e.$inject=["$location","authentication","events","logger"]}(),function(){function e(e,t,n){function a(){t.register(o.credentials).then(function(){e.search("page",null),e.path(o.returnPage)})}var o=this;o.onSubmit=function(){if(!(o.credentials.password&&o.credentials.email&&o.credentials.firstName&&o.credentials.lastName))return n.error("Missing fields required, please try again","","Error"),!1;a()},o.register=a,o.credentials={password:"",email:"",firstName:"",lastName:"",company:""},o.pageHeader={title:"Create a new NativeQDA account"},o.returnPage=e.search().page||"/"}angular.module("nativeQDAApp").controller("registerCtrl",e),e.$inject=["$location","authentication","logger"]}(),function(){function e(e,t){var n=this;n.onSubmit=function(){if(n.formError="",!n.email)return t.error("All fields required, please try again","","Error"),!1;t.info("TODO: verify user's email and send link to reset password","","TODO")},n.email="",n.pageHeader={title:"Forgot Password"}}angular.module("nativeQDAApp").controller("forgotPassCtrl",e),e.$inject=["authentication","logger"]}(),function(){function e(e,t,n,a,o,r,i,s){function l(){o.listDatasets().then(function(e){m.dataset=e.data,c()},function(e){s.stop({referenceId:"dataset-list"})})}function c(){m.tableParams=new a({sorting:{dateCreated:"desc"}},{dataset:m.dataset}),s.stop({referenceId:"dataset-list"})}function u(e,t){o.deleteDatasetDB(e).then(function(n){d(e,t)})}function d(e,t){i.deleteFileS3({key:e}).then(function(n){p(e),r.success('Dataset "'+t+'" was successfully deleted',"","Success")})}function p(e){var t=m.dataset.findIndex(function(t){return t.key==e});t>-1&&m.dataset.splice(t,1),c()}var m=this;m.getDatasetList=l,m.confirmDelete=function(e,t){swal({title:"Are you sure?",text:"Confirm to delete the dataset '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){u(e,t)})},m.popupViewDataset=function(e){n.open({templateUrl:"/components/files/datasets/viewDataset/viewDataset.view.html",controller:"viewDatasetCtrl as vm",size:"lg",resolve:{datasetId:function(){return e}}}).result.then(function(){})},m.popupEditDataset=function(e,t){n.open({templateUrl:"/components/files/datasets/editDataset/editDataset.view.html",controller:"editDatasetCtrl as vm",size:"xl"}).result.then(function(){})},m.popupNewDataset=function(){n.open({templateUrl:"/components/files/datasets/newDataset/newDataset.view.html",controller:"newDatasetCtrl as vm",size:"xl"}).result.then(function(e){m.dataset.push(e),c()})},m.dataset=[],m.pageHeader={title:"Datasets",strapline:"where the Datasets live"},s.start({referenceId:"dataset-list"}),l()}e.$inject=["$window","$sce","$uibModal","NgTableParams","datasetService","logger","filesService","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("datasetsCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c){function u(){a.getFileListDB("true").then(function(e){y.fileList=e.data,d()},function(e){c.stop({referenceId:"new-dataset"})})}function d(){y.tableParams=new r({sorting:{lastModified:"desc"}},{dataset:y.fileList}),c.stop({referenceId:"new-dataset"})}function p(){h(!0,null);var e=Object.keys(y.formData.checkboxes);y.datasetFiles=e.filter(function(e){return y.formData.checkboxes[e]},function(e){h(!1,"error")}),m()}function m(){var t=0,n="";y.datasetFiles.forEach(function(o){a.signDownloadS3(o).then(function(a){e.get(a.data).then(function(e){t++,n+=e.data+"\n\n",t===y.datasetFiles.length&&f(n)},function(e){h(!1,"error")})},function(e){h(!1,"error")})})}function f(e){g(new File([e],y.formData.datasetName,{type:"text/plain"}))}function g(e){a.signUploadS3({name:e.name,type:"text/plain",dataset:!0}).then(function(t){s.upload({method:"POST",url:t.data.url,fields:t.data.fields,file:e}).progress(function(e){y.currentPercentage=parseInt(100*e.loaded/e.total)}).then(function(a){console.log(y.formData.datasetName+" successfully uploaded to S3");var r=t.data.fields.key,i=t.data.url+"/"+encodeURIComponent(r);n.datasetCreate({name:y.formData.datasetName,desc:y.formData.description,size:e.size,key:r,url:i,createdBy:l.currentUser().firstName,files:y.datasetFiles}).then(function(e){h(!1,"success"),console.log(y.formData.datasetName+" successfully added to DB"),o.success('Dataset "'+y.formData.datasetName+'" was created successfully',"","Success"),setTimeout(function(){y.modal.close(e.data)},1e3)})},function(e){h(!1,"error");var t=$.parseXML(e.data);o.error($(t).find("Message").text(),"","Error"),cleanUpForNextUpload()})},function(e){h(!1,"error")})}function h(e,t){y.isSubmittingButton=e,y.resultButton=t,y.isProcessing=e}var y=this;y.onSubmit=function(){angular.isDefined(y.formData)&&y.formData.datasetName&&y.formData.description&&y.formData.checkboxes?p():o.error("All fields required, please try again","","Error")},y.viewFile=function(e){a.signDownloadS3(e).then(function(e){i.open(e.data,"_blank")})},y.formData,y.fileList=null,y.datasetFiles=null,y.isSubmittingButton=null,y.resultButton=null,y.createButtonOptions={buttonDefaultText:"Create Dataset",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},y.isProcessing=!1,c.start({referenceId:"new-dataset"}),u(),y.modal={close:function(e){t.close(e)},cancel:function(){t.dismiss("cancel")}}}e.$inject=["$http","$uibModalInstance","datasetService","filesService","logger","NgTableParams","$window","Upload","authentication","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("newDatasetCtrl",e)}(),function(){function e(e,t,n,a,o){function r(){t.datasetReadOne(n).then(function(e){i.dataset=e.data,i.dataset.files.forEach(function(e){var t=e.substring(e.indexOf("-")+1),n={};n.key=e,n.name=t,i.files.push(n)})})}var i=this;i.viewFile=function(e){a.signDownloadS3(e).then(function(e){o.open(e.data,"_blank")})},i.files=[],r(),i.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}e.$inject=["$uibModalInstance","datasetService","datasetId","filesService","$window"],angular.module("nativeQDAApp").controller("viewDatasetCtrl",e)}(),function(){function e(e,t){this.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("editDatasetCtrl",e),e.$inject=["$uibModalInstance","datasetService"]}(),function(){function e(e,t,n,a,o){function r(e,t){a.objectAclDB({key:e,acl:t}).then(function(e){i.resultButton="success",i.file.acl=t},function(e){i.resultButton="error"})}var i=this;i.updateAclS3=function(e,t){i.isSubmittingButton=!0,a.objectAclS3({key:e,acl:t}).then(function(n){r(e,t)},function(e){i.resultButton="error"})},i.isSubmittingButton=null,i.resultButton=null,i.makePublicOptions={buttonDefaultText:"Make Public",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},i.makePrivateOptions={buttonDefaultText:"Make Private",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},o.start({referenceId:"file-details"}),a.fileReadOneDB(n).then(function(e){o.stop({referenceId:"file-details"}),i.file=e.data,i.tags=i.file.tags.join(", ")}),i.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}e.$inject=["$uibModalInstance","$window","key","filesService","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("fileDetails",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u,d,p){function m(){p.start({referenceId:"file-list"}),s.getFileDB(v.currentPath).then(function(e){v.fileList=e.data,""!=v.currentPath&&v.fileList.push({name:"..",lastModified:"",createdBy:"",size:"",type:"parent-dir"}),f()},function(e){p.stop({referenceId:"file-list"})})}function f(){v.tableParams=new i({sorting:{lastModified:"desc"}},{dataset:v.fileList}),p.stop({referenceId:"file-list"})}function g(e,t,n){s.deleteFileDB(e).then(function(a){h(e,t,n)})}function h(e,t,n){s.deleteFileS3({key:e}).then(function(a){n&&n!=e&&s.deleteFileS3({key:n}),y(e),c.success("'"+t+"' was deleted successfully","","Success")})}function y(e){var t=v.fileList.findIndex(function(t){return t.key===e});t>-1&&v.fileList.splice(t,1),f()}var v=this;v.viewFile=function(e,t,a){if("folder"===a)v.currentPath="/"===t?e:t+"/"+e,v.pathsArray=v.currentPath.split("/"),m();else if("parent-dir"===a)v.currentPath=v.currentPath.substr(0,v.currentPath.lastIndexOf("/")),v.pathsArray=v.currentPath.split("/"),m();else{var o=n.open("about:blank","_blank");o.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),s.signDownloadS3(e,t).then(function(e){if(setTimeout(function(){o.document.getElementById("loader").remove()},1e3),"document"===e.data.type){var t="https://docs.google.com/viewer?url="+encodeURIComponent(e.data.url)+"&embedded=true";o.location=t}else o.location=e.data.url},function(){o.close()})}},v.confirmDelete=function(e,t,n){swal({title:"Are you sure?",text:"Confirm to delete the file '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){g(e,t,n)})},v.popupFileDetails=function(e){o.open({templateUrl:"/components/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}}).result.then(function(){})},v.getFileListS3=function(){s.getFileListS3().then(function(e){doListFilesS3(e.data.Contents)})},v.newFolder=function(){swal({title:"New Folder",text:"Please enter a name for this folder",type:"input",confirmButtonColor:"#5cb85c",showCancelButton:!0,closeOnConfirm:!1,allowOutsideClick:!0,animation:"slide-from-top",inputPlaceholder:"New Folder"},function(e){if(!1===e)return!1;if(""===e)return swal.showInputError("You need to write something!"),!1;var t={name:e,path:v.currentPath,type:"folder",createdBy:l.currentUser().firstName,icon:"fa fa-folder-o"};s.addFileDB(t).then(function(e){swal.close(),console.log(t.name+" folder successfully added to DB"),c.success(t.name+" folder successfully created","","Success"),v.fileList.push(e.data),f()})})},v.openFolder=function(e){for(var t="",n=0;n<e+1;n++)t+=v.pathsArray[n],n!=e&&(t+="/");v.currentPath=t,v.pathsArray=v.currentPath.split("/"),m()},v.fileList=[],v.currentPath="",v.pathsArray=[""],v.pageHeader={title:"Browse Files"},m()}e.$inject=["mapService","$http","$window","$scope","$uibModal","Upload","NgTableParams","filesService","authentication","logger","$filter","$compile","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("filesBrowseCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u,d,p){function m(){initial_loading_screen.loaded?f():setTimeout(m,100)}function f(){p.start({referenceId:"upload-map"}),g()}function g(){var e={center:[-34.4054039,150.87842999999998],zoom:4};N.map=L.map("map-files-page",e);var t=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}).addTo(N.map),s=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22})),l=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),c=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),p=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),m=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),f=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),g=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),v=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),b=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});b.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":t,"Mapbox Dark":n,"Mapbox Satellite":a,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":r,"Mapbox Streets Basic":i,"Mapbox Outdoors":s,"Mapbox Run Bike Hike":l,"Mapbox Pencil":c,"Mapbox Pirates":u,"Mapbox Emerald":d,"Mapbox High Contrast":p,"Google Roadmap":m,"Google Aerial":f,"Google Terrain":g,"Google Hybrid":v,"Google Traffic":b},{},{collapsed:!0}).addTo(N.map),N.posMarker=L.marker([N.lat,N.lng],{icon:J,draggable:!0,zIndexOffset:1e3}).addTo(N.map).bindTooltip("<strong>File Upload Position</strong>").bindPopup("<p>Drag me to change the file upload position</p>"),N.posMarker.on("drag",function(e){h(e)}),N.map.on("click",function(e){N.posMarker.setLatLng(e.latlng),h(e)}),y(),w()}function h(e){N.posMarkerMoved||(N.posMarkerMoved=!0,N.posMarker.setPopupContent("<p>Drag me to change the file upload position</p>")),N.lat=e.latlng.lat,N.lng=e.latlng.lng,a.$apply()}function y(e){N.map.on("locationfound",v),N.map.on("locationerror",b),N.map.locate({setView:!0,maxZoom:15})}function v(e){var t=e.latlng,n=e.accuracy/2;N.lat=t.lat,N.lng=t.lng,a.$apply();var o=n<9?22:n>8&&n<17?21:n>16&&n<32?20:n>31&&n<63?19:n>62&&n<126?18:n>125&&n<251?17:n>250&&n<551?16:n>550&&n<1101?15:n>1100&&n<2201?14:n>2200&&n<4401?13:n>4400&&n<8801?12:n>8800&&n<17601?11:n>17600&&n<35201?10:n>35200&&n<70401?9:n>70400&&n<140801?8:n>140800&&n<281601?7:n>281600&&n<563201?6:n>563200&&n<1126401?5:n>1126400&&n<2252801?4:n>2252800&&n<4505601?3:n>4505600&&n<9011201?2:1;N.posMarker.setLatLng(t),N.posMarker.setPopupContent("\t<p>You are within "+u("formatDistance")(n)+" from this point<br />Drag me to change the file upload position</p>");var r=L.circle(t,{radius:n,color:"#cb2529"});N.posMarker.on("popupopen",function(){N.posMarkerMoved||(r.addTo(N.map),N.map.setView(t,o))}),N.posMarker.on("popupclose",function(){N.posMarkerMoved||N.map.removeLayer(r)}),c.success("User's location found",e,"Success")}function b(e){c.error(e.message,e,"Error")}function w(){s.getFileListDB().then(function(e){N.fileList=e.data,x()},function(e){p.stop({referenceId:"upload-map"})})}function x(){N.fileList.forEach(function(e){var t=e.coords.coordinates[1],n=e.coords.coordinates[0],a=L.marker([t,n],{icon:z}).bindTooltip("<strong>File Name:</strong> "+e.name+"<br /><strong>Created By:</strong> "+e.createdBy+"<br /><strong>Last Modified:</strong> "+u("date")(e.lastModified,"dd MMMM, yyyy h:mm a"));a.on("click ",function(){N.posMarker.setLatLng([t,n]),h({latlng:{lat:t,lng:n}})}),N.markers.addLayer(a)}),N.map.addLayer(N.markers),p.stop({referenceId:"upload-map"})}function k(){function e(e){return PDFJS.getDocument({data:e}).then(function(e){for(var t=e.pdfInfo.numPages,n=[],a=1;a<=t;a++){var o=e.getPage(a);n.push(o.then(function(e){return e.getTextContent().then(function(e){return e.items.map(function(e){return e.str}).join("")})}))}return Promise.all(n).then(function(e){return e.join("")})})}var t=new FileReader;t.onload=function(){e(this.result).then(function(e){D(e)},function(e){I(!1,"error"),a.$apply(),c.error(e.message,e,"Error"),T()})},t.readAsArrayBuffer(N.file)}function C(){var e=new DocxJS;e.parse(N.file,function(){e.getPlainText(function(e){D(e)})},function(e){I(!1,"error"),c.error(e.msg,e,"Error"),T()})}function D(e){var t=N.fileInfo.name.replace(/\.[^/.]+$/,"");t+=".txt",N.textFile=new File([e],t,{type:"text/plain; charset=utf-8"}),N.textFileInfo={name:N.textFile.name,type:N.textFile.type},A()}function A(){s.signUploadS3(N.textFileInfo).then(function(e){r.upload({method:"POST",url:e.data.url,fields:e.data.fields,file:N.textFile}).then(function(t){console.log(N.textFileInfo.name+" successfully uploaded to S3"),N.textFileInfo.key=e.data.fields.key,N.fileInfo.key=N.textFileInfo.key.substring(0,N.textFileInfo.key.indexOf("-")),N.fileInfo.key+="-"+N.fileInfo.name,M()},function(e){var t=$.parseXML(e.data);I(!1,"error"),c.error($(t).find("Message").text(),"","Error"),T()})},function(e){I(!1,"error")})}function M(){s.signUploadS3(N.fileInfo).then(function(e){r.upload({method:"POST",url:e.data.url,fields:e.data.fields,file:N.file}).progress(function(e){N.currentPercentage=parseInt(100*e.loaded/e.total)}).then(function(t){console.log(N.fileInfo.name+" successfully uploaded to S3");$.parseXML(t.data);var n=N.tags.map(function(e){return e.text}),a=e.data.fields.key,o=e.data.url+"/"+encodeURIComponent(a),r={name:N.fileInfo.name,path:N.fileInfo.path,type:N.fileInfo.typeDB,key:a,size:N.file.size,url:o,createdBy:l.currentUser().firstName,coords:{lat:N.lat,lng:N.lng},tags:n,icon:N.fileInfo.icon};N.textFileInfo.key&&(r.textFileKey=N.textFileInfo.key),N.fileInfo.isTxtFile&&(r.textFileKey=a),s.addFileDB(r).then(function(e){I(!1,"success"),N.fileList.push(e.data),console.log(N.fileInfo.name+" successfully added to DB"),c.success(N.fileInfo.name+" successfully uploaded","","Success"),S(),T()})},function(e){I(!1,"error");var t=$.parseXML(e.data);c.error($(t).find("Message").text(),"","Error"),T()})},function(e){I(!1,"error")})}function S(){N.markers.clearLayers(),x()}function T(){N.file=null,N.fileInfo={},N.textFile={},N.textFileInfo={},document.getElementById("file-upload-input").value=""}function I(e,t){N.isSubmittingButton=e,N.resultButton=t,N.isProcessing=e}var N=this;N.onFileSelect=function(e){e.length>0&&(e[0].size<10485760?(N.file=e[0],N.fileInfo={name:N.file.name,type:N.file.type},"text/plain"===N.fileInfo.type&&(N.fileInfo.type="text/plain; charset=utf-8")):(c.error("Maximum file size is 10 MB. \nPlease select a smaller file.","","Error"),T()))},N.uploadFile=function(){if(N.file)switch(I(!0,null),N.fileInfo.name.split(".").pop().toLowerCase()){case"pdf":N.fileInfo.typeDB="document",N.fileInfo.icon="fa fa-file-pdf-o",k();break;case"docx":N.fileInfo.typeDB="document",N.fileInfo.icon="fa fa-file-word-o",C();break;case"doc":N.fileInfo.typeDB="document",N.fileInfo.icon="fa fa-file-word-o",M();break;case"txt":N.fileInfo.typeDB="text",N.fileInfo.icon="fa fa-file-text-o",N.fileInfo.isTxtFile=!0,M();break;case"gif":case"jpg":case"jpeg":case"png":case"bmp":case"tif":N.fileInfo.typeDB="image",N.fileInfo.icon="fa fa-file-image-o",M();break;default:N.fileInfo.typeDB="file",N.fileInfo.icon="fa fa-file-o",M()}else c.error("Please select a file to upload.","","Error")},N.map=null,N.marker=null,N.markers=L.markerClusterGroup({showCoverageOnHover:!1}),N.posMarker=null,N.posMarkerMoved=!1,N.fileList=null,N.lat=-34.4054039,N.lng=150.87842999999998,N.tags=[],N.address="",N.formattedAddress="",N.currentPercentage="0",N.file=null,N.fileInfo={},N.textFile={},N.textFileInfo={},N.pageHeader={title:"Upload Files"},N.isSubmittingButton=null,N.resultButton=null,N.uploadButtonOptions={buttonDefaultText:"Upload",animationCompleteTime:1e3,buttonSubmittingText:"Uploading...",buttonSuccessText:"Done!"},N.isProcessing=!1;var P=L.Icon.extend({options:{shadowUrl:"assets/img/map/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),z=new P({iconUrl:"assets/img/map/markers/marker-icon-2x.png"}),J=new P({iconUrl:"assets/img/map/markers/marker-icon-pos.png"});m()}e.$inject=["mapService","$http","$window","$scope","$uibModal","Upload","NgTableParams","filesService","authentication","logger","$filter","$compile","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("filesUploadCtrl",e)}(),function(){function e(e,t,n){var a=this,o=10;n.event({email:t.currentUser().email}),a.radiusValue=100,a.opacityValue=.6,a.bothOver=!0,a.fatherOver=!0,a.MotherOver=!0,a.bothAus=!0,function(e,t){var n=new google.maps.LatLng(e,t),r=document.getElementById("map"),i={center:n,zoom:o,panControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}},s=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:9029},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:358},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:3235},{location:new google.maps.LatLng(-33.76288,150.99212),weight:7427},{location:new google.maps.LatLng(-33.771,150.9063),weight:21538},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:4163},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:8865},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:1618},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:5627},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:3383},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:27386},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:11435},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:1552},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:979},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}],l=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:187},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:18},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:64},{location:new google.maps.LatLng(-33.76288,150.99212),weight:141},{location:new google.maps.LatLng(-33.771,150.9063),weight:224},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:130},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:202},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:96},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:132},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:165},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:179},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:123},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:107},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:128},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}],c=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:129},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:15},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:53},{location:new google.maps.LatLng(-33.76288,150.99212),weight:127},{location:new google.maps.LatLng(-33.771,150.9063),weight:151},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:106},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:173},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:60},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:83},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:98},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:145},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:98},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:59},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:95},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}],u=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:68},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:13},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:45},{location:new google.maps.LatLng(-33.76288,150.99212),weight:66},{location:new google.maps.LatLng(-33.771,150.9063),weight:99},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:62},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:116},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:65},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:69},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:96},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:84},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:43},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:47},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:106},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110}],d=new google.maps.Map(r,i),p=new google.maps.visualization.HeatmapLayer,m=null,f=document.getElementById("radius-slider"),g=document.getElementById("opacity-slider");noUiSlider.create(f,{start:a.radiusValue,connect:[!0,!1],step:1,range:{min:0,max:200}}),noUiSlider.create(g,{start:a.opacityValue,connect:[!0,!1],step:.01,range:{min:0,max:1}}),f.noUiSlider.on("change",function(e,t,n){a.radiusValue=n[t],p.set("radius",a.radiusValue)}),g.noUiSlider.on("update",function(e,t,n){a.opacityValue=n[t],p.set("opacity",a.opacityValue)}),a.updateMap=function(){p&&p.setMap(null);var e=[];a.bothOver&&Array.prototype.push.apply(e,s),a.fatherOver&&Array.prototype.push.apply(e,l),a.MotherOver&&Array.prototype.push.apply(e,c),a.bothAus&&Array.prototype.push.apply(e,u),p.setData(e),p.setOptions({radius:a.radiusValue,opacity:a.opacityValue,gradient:m}),p.setMap(d)},a.removeGrtSyd=function(){a.rmGrtSyd?(s.pop(),l.pop(),c.pop(),u.pop()):(s.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}),l.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}),c.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}),u.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110})),a.updateMap()},a.changeGradient=function(){m=a.changeGrad?["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]:null,a.updateMap()},a.updateMap()}(-33.848192,151.061857)}angular.module("nativeQDAApp").controller("heatmapCtrl",e),e.$inject=["$scope","authentication","events"]}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c){function u(){initial_loading_screen.loaded?d():setTimeout(u,100)}function d(){s.start({referenceId:"home-map"}),s.start({referenceId:"file-list"}),p(),k()}function p(){var e={center:[-34.4054039,150.87842999999998],zoom:4};C.map=L.map("map-homepage",e);var t=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}).addTo(C.map),s=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22})),l=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),c=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),p=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),f=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),g=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),y=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),v=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),b=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});b.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":t,"Mapbox Dark":n,"Mapbox Satellite":a,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":r,"Mapbox Streets Basic":i,"Mapbox Outdoors":s,"Mapbox Run Bike Hike":l,"Mapbox Pencil":c,"Mapbox Pirates":u,"Mapbox Emerald":d,"Mapbox High Contrast":p,"Google Roadmap":f,"Google Aerial":g,"Google Terrain":y,"Google Hybrid":v,"Google Traffic":b},{},{collapsed:!0}).addTo(C.map),m(),h()}function m(e){C.map.on("locationfound",f),C.map.on("locationerror",g),C.map.locate({setView:!0,maxZoom:15})}function f(e){var t=e.accuracy/2,a=t<9?22:t>8&&t<17?21:t>16&&t<32?20:t>31&&t<63?19:t>62&&t<126?18:t>125&&t<251?17:t>250&&t<551?16:t>550&&t<1101?15:t>1100&&t<2201?14:t>2200&&t<4401?13:t>4400&&t<8801?12:t>8800&&t<17601?11:t>17600&&t<35201?10:t>35200&&t<70401?9:t>70400&&t<140801?8:t>140800&&t<281601?7:t>281600&&t<563201?6:t>563200&&t<1126401?5:t>1126400&&t<2252801?4:t>2252800&&t<4505601?3:t>4505600&&t<9011201?2:1,o=e.latlng,r=L.marker(o,{icon:M,zIndexOffset:-500}).addTo(C.map).bindPopup("You are within "+n("formatDistance")(t)+" from this point").bindTooltip("<strong>Your Position</strong>"),s=L.circle(o,{radius:t,color:"#cb2529"});r.on("popupopen",function(){s.addTo(C.map),C.map.setView(o,a)}),r.on("popupclose",function(){C.map.removeLayer(s)}),i.success("User's location found",e,"Success")}function g(e){i.error(e.message,e,"Error")}function h(){e.getFileListDB().then(function(e){C.fileList=e.data,y(),v()},function(e){s.stop({referenceId:"file-list"}),s.stop({referenceId:"home-map"})})}function y(){C.tableParams=new l({count:5,page:1,sorting:{lastModified:"desc"}},{counts:[],dataset:C.fileList}),s.stop({referenceId:"file-list"})}function v(){C.markers=L.markerClusterGroup({showCoverageOnHover:!1}),C.fileList.forEach(function(e){var o=e.coords.coordinates[1],r=e.coords.coordinates[0],i=L.marker([o,r],{icon:A}),s='<div class="info-window"><h3>'+e.name+"</h3><p><strong>Created By:</strong> "+e.createdBy+"<br /><strong>Size:</strong> "+n("formatFileSize")(e.size,2)+"<br /><strong>Last Modified:</strong> "+n("date")(e.lastModified,"dd MMMM, yyyy h:mm a");0!=e.tags.length?(s+="<br /><strong>Tags:</strong> ",s+=e.tags.join(", ")+"</p>"):s+="</p>",s+='<a ng-click="vm.viewFile(fileName, filePath)" class="btn btn-success" role="button">View</a> <a ng-click="vm.popupFileDetails(fileKey)" class="btn btn-primary" role="button">Details</a> <a ng-click="vm.confirmDelete(fileKey, fileName, textFileKey)" class="btn btn-danger" role="button">Delete</a></div>';var l=a(angular.element(s)),c=t.$new();if(c.fileKey=e.key,c.fileName=e.name,c.filePath=e.path,i.bindPopup(l(c)[0]),1!=L.Browser.mobile){var u="<strong>File Name:</strong> "+e.name+"<br /><strong>Created By:</strong> "+e.createdBy+"<br /><strong>Last Modified:</strong> "+n("date")(e.lastModified,"dd MMMM, yyyy h:mm a");i.bindTooltip(u)}i.on("popupopen",function(){C.currentMarker=this;var e=i.getTooltip();e&&e.setOpacity(0)}),i.on("popupclose",function(){C.currentMarker=null;var e=i.getTooltip();e&&e.setOpacity(.9)}),C.markers.addLayer(i)}),C.map.addLayer(C.markers),s.stop({referenceId:"home-map"})}function b(t,n,a){e.deleteFileDB(t).then(function(e){w(t,n,a)})}function w(t,n,a){e.deleteFileS3({key:t}).then(function(o){a&&a!=t&&e.deleteFileS3({key:a}),x(),i.success("'"+n+"' was deleted successfully","","Success")})}function x(){C.markers.removeLayer(C.currentMarker)}function k(){c.listWatsonAnalysis().then(function(e){C.URL_ID=e.data[Math.floor(Math.random()*e.data.length)]._id})}var C=this;C.getFileList=h,C.viewFile=function(t,n){var a=o.open("about:blank","_blank");a.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),e.signDownloadS3(t,n).then(function(e){if(setTimeout(function(){a.document.getElementById("loader").remove()},1e3),"document"===e.data.type){var t="https://docs.google.com/viewer?url="+encodeURIComponent(e.data.url)+"&embedded=true";a.location=t}else a.location=e.data.url},function(){a.close()})},C.popupFileDetails=function(e){r.open({templateUrl:"/components/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}}).result.then(function(){})},C.confirmDelete=function(e,t,n){swal({title:"Are you sure?",text:"Confirm to delete the file '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){b(e,t,n)})},C.map=null,C.markers=[],C.currentMarker=null,C.fileList=[],C.pageHeader={title:"Dashboard",strapline:"summary of recent activity"};var D=L.Icon.extend({options:{shadowUrl:"assets/img/map/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),A=new D({iconUrl:"assets/img/map/markers/marker-icon-2x.png"}),M=new D({iconUrl:"assets/img/map/markers/marker-icon-pos.png"});u()}e.$inject=["filesService","$scope","$filter","$compile","$window","$uibModal","logger","bsLoadingOverlayService","NgTableParams","analysisService"],angular.module("nativeQDAApp").controller("homeCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l){function c(){T>50?u():initial_loading_screen.loaded?u():(T++,setTimeout(c,100))}function u(){s.start({referenceId:"map"}),d()}function d(){var e={center:[-34.4054039,150.87842999999998],zoom:4};D.map=L.map("map",e);var t=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}).addTo(D.map),s=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22})),l=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),c=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),m=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),f=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),h=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),y=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),v=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),b=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});b.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":t,"Mapbox Dark":n,"Mapbox Satellite":a,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":r,"Mapbox Streets Basic":i,"Mapbox Outdoors":s,"Mapbox Run Bike Hike":l,"Mapbox Pencil":c,"Mapbox Pirates":u,"Mapbox Emerald":d,"Mapbox High Contrast":m,"Google Roadmap":f,"Google Aerial":h,"Google Terrain":y,"Google Hybrid":v,"Google Traffic":b},{},{collapsed:!0}).addTo(D.map),D.posMarker=L.marker([D.lat,D.lng],{icon:S,zIndexOffset:-500}).bindTooltip("<strong>Your Position</strong>");L.control.sidebar("sidebar").addTo(D.map);p(),g()}function p(e){D.map.on("locationfound",m),D.map.on("locationerror",f),D.map.locate({setView:!0,maxZoom:15})}function m(e){var t=e.accuracy/2,a=t<9?22:t>8&&t<17?21:t>16&&t<32?20:t>31&&t<63?19:t>62&&t<126?18:t>125&&t<251?17:t>250&&t<551?16:t>550&&t<1101?15:t>1100&&t<2201?14:t>2200&&t<4401?13:t>4400&&t<8801?12:t>8800&&t<17601?11:t>17600&&t<35201?10:t>35200&&t<70401?9:t>70400&&t<140801?8:t>140800&&t<281601?7:t>281600&&t<563201?6:t>563200&&t<1126401?5:t>1126400&&t<2252801?4:t>2252800&&t<4505601?3:t>4505600&&t<9011201?2:1,o=e.latlng;D.posMarker.setLatLng(o),D.posMarker.bindPopup("<p>You are within "+n("formatDistance")(t)+" from this point</p>"),D.posMarker.addTo(D.map);var r=L.circle(o,{radius:t,color:"#cb2529"});D.posMarker.on("popupopen",function(){r.addTo(D.map),D.map.setView(o,a)}),D.posMarker.on("popupclose",function(){D.map.removeLayer(r)}),i.success("User's location found",e,"Success")}function f(e){i.error(e.message,e,"Error")}function g(){e.getFileListDB().then(function(e){D.fileList=e.data,y()},function(e){s.stop({referenceId:"map"})})}function h(){D.linkList.forEach(function(e){var t=L.polyline([[e.dependent.coords.coordinates[1],e.dependent.coords.coordinates[0]],[e.precedent.coords.coordinates[1],e.precedent.coords.coordinates[0]]],{color:"#4676fa",weight:8}).addTo(D.map);D.arrows.push(t);var a="<strong>Name:</strong> "+e.name+"<br /><strong>Description:</strong> "+e.description+"<br /><strong>Last Modified:</strong> "+n("date")(e.dateCreated,"dd MMMM, yyyy h:mm a");t.bindTooltip(a,{sticky:!0});var o=L.polylineDecorator(t,{patterns:[{offset:"100%",repeat:0,symbol:L.Symbol.arrowHead({pixelSize:15,polygon:!1,pathOptions:{stroke:!0,weight:8,color:"#4676fa"}})}]}).addTo(D.map);D.arrowHeads.push(o)})}function y(){D.markers=L.markerClusterGroup({showCoverageOnHover:!1}),D.fileList.forEach(function(e){var o=e.coords.coordinates[1],r=e.coords.coordinates[0],i=L.marker([o,r],{icon:M}),s='<div class="info-window"><h3>'+e.name+"</h3><p><strong>Created By:</strong> "+e.createdBy+"<br /><strong>Size:</strong> "+n("formatFileSize")(e.size,2)+"<br /><strong>Last Modified:</strong> "+n("date")(e.lastModified,"dd MMMM, yyyy h:mm a");0!=e.tags.length?(s+="<br /><strong>Tags:</strong> ",s+=e.tags.join(", ")+"</p>"):s+="</p>",s+='<a ng-click="vm.viewFile(fileKey)" class="btn btn-success" role="button">View</a> <a ng-click="vm.popupFileDetails(fileKey)" class="btn btn-primary" role="button">Details</a> <a ng-click="vm.confirmDelete(fileKey, fileName, textFileKey)" class="btn btn-danger" role="button">Delete</a><a ng-click="vm.selectDependent(precedent)" class="btn btn-primary" role="button">Add Dependent</a><a ng-click="vm.toggleDependecies(fileCoords)" class="btn btn-primary" role="button">Toggle Dependecies</a></div>';var l=a(angular.element(s)),c=t.$new();if(c.fileKey=e.key,c.fileName=e.name,c.fileCoords={lat:o,lng:r},c.precedent={fileID:e._id,lat:o,lng:r},i.bindPopup(l(c)[0]),1!=L.Browser.mobile){var u="<strong>File Name:</strong> "+e.name+"<br /><strong>Created By:</strong> "+e.createdBy+"<br /><strong>Last Modified:</strong> "+n("date")(e.lastModified,"dd MMMM, yyyy h:mm a");i.bindTooltip(u)}i.on("popupopen",function(){D.currentMarker=this;var e=i.getTooltip();e&&e.setOpacity(0)}),i.on("popupclose",function(){D.currentMarker=null;var e=i.getTooltip();e&&e.setOpacity(.9),C()}),D.markers.addLayer(i)}),D.map.addLayer(D.markers),s.stop({referenceId:"map"})}function v(t,n,a){e.deleteFileDB(t).then(function(e){b(t,n,a)})}function b(t,n,a){e.deleteFileS3({key:t}).then(function(o){a&&a!=t&&e.deleteFileS3({key:a}),w(),i.success("'"+n+"' was deleted successfully","","Success")})}function w(){D.markers.removeLayer(D.currentMarker)}function x(){D.map.removeLayer(D.markers),D.markers=null}function k(e,t){var n={precedent:e,dependent:t};l.putLink(n).then(function(){i.success("The dependecy has been save","","Success")})}function C(){D.dependeciesHidden=!0,D.arrows.forEach(function(e){D.map.removeLayer(e)}),D.arrowHeads.forEach(function(e){D.map.removeLayer(e)}),document.getElementsByClassName("leaflet-popup")[0].style.opacity=1}var D=this;D.getFileList=g,D.viewFile=function(t){e.signDownloadS3(t).then(function(e){o.open(e.data,"_blank")})},D.popupFileDetails=function(e){r.open({templateUrl:"/components/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}}).result.then(function(){})},D.confirmDelete=function(e,t,n){swal({title:"Are you sure?",text:"Confirm to delete the file '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){v(e,t,n)})},D.selectDependent=function(e){D.addingDependent=!0,x(),D.markers=L.markerClusterGroup({showCoverageOnHover:!1}),D.fileList.forEach(function(t){if(t.coords.coordinates[1]!=e.lat&&t.coords.coordinates[0]!=e.lng){var a=t.coords.coordinates[1],o=t.coords.coordinates[0],r=L.marker([a,o],{icon:M}),i="<strong>File Name:</strong> "+t.name+"<br /><strong>Created By:</strong> "+t.createdBy+"<br /><strong>Last Modified:</strong> "+n("date")(t.lastModified,"dd MMMM, yyyy h:mm a");r.bindTooltip(i),r.on("click",function(){var n={fileID:t._id,lat:t.coords.coordinates[1],lng:t.coords.coordinates[0]};k(e,n)}),D.markers.addLayer(r)}}),D.map.addLayer(D.markers)},D.toggleDependecies=function(e){D.dependeciesHidden?l.getLinks(e).then(function(e){document.getElementsByClassName("leaflet-popup")[0].style.opacity=.3,D.dependeciesHidden=!1,D.linkList=e.data,h()}):C()},D.hideDependecies=C,D.map=null,D.fileList=null,D.markers=[],D.posMarker=null,D.lat=-34.4054039,D.lng=150.87842999999998,D.currentMarker=null,D.addingDependent=!1,D.dependeciesHidden=!0,D.arrows=[],D.arrowHeads=[];var A=L.Icon.extend({options:{shadowUrl:"assets/img/map/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),M=new A({iconUrl:"assets/img/map/markers/marker-icon-2x.png"}),S=new A({iconUrl:"assets/img/map/markers/marker-icon-pos.png"}),T=0;c()}e.$inject=["filesService","$scope","$filter","$compile","$window","$uibModal","logger","bsLoadingOverlayService","mapService"],angular.module("nativeQDAApp").controller("mapCtrl",e)}(),function(){function e(e,t,n,a,o,r,i,s,l,c){function u(){a.getUserInfo(n).then(function(e){o.stop({referenceId:"user-info"}),h.userInfo=e.data},function(e){o.stop({referenceId:"user-info"})})}function d(){f(!0,null),h.file?p():m()}function p(){s.signUploadS3(h.fileInfo).then(function(e){l.upload({method:"POST",url:e.data.url,fields:e.data.fields,file:h.file}).then(function(t){console.log(h.fileInfo.name+" successfully uploaded to S3");$.parseXML(t.data);var n=e.data.fields.key;h.userInfo.avatar=e.data.url+"/"+encodeURIComponent(n),m()},function(e){f(!1,"error");var t=$.parseXML(e.data);r.error($(t).find("Message").text(),"","Error"),g()})},function(e){f(!1,"error")})}function m(){a.updateProfile(h.userInfo).then(function(e){i.saveToken(e.data),f(!1,"success"),console.log("Successfully updated profile"),r.success("Successfully updated profile","","Success"),g(),setTimeout(function(){h.modal.close(e.data)},1e3)})}function f(e,t){h.isSubmittingButton=e,h.resultButton=t,h.isProcessing=e}function g(){h.file=null,h.fileInfo={},h.textFile={},h.textFileInfo={},document.getElementById("file-upload-input").value=""}var h=this;h.getUserInfo=u,h.onAvatarSelect=function(e){if(e.length>0)if(h.file=e[0],h.file.size<10485760){var t=h.file.name.split(".").pop().toLowerCase();switch(t){case"gif":case"jpg":case"jpeg":case"png":case"bmp":h.file=e[0],h.fileInfo={name:h.userInfo.firstName+"-avatar."+t,type:h.file.type,readType:"public-read",avatar:!0};var n=new FileReader;n.onload=function(e){document.getElementById("upload-avatar-container").style.backgroundImage="url('"+e.target.result+"')",document.getElementById("upload-avatar").src=e.target.result},n.readAsDataURL(h.file);break;default:r.error("The selected file is not a supported image file","","Error"),g()}}else r.error("Maximum file size is 10 MB. \nPlease select a smaller file.","","Error"),g()},h.onSubmit=function(){h.userInfo.firstName?h.userInfo.lastName?h.userInfo.email?!h.userInfo.password&&h.profileForm.password.$dirty?r.error("Please enter a password","","Error"):!h.userInfo.confirmPassword&&h.profileForm.confirmPassword.$dirty?r.error("Please confirm your password","","Error"):""===h.userInfo.password||""===h.userInfo.confirmPassword?r.error("Password cannot be blank","","Error"):h.userInfo.password!=h.userInfo.confirmPassword?r.error("Passwords do not match","","Error"):d():r.error("Please enter a valid email address","","Error"):r.error("Please enter your last name","","Error"):r.error("Please enter your first name","","Error")},h.togglePassword=function(){!1===h.changePassword?h.changePassword=!0:(h.changePassword=!1,h.userInfo.confirmPassword=null,h.userInfo.password=null,h.profileForm.confirmPassword.$setPristine(),h.profileForm.password.$setPristine())},h.userInfo={},h.isSubmittingButton=null,h.resultButton=null,h.saveProfileButtonOptions={buttonDefaultText:"Save Profile",animationCompleteTime:1e3,buttonSubmittingText:"Saving...",buttonSuccessText:"Done!"},h.isProcessing=!1,h.changePassword=!1,o.start({referenceId:"user-info"}),u(),h.modal={close:function(){t.close()},cancel:function(){t.dismiss("cancel")}}}e.$inject=["$scope","$uibModalInstance","userEmail","usersService","bsLoadingOverlayService","logger","authentication","filesService","Upload","$animate"],angular.module("nativeQDAApp").controller("editProfileCtrl",e)}(),function(){angular.module("nativeQDAApp").controller("systemSettingsCtrl",function(){this.pageHeader={title:"System Settings",strapline:"change how things work"}})}(),function(){"use strict";function e(e,t,n,a){function o(){a.getAllUsersInfo().then(function(e){i.userList=e.data,r()},function(e){t.stop({referenceId:"user-list"})})}function r(){i.tableParams=new e({sorting:{lastModified:"desc"}},{dataset:i.userList}),t.stop({referenceId:"user-list"})}var i=this;i.confirmDelete=function(){console.log("Delete me!")},i.popupNewUser=function(){n.open({templateUrl:"/components/settings/userManagement/registerNewUser/registerNewUser.view.html",controller:"registerNewUserCtrl as vm",size:"xl"}).result.then(function(e){i.analyses.push(e),r()})},i.userList=[],i.pageHeader={title:"User Management",strapline:"manage users of the system"},t.start({referenceId:"user-list"}),o()}e.$inject=["NgTableParams","bsLoadingOverlayService","$uibModal","usersService"],angular.module("nativeQDAApp").controller("userManagementCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(){o.register(c.credentials).then(function(){s.search("page",null),s.path(c.returnPage)})}var c=this;c.onSubmit=function(){if(!(c.credentials.password&&c.credentials.email&&c.credentials.firstName&&c.credentials.lastName))return r.error("Missing fields required, please try again","","Error"),!1;l()},c.register=l,c.data=[],c.currentPath="",c.pathsArray=[""],c.tableParams,c.formData={},c.isSubmittingButton=null,c.resultButton=null,c.registerButtonOptions={buttonDefaultText:"Register",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},c.isProcessing=!1,c.credentials={password:"",email:"",firstName:"",lastName:"",company:""},c.pageHeader={title:"Create a new NativeQDA account"},c.returnPage=s.search().page||"/"}e.$inject=["$uibModalInstance","$window","NgTableParams","usersService","authentication","logger","bsLoadingOverlayService","$location"],angular.module("nativeQDAApp").controller("registerNewUserCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(e){n.readSurvey(e).then(function(e){r.surveyFound=!0,o(e.data)})}function o(t){Survey.Survey.cssType="bootstrap",Survey.defaultBootstrapCss.navigationButton="btn btn-green";var a=JSON.parse(t.surveyJSON);window.survey=new Survey.Model(a),survey.onComplete.add(function(t){r.surveyComplete=!0;var a={accessID:r.surveyCode,responseJSON:JSON.stringify(t.data)};n.saveSurveyResponse(a).then(function(t){e.success("Survey saved successfully.\nThank you for participating.","","Success")})}),survey.render("surveyElement")}var r=this;r.onSubmit=function(){if(!r.surveyCode)return e.error("All fields required, please try again","","Error"),!1;a(r.surveyCode)},r.surveyCode="",r.surveyFound=!1,r.surveyComplete=!1}e.$inject=["logger","bsLoadingOverlayService","surveyService"],angular.module("nativeQDAApp").controller("completeSurveyCtrl",e)}(),function(){"use strict";function e(e,t,n,a){function o(){t.listSurveys().then(function(e){l.surveyList=e.data,r()},function(e){n.stop({referenceId:"survey-list"})})}function r(){l.tableParams=new e({sorting:{lastModified:"desc"}},{dataset:l.surveyList}),n.stop({referenceId:"survey-list"})}function i(e,n){t.deleteSurvey(e).then(function(){s(e),a.success("'"+n+"' was deleted successfully","","Success")})}function s(e){var t=l.surveyList.findIndex(function(t){return t._id===e});t>-1&&l.surveyList.splice(t,1),r()}var l=this;l.confirmDelete=function(e,t){swal({title:"Are you sure?",text:"Confirm to delete the survey '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){i(e,t)})},l.pageHeader={title:"Surveys",strapline:"for the masses"},l.surveyList={},n.start({referenceId:"survey-list"}),o()}e.$inject=["NgTableParams","surveyService","bsLoadingOverlayService","logger"],angular.module("nativeQDAApp").controller("surveyCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var o={showEmbededSurveyTab:!1,showTestSurveyTab:!0,showJSONEditorTab:!1,showOptions:!1,generateValidJSON:!0},r=new SurveyEditor.SurveyEditor("surveyEditorContainer",o);r.saveSurveyFunc=function(){swal({title:"Save Survey",text:"Please enter a name for this survey",type:"input",confirmButtonColor:"#5cb85c",showCancelButton:!0,closeOnConfirm:!1,allowOutsideClick:!0,animation:"slide-from-top",inputPlaceholder:"Survey Name"},function(o){if(!1===o)return!1;if(""===o)return swal.showInputError("You need to write something!"),!1;var i={surveyJSON:r.text,name:o,createdBy:t.currentUser().firstName};e.saveSurvey(i).then(function(e){swal({title:"Saved!",text:"Survey saved as '"+o+"'\nThis survey's code is "+e.data.accessID,type:"success",confirmButtonColor:"#5cb85c",animation:"slide-from-top"},function(){a.path("/survey"),n.$apply()})})})}}e.$inject=["surveyService","authentication","$scope","$location"],angular.module("nativeQDAApp").controller("newSurveyCtrl",e)}(),function(){"use strict";function e(e,t){var n=e.accessID;Survey.Survey.cssType="bootstrap",Survey.defaultBootstrapCss.navigationButton="btn btn-green",t.readSurvey(n).then(function(e){var t=JSON.parse(e.data.surveyJSON);window.survey=new Survey.Model(t),survey.onComplete.add(function(e){document.querySelector("#surveyResult").innerHTML="result: "+JSON.stringify(e.data)}),survey.render("surveyElement")})}e.$inject=["$routeParams","surveyService"],angular.module("nativeQDAApp").controller("viewSurveyCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(){t.readSurvey(o).then(function(e){var t=JSON.parse(e.data.surveyJSON);window.survey=new Survey.Model(t),survey.onComplete.add(function(e){document.querySelector("#surveyResult").innerHTML="result: "+JSON.stringify(e.data)}),survey.mode="display";var a=e.data.responses,o=n("filter")(a,{_id:r},!0)[0],i=JSON.parse(o.responseJSON);survey.data=i,survey.render("surveyElement")})}var o=e.accessID,r=e.responseID;Survey.Survey.cssType="bootstrap",Survey.defaultBootstrapCss.navigationButton="btn btn-green",a()}e.$inject=["$routeParams","surveyService","$filter"],angular.module("nativeQDAApp").controller("viewResponseCtrl",e)}(),function(){"use strict";function e(e,t,n,a){function o(){t.readSurveyResponses(l.accessID).then(function(e){e.data.responses.forEach(function(e){var t={responseJSON:JSON.parse(e.responseJSON),dateCreated:e.dateCreated,fullName:e.fullName,email:e.email,age:e.age,gender:e.gender,id:e._id};l.surveyResponsesList.push(t)}),r()},function(e){n.stop({referenceId:"survey-responses"})})}function r(){l.tableParams=new a({sorting:{lastModified:"desc"}},{dataset:l.surveyResponsesList}),n.stop({referenceId:"survey-responses"})}function i(e){s(e),logger.success("The survey response was deleted successfully","","Success")}function s(e){var t=l.surveyResponsesList.findIndex(function(t){return t._id===e});t>-1&&l.surveyResponsesList.splice(t,1),r()}var l=this;l.accessID=e.accessID,l.confirmDelete=function(e){swal({title:"Are you sure?",text:"Confirm to delete this survey response",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){i(e)})},l.surveyResponsesList=[],n.start({referenceId:"survey-responses"}),o()}e.$inject=["$routeParams","surveyService","bsLoadingOverlayService","NgTableParams"],angular.module("nativeQDAApp").controller("surveyResponsesCtrl",e)}(),function(){function e(e,t){var n=this;n.onSubmit=function(){e.aylienConceptAnalysis({text:n.analysisText,language:n.selectedLanguage.value}).then(function(e){n.responseData=e.data,console.log(e)})},n.selectedLanguage=null,n.language=[{language:"English",value:"en"},{language:"German",value:"de"},{language:"French",value:"fr"},{language:"Italian",value:"it"},{language:"Spanish",value:"es"},{language:"Portuguese",value:"pt"}],n.responseData=null,n.pageHeader={title:"Test Analysis",strapline:"Using AYLIEN-TextAPI"}}angular.module("nativeQDAApp").controller("testAylienCtrl",e),e.$inject=["analysisService","$scope"]}(),function(){function e(e,t){var n=this;n.onSubmit=function(){e.watsonAnalysis({url:n.analysisURL}).then(function(e){n.responseData=e.data,console.log(e)})},n.analysisURL=null,n.responseData=null,n.pageHeader={title:"Test Analysis",strapline:"Using IBM's Watson API"}}angular.module("nativeQDAApp").controller("testWatsonCtrl",e),e.$inject=["analysisService","$scope"]}(),function(){function e(e,t,n,a,o){function r(){o.start({referenceId:"visuals-info"}),n.readWatsonAnalysis(i.analysisID).then(function(e){o.stop({referenceId:"visuals-info"}),i.analysisData=e.data})}var i=this;i.viewFile=function(e){a.signDownloadS3(e).then(function(e){t.open(e.data,"_blank")})},i.analysisID=e.id,i.analysisData={},i.pageHeader={title:"Visualisations"},r()}e.$inject=["$routeParams","$window","analysisService","filesService","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("visualisationsCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(e){b=d3.forceCollide(function(e){return e.radius+1}).iterations(16),v=d3.forceSimulation().force("link",d3.forceLink().id(function(e){return e.index})).force("collide",b).force("charge",d3.forceManyBody().strength(1)).force("center",d3.forceCenter(p/2,m/2)).force("y",d3.forceY(0)).force("x",d3.forceX(0));var t=d3.select("body").append("div").attr("class","tooltip").style("opacity",0).style("background","#fff").style("padding","10px").style("border-radius","10px").style("font-weight",600);y=h.append("g").attr("class","nodes").selectAll("circle").data(e.nodes).enter().append("circle").attr("r",function(e){return e.radius}).style("cursor","pointer").on("mouseover",function(e){t.transition().duration(200).style("opacity",.9),"concepts"===c?t.html("Concept: "+e.text+"<br/>Relevance: "+d3.format(".2%")(e.relevance)+"<br/>DBpedia Resource: <a href='"+e.dbpedia_resource+"' target='_blank'>"+e.dbpedia_resource+"</a>").style("left",d3.event.pageX+"px").style("top",d3.event.pageY-150+"px"):t.html("Concept: "+e.text+"<br/>Relevance: "+d3.format(".2%")(e.relevance)).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-150+"px")}).on("mouseout",function(e){t.transition().duration(500).delay(1e3).style("opacity",0)}).call(d3.drag().on("start",function(e){d3.event.active||v.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}).on("drag",function(e){e.fx=d3.event.x,e.fy=d3.event.y}).on("end",function(e){d3.event.active||v.alphaTarget(0),e.fx=null,e.fy=null}));var a=h.selectAll(".mytext").data(e.nodes).enter().append("text").text(function(e){return e.text}).attr("text-anchor","middle").attr("fill","#000").attr("font-family","Arial").attr("font-size",function(e){return e.radius*i.fontScale.value/50}).attr("pointer-events","none"),r=d3.scaleLinear().domain([100*g,100*f]).range([i.bubbleColour1,i.bubbleColour2]),s="translate("+(p/2-160)+","+(m-200)+")";(w=d3.select("#svg-legend").attr("width",320).attr("height",100).attr("transform",s)).append("g").attr("class","svg-legend-class").attr("width",320).attr("height",100).attr("transform","translate(0,25)");var l=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(r).title("Relevance (%)");w.select(".svg-legend-class").call(l);v.nodes(e.nodes).on("tick",function(){y.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),a.attr("x",function(e){return e.x}).attr("y",function(e){return e.y})}),o(),n.stop({referenceId:"bubble-chart"})}function o(){var e=d3.scaleLinear().domain([g,f]).range([i.bubbleColour1,i.bubbleColour2]);h.selectAll("circle").style("fill",function(t){return e(t.relevance)});var t=d3.scaleLinear().domain([100*g,100*f]).range([i.bubbleColour1,i.bubbleColour2]),n=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(t).title("Relevance (%)");w.select(".svg-legend-class").call(n)}function r(){h.selectAll("text").style("font-size",function(e){return e.radius*i.fontScale.value/50})}var i=this;document.body.scrollTop=0,document.documentElement.scrollTop=0;var s=new Slideout({panel:document.querySelector("#panel"),menu:document.querySelector("#menu"),padding:256,tolerance:70});i.toggleOptions=function(){s.toggle()},i.updateFontScale=r,i.setCicleColour=o,i.updateToLinearScale=function(){if("linear"===i.selectedScale){var e=d3.scaleLinear().domain([0,1]).range([0,100]),t=d3.scaleLinear().domain([g,f]).range([i.bubbleColour1,i.bubbleColour2]);h.selectAll("circle").style("fill",function(e){return t(e.relevance)}),y.each(function(t){t.radius=e(t.relevance)}).transition().duration(500).attr("r",function(e){return e.radius}),b.radius(function(e){return e.radius}),r();var n=d3.scaleLinear().domain([100*g,100*f]).range([i.bubbleColour1,i.bubbleColour2]),a=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(n).title("Relevance (%)");w.select(".svg-legend-class").call(a),v.alphaTarget(.3).restart()}},i.updateToPowScale=function(){if(i.selectedScale="power",i.powScale.value){var e=d3.scalePow().exponent(i.powScale.value).domain([0,1]).range([0,100]),t=d3.scalePow().exponent(i.powScale.value).domain([g,f]).range([i.bubbleColour1,i.bubbleColour2]);h.selectAll("circle").style("fill",function(e){return t(e.relevance)}),y.each(function(t){t.radius=e(t.relevance)}).transition().duration(500).attr("r",function(e){return e.radius}),b.radius(function(e){return e.radius}),r();var n=d3.scalePow().exponent(i.powScale.value).domain([100*g,100*f]).range([i.bubbleColour1,i.bubbleColour2]),a=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(n).title("Relevance (%)");w.select(".svg-legend-class").call(a),v.alphaTarget(.3).restart()}},i.textColour="#000000",i.bubbleColour1="#e4e4d9",i.bubbleColour2="#4676fa",i.bgColour="#ffffff",i.fontScale={value:14},i.powScale={value:2},i.selectedScale="linear",i.textColourChange;var l,c=e.type,u=e.id,d=[],p=document.querySelector("#graph").clientWidth,m=document.querySelector("#graph").clientHeight,f=0,g=100,h=d3.select("#graph").append("svg").attr("width",p).attr("height",m).attr("class","graph-svg-component").call(d3.zoom().on("zoom",function(){h.attr("transform",d3.event.transform)})).append("g");i.circleColourOptions=[{name:"Misty Meadow",minCol:"#e4e4d9",maxCol:"#215f00"},{name:"Kyoto",minCol:"#c21500",maxCol:"#ffc500"},{name:"Pinot Noir",minCol:"#182848",maxCol:"#4b6cb7"},{name:"Miake",minCol:"#0ABFBC",maxCol:"#FC354C"},{name:"Calm Darya",minCol:"#5f2c82",maxCol:"#49a09d"},{name:"Electric Violet",minCol:"#8E54E9",maxCol:"#4776E6"},{name:"Sunrise",minCol:"#F09819",maxCol:"#FF512F"}],i.selectedCicleColour=i.circleColourOptions[0],n.start({referenceId:"bubble-chart"}),t.readWatsonAnalysis(u).then(function(e){var t=e.data;"concepts"===c?t.concepts.forEach(function(e){var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);f=e.relevance>f?e.relevance:f,g=e.relevance<g?e.relevance:g,d.push({text:t,radius:100*e.relevance,relevance:e.relevance,dbpedia_resource:e.dbpedia_resource})}):"keywords"===c&&t.keywords.forEach(function(e){var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);f=e.relevance>f?e.relevance:f,g=e.relevance<g?e.relevance:g,d.push({text:t,radius:100*e.relevance,relevance:e.relevance})}),a(l={nodes:d})},function(e){n.stop({referenceId:"bubble-chart"})});var y,v,b,w;i.bgColourOptions={format:"hexString",case:"lower"},i.textColourOptions={format:"hexString",case:"lower"},i.bubbleColourOptions1={format:"hexString",case:"lower"},i.bubbleColourOptions2={format:"hexString",case:"lower"},i.bgColourChange={onChange:function(e,t){document.querySelector(".graph-svg-component").style.background=t}},i.textColourChange={onChange:function(e,t,n){h.selectAll("text").style("fill",t)}},i.bubbleColourChange1={onChange:function(){o()}},i.bubbleColourChange2={onChange:function(){o()}}}e.$inject=["$routeParams","analysisService","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("bubbleChartCtrl",e)}(),function(){function e(e,t){function n(e,t,n){var a={w:600,h:600,margin:{top:20,right:20,bottom:20,left:20},levels:3,maxValue:0,labelFactor:1.25,wrapWidth:60,opacityArea:.35,dotRadius:4,opacityCircles:.1,strokeWidth:2,roundStrokes:!1,color:d3.schemeCategory10};if(void 0!==n)for(var o in n)void 0!==n[o]&&(a[o]=n[o]);var r=Math.max(a.maxValue,d3.max(t,function(e){return d3.max(e.map(function(e){return e.value}))})),i=t[0].map(function(e,t){return e.axis}),s=i.length,l=Math.min(a.w/2,a.h/2),c=d3.format("%"),u=2*Math.PI/s,d=d3.scaleLinear().range([0,l]).domain([0,r]);d3.select(e).select("svg").remove();var p=d3.select(e).append("svg").attr("width",a.w+a.margin.left+a.margin.right).attr("height",a.h+a.margin.top+a.margin.bottom).attr("class","radar"+e).append("g").attr("transform","translate("+(a.w/2+a.margin.left)+","+(a.h/2+a.margin.top)+")"),m=p.append("defs").append("filter").attr("id","glow"),f=(m.append("feGaussianBlur").attr("stdDeviation","2.5").attr("result","coloredBlur"),m.append("feMerge")),g=(f.append("feMergeNode").attr("in","coloredBlur"),f.append("feMergeNode").attr("in","SourceGraphic"),p.append("g").attr("class","axisWrapper"));g.selectAll(".levels").data(d3.range(1,a.levels+1).reverse()).enter().append("circle").attr("class","gridCircle").attr("r",function(e,t){return l/a.levels*e}).style("fill","#CDCDCD").style("stroke","#CDCDCD").style("fill-opacity",a.opacityCircles).style("filter","url(#glow)"),g.selectAll(".axisLabel").data(d3.range(1,a.levels+1).reverse()).enter().append("text").attr("class","axisLabel").attr("x",4).attr("y",function(e){return-e*l/a.levels}).attr("dy","0.4em").style("font-size","10px").attr("fill","#737373").text(function(e,t){return c(r*e/a.levels)});var h=g.selectAll(".axis").data(i).enter().append("g").attr("class","axis");h.append("line").attr("x1",0).attr("y1",0).attr("x2",function(e,t){return d(1.1*r)*Math.cos(u*t-Math.PI/2)}).attr("y2",function(e,t){return d(1.1*r)*Math.sin(u*t-Math.PI/2)}).attr("class","line").style("stroke","white").style("stroke-width","2px"),h.append("text").attr("class","legend").style("font-size","11px").attr("text-anchor","middle").attr("dy","0.35em").attr("x",function(e,t){return d(r*a.labelFactor)*Math.cos(u*t-Math.PI/2)}).attr("y",function(e,t){return d(r*a.labelFactor)*Math.sin(u*t-Math.PI/2)}).text(function(e){return e}).call(function(e,t){e.each(function(){for(var e,n=d3.select(this),a=n.text().split(/\s+/).reverse(),o=[],r=0,i=n.attr("y"),s=n.attr("x"),l=parseFloat(n.attr("dy")),c=n.text(null).append("tspan").attr("x",s).attr("y",i).attr("dy",l+"em");e=a.pop();)o.push(e),c.text(o.join(" ")),c.node().getComputedTextLength()>t&&(o.pop(),c.text(o.join(" ")),o=[e],c=n.append("tspan").attr("x",s).attr("y",i).attr("dy",1.4*++r+l+"em").text(e))})},a.wrapWidth);var y=d3.radialLine().curve(d3.curveLinearClosed).radius(function(e){return d(e.value)}).angle(function(e,t){return t*u});a.roundStrokes&&y.curve(d3.curveCardinalClosed);var v=p.selectAll(".radarWrapper").data(t).enter().append("g").attr("class","radarWrapper");v.append("path").attr("class","radarArea").attr("d",function(e,t){return y(e)}).style("fill",function(e,t){return a.color(t)}).style("fill-opacity",a.opacityArea).on("mouseover",function(e,t){d3.selectAll(".radarArea").transition().duration(200).style("fill-opacity",.1),d3.select(this).transition().duration(200).style("fill-opacity",.7),b.text(e[0].text).transition().duration(200).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".radarArea").transition().duration(200).style("fill-opacity",a.opacityArea),b.transition().duration(200).style("opacity",0)});b=p.append("text").attr("class","tooltip").style("opacity",0);v.append("path").attr("class","radarStroke").attr("d",function(e,t){return y(e)}).style("stroke-width",a.strokeWidth+"px").style("stroke",function(e,t){return a.color(t)}).style("fill","none").style("filter","url(#glow)"),v.selectAll(".radarCircle").data(function(e,t){return e}).enter().append("circle").attr("class","radarCircle").attr("r",a.dotRadius).attr("cx",function(e,t){return d(e.value)*Math.cos(u*t-Math.PI/2)}).attr("cy",function(e,t){return d(e.value)*Math.sin(u*t-Math.PI/2)}).style("fill",function(e,t,n){return a.color(n)}).style("fill-opacity",.8),p.selectAll(".radarCircleWrapper").data(t).enter().append("g").attr("class","radarCircleWrapper").selectAll(".radarInvisibleCircle").data(function(e,t){return e}).enter().append("circle").attr("class","radarInvisibleCircle").attr("r",1.5*a.dotRadius).attr("cx",function(e,t){return d(e.value)*Math.cos(u*t-Math.PI/2)}).attr("cy",function(e,t){return d(e.value)*Math.sin(u*t-Math.PI/2)}).style("fill","none").style("pointer-events","all").on("mouseover",function(e,t){newX=parseFloat(d3.select(this).attr("cx"))-10,newY=parseFloat(d3.select(this).attr("cy"))-10,b.attr("x",newX).attr("y",newY).text(c(e.value)).transition().duration(200).style("opacity",1)}).on("mouseout",function(){b.transition().duration(200).style("opacity",0)});var b=p.append("text").attr("class","tooltip").style("opacity",0)}var a=this,o=e.type,r=e.id,i={top:100,right:100,bottom:100,left:100},s=Math.min(700,window.innerWidth-10)-i.left-i.right,l={w:s,h:Math.min(s,window.innerHeight-i.top-i.bottom-20),margin:i,maxValue:.5,levels:5,roundStrokes:!0,color:d3.scaleOrdinal().range(["#EDC951","#CC333F","#00A0B0"])};t.readWatsonAnalysis(r).then(function(e){a.analysisData=e.data;var t=[];"entities"===o?e.data.entities.forEach(function(e){if(e.emotion){var n=[{axis:"Anger",value:e.emotion.anger,text:e.text},{axis:"Disgust",value:e.emotion.disgust},{axis:"Fear",value:e.emotion.fear},{axis:"Joy",value:e.emotion.joy},{axis:"Sadness",value:e.emotion.sadness}];t.push(n)}}):"keywords"===o&&e.data.keywords.forEach(function(e){if(e.emotion){var n=[{axis:"Anger",value:e.emotion.anger,text:e.text},{axis:"Disgust",value:e.emotion.disgust},{axis:"Fear",value:e.emotion.fear},{axis:"Joy",value:e.emotion.joy},{axis:"Sadness",value:e.emotion.sadness}];t.push(n)}}),n(".radarChart",t,l)})}e.$inject=["$routeParams","analysisService"],angular.module("nativeQDAApp").controller("radarChartCtrl",e)}(),function(){function e(e,t){}e.$inject=["$routeParams","analysisService"],angular.module("nativeQDAApp").controller("treemapChartCtrl",e)}(),function(){function e(e,t,n,a){function o(){var e=0;m.categories.forEach(function(t){t.label=t.label||{},t.score=t.score||{};var n={id:e,label:t.label,score:t.score};f.push(n),e++}),u.cols=[{field:"label",filter:{label:"text"},show:!0,sortable:"label",title:"Label"},{field:"score",filter:{score:"number"},show:!0,sortable:"score",title:"Score"}],u.tableParams=new n({},{dataset:f})}function r(){var e=0;m.concepts.forEach(function(t){t.text=t.text||{},t.relevance=t.relevance||{},t.dbpedia_resource=t.dbpedia_resource||{};var n={id:e,text:t.text,relevance:t.relevance,dbpedia_resource:t.dbpedia_resource};f.push(n),e++}),u.cols=[{field:"text",filter:{text:"text"},show:!0,sortable:"text",title:"Text"},{field:"relevance",filter:{relevance:"number"},show:!0,sortable:"relevance",title:"Relevance"},{field:"dbpedia_resource",filter:{dbpedia_resource:"number"},show:!0,sortable:"dbpedia_resource",title:"DBpedia Resource"}],u.tableParams=new n({},{dataset:f})}function i(){var e=0;m.entities.forEach(function(t){t.text=t.text||{},t.count=t.count||{},t.type=t.type||{},t.relevance=t.relevance||{},t.emotion=t.emotion||{},t.sentiment=t.sentiment||{};var n={id:e,text:t.text,count:t.count,type:t.type,relevance:t.relevance,anger:t.emotion.anger,disgust:t.emotion.disgust,fear:t.emotion.fear,joy:t.emotion.joy,sadness:t.emotion.sadness,sentiment:t.sentiment.score};f.push(n),e++}),u.cols=[{field:"text",filter:{text:"text"},show:!0,sortable:"text",title:"Text"},{field:"count",filter:{count:"number"},show:!0,sortable:"count",title:"Count"},{field:"type",filter:{type:"text"},show:!0,sortable:"type",title:"Type"},{field:"relevance",filter:{relevance:"number"},show:!0,sortable:"relevance",title:"Relevance"},{field:"anger",filter:{anger:"number"},show:!0,sortable:"anger",title:"Anger"},{field:"disgust",filter:{disgust:"number"},show:!0,sortable:"disgust",title:"Disgust"},{field:"fear",filter:{fear:"number"},show:!0,sortable:"fear",title:"Fear"},{field:"joy",filter:{joy:"number"},show:!0,sortable:"joy",title:"Joy"},{field:"sadness",filter:{sadness:"number"},show:!0,sortable:"sadness",title:"Sadness"},{field:"sentiment",filter:{sentiment:"number"},show:!0,sortable:"sentiment",title:"Sentiment"}],u.tableParams=new n({},{dataset:f})}function s(){var e=0;m.keywords.forEach(function(t){t.text=t.text||{},t.relevance=t.relevance||{},t.emotion=t.emotion||{},t.sentiment=t.sentiment||{};var n={id:e,text:t.text,relevance:t.relevance,anger:t.emotion.anger,disgust:t.emotion.disgust,fear:t.emotion.fear,joy:t.emotion.joy,sadness:t.emotion.sadness,sentiment:t.sentiment.score};f.push(n),e++}),u.cols=[{field:"text",filter:{text:"text"},show:!0,sortable:"text",title:"Text"},{field:"relevance",filter:{relevance:"number"},show:!0,sortable:"relevance",title:"Relevance"},{field:"anger",filter:{anger:"number"},show:!0,sortable:"anger",title:"Anger"},{field:"disgust",filter:{disgust:"number"},show:!0,sortable:"disgust",title:"Disgust"},{field:"fear",filter:{fear:"number"},show:!0,sortable:"fear",title:"Fear"},{field:"joy",filter:{joy:"number"},show:!0,sortable:"joy",title:"Joy"},{field:"sadness",filter:{sadness:"number"},show:!0,sortable:"sadness",title:"Sadness"},{field:"sentiment",filter:{sentiment:"number"},show:!0,sortable:"sentiment",title:"Sentiment"}],u.tableParams=new n({},{dataset:f})}function l(){var e=0;m.relations.forEach(function(t){t.arguments=t.arguments||{},t.sentence=t.sentence||{},t.type=t.type||{},t.score=t.score||{};var n={id:e,argumentTextOne:t.arguments[0].text,sentence:t.sentence,argumentTextTwo:t.arguments[1].text,type:t.type,score:t.score};f.push(n),e++}),u.cols=[{field:"argumentTextOne",filter:{argumentTextOne:"text"},show:!0,sortable:"argumentTextOne",title:"Argument One"},{field:"sentence",filter:{sentence:"text"},show:!0,sortable:"sentence",title:"Sentence"},{field:"argumentTextTwo",filter:{argumentTextTwo:"text"},show:!0,sortable:"argumentTextTwo",title:"Argument Two"},{field:"type",filter:{type:"text"},show:!0,sortable:"type",title:"Type"},{field:"score",filter:{score:"number"},show:!0,sortable:"score",title:"Score"}],u.tableParams=new n({},{dataset:f})}function c(){var e=0;m.semanticRoles.forEach(function(t){t.sentence=t.sentence||{},t.subject=t.subject||{},t.action=t.action||{},t.object=t.object||{};var n={id:e,sentence:t.sentence,subjectText:t.subject.text,actionVerbText:t.action.verb.text,actionVerbTense:t.action.verb.tense,actionText:t.action.text,actionNormalized:t.action.normalized,objectText:t.object.text};f.push(n),e++}),u.cols=[{field:"sentence",filter:{sentence:"text"},show:!0,sortable:"sentence",title:"Sentence"},{field:"subjectText",filter:{subjectText:"text"},show:!0,sortable:"subjectText",title:"Subject Text"},{field:"actionVerbText",filter:{actionVerbText:"text"},show:!0,sortable:"actionVerbText",title:"Action Verb Text"},{field:"actionVerbTense",filter:{actionVerbTense:"text"},show:!0,sortable:"actionVerbTense",title:"Action Verb Tense"},{field:"actionText",filter:{actionText:"text"},show:!0,sortable:"actionText",title:"actionText"},{field:"actionNormalized",filter:{actionNormalized:"text"},show:!0,sortable:"actionNormalized",title:"actionNormalized"},{field:"objectText",filter:{objectText:"text"},show:!0,sortable:"objectText",title:"objectText"}],u.tableParams=new n({},{dataset:f})}var u=this,d=e.type,p=e.id,m={},f=[];u.cols=[],a.start({referenceId:"analysis-basic-table"}),t.readWatsonAnalysis(p).then(function(e){switch(a.stop({referenceId:"analysis-basic-table"}),m=e.data,d){case"categories":o();break;case"concepts":r();break;case"entities":i();break;case"keywords":s();break;case"relations":l();break;case"semantic-roles":c()}})}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("basicTableCtrl",e)}(),function(){function e(e,t,n,a){function o(e){var t=d3.select("svg"),n={top:20,right:20,bottom:30,left:40},a=+t.attr("width")-n.left-n.right,o=+t.attr("height")-n.top-n.bottom,r=d3.scaleBand().rangeRound([0,a]).padding(.1),i=d3.scaleLinear().rangeRound([o,0]),s=t.append("g").attr("transform","translate("+n.left+","+n.top+")");r.domain(e.map(function(e){return e.text})),i.domain([0,d3.max(e,function(e){return e.relevance})]),s.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+o+")").call(d3.axisBottom(r)),s.append("g").attr("class","axis axis--y").call(d3.axisLeft(i).ticks(10,"%")).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Relevance"),s.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(e){return r(e.text)}).attr("y",function(e){return i(e.relevance)}).attr("width",r.bandwidth()).attr("height",function(e){return o-i(e.relevance)})}var r=this,i=(e.type,e.id);r.cols=[];var s;a.start({referenceId:"bubble-chart"}),t.readWatsonAnalysis(i).then(function(e){e.data.keywords.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);s.push({relevance:e.relevance,text:t})}),o(s)},function(e){a.stop({referenceId:"bubble-chart"})})}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("barChartCtrl",e)}(),function(){function e(e,t,n,a){function o(e){var t=d3.select("svg"),n=+t.attr("width"),a=+t.attr("height"),o=Math.min(n,a)/2,r=t.append("g").attr("transform","translate("+n/2+","+a/2+")"),i=d3.scaleOrdinal(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),s=d3.pie().sort(null).value(function(e){return e.relevance}),l=d3.arc().outerRadius(o-10).innerRadius(0),c=d3.arc().outerRadius(o-40).innerRadius(o-40),u=r.selectAll(".arc").data(s(e)).enter().append("g").attr("class","arc");u.append("path").attr("d",l).attr("fill",function(e){return i(e.data.text)}),u.append("text").attr("transform",function(e){return"translate("+c.centroid(e)+")"}).attr("dy","0.35em").text(function(e){return e.data.age})}var r=this,i=(e.type,e.id),s=[];r.cols=[];var l=[];a.start({referenceId:"bubble-chart"}),t.readWatsonAnalysis(i).then(function(e){e.data.keywords.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);s.push({relevance:e.relevance,text:t})}),s.length>15?(s.relevance.sort(),l=s.slice(0,15),console.log(l),o(s)):o(s)},function(e){a.stop({referenceId:"bubble-chart"})})}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("pieChartCtrl",e)}(),function(){function e(e,t,n,a){function o(e){var t=Math.min(960,500)/2,n=d3.scaleOrdinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),a=d3.arc().outerRadius(t-10).innerRadius(t-70),o=d3.pie().sort(null).value(function(e){return e.relevance}),r=d3.select("body").append("svg").attr("width",960).attr("height",500).append("g").attr("transform","translate(480,250)").selectAll(".arc").data(o(e)).enter().append("g").attr("class","arc");r.append("path").attr("d",a).style("fill",function(e){return n(e.data.text)}),r.append("text").attr("transform",function(e){return"translate("+a.centroid(e)+")"}).attr("dy",".35em").text(function(e){return e.data.text})}var r=this,i=(e.type,e.id),s=[];r.cols=[],a.start({referenceId:"bubble-chart"}),t.readWatsonAnalysis(i).then(function(e){e.data.keywords.forEach(function(e){var t=100*e.relevance,n=e.text.charAt(0).toUpperCase()+e.text.slice(1);s.push({relevance:t,text:n})}),o(s)},function(e){a.stop({referenceId:"bubble-chart"})})}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("nativeQDAApp").controller("donutChartCtrl",e)}();