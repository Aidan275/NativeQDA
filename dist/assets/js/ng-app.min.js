!function(){function e(e,t){e.when("/login",{templateUrl:"/pages/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm",loginRequired:!1}).when("/register",{templateUrl:"/pages/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm",loginRequired:!0}).when("/forgot-password",{templateUrl:"/pages/auth/forgotPass/forgotPass.view.html",controller:"forgotPassCtrl",controllerAs:"vm",loginRequired:!1}).when("/",{templateUrl:"/pages/home/home.view.html",controller:"homeCtrl",controllerAs:"vm",loginRequired:!0}).when("/analysis/map",{templateUrl:"/pages/analysis/map/map.view.html",controller:"mapCtrl",controllerAs:"vm",loginRequired:!0}).when("/analysis/data",{templateUrl:"/pages/analysis/data/data.view.html",controller:"dataCtrl",controllerAs:"vm",loginRequired:!0}).when("/analysis/visualisation",{templateUrl:"/pages/analysis/visualisation/visualisation.view.html",controller:"visualisationCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey",{templateUrl:"/pages/survey/survey.view.html",controller:"surveyCtrl",controllerAs:"vm",loginRequired:!0}).when("/files",{templateUrl:"/pages/files/files.view.html",controller:"filesCtrl",controllerAs:"vm",loginRequired:!0}).when("/settings",{templateUrl:"/pages/settings/settings.view.html",controller:"settingsCtrl",controllerAs:"vm",loginRequired:!0}).when("/complete-survey",{templateUrl:"/pages/survey/completeSurvey/completeSurvey.view.html",controller:"CompleteSurveyCtrl",controllerAs:"vm",loginRequired:!1}).when("/heatmap-example",{templateUrl:"/pages/heatmapExample/heatmapExample.view.html",controller:"heatmapCtrl",controllerAs:"vm",loginRequired:!0}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}angular.module("nativeQDAApp",["ngRoute","ngSanitize","ngTable","ui.bootstrap","ui.bootstrap.datepicker","rzModule","ngFileUpload","ngTagsInput","jp.ng-bs-animated-button"]),e.$inject=["$routeProvider","$locationProvider"],angular.module("nativeQDAApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",function(e,t,a){e.$on("$routeChangeStart",function(e,n,o){var i;n.loginRequired&&!a.isLoggedIn()?(i=t.path(),t.path("/login").replace(),t.search("page",i)):n.loginRequired&&a.isLoggedIn()&&(t.path(i).replace(),i=null)})}])}(),function(){"use strict";function e(e,t){e.errorOnUnhandledRejections(!0),toastr.options.closeButton=!0,toastr.options.timeOut=3e3,toastr.options.positionClass="toast-top-right",t.debugEnabled&&t.debugEnabled(!0)}angular.module("nativeQDAApp").config(e),e.$inject=["$qProvider","$logProvider"]}(),function(){"use strict";function e(e,t){return{catcher:function(a){return function(n){var o;return a&&(a+="\n"),n.data&&n.data.description?(o=a+n.data.description,n.data.description=o):n.data&&n.data.message?(o=a+n.data.message,n.data.message=o):n.data&&n.data.errmsg&&(11e3===n.data.code?o=a+"Email already exists in the database":(o=a+n.data.errmsg,n.data.errmsg=o)),t.error(o,n,"Error"),e.reject(n)}}}}angular.module("nativeQDAApp").service("exception",e),e.$inject=["$q","logger"]}(),function(){"use strict";function e(e){return{showToasts:!0,error:function(t,a,n){toastr.error(t,n),e.error("Error: "+t,a)},info:function(t,a,n){toastr.info(t,n),e.info("Info: "+t,a)},success:function(t,a,n){toastr.success(t,n),e.info("Success: "+t,a)},warning:function(t,a,n){toastr.warning(t,n),e.warn("Warning: "+t,a)},log:e.log}}angular.module("nativeQDAApp").service("logger",e),e.$inject=["$log"]}(),function(){"use strict";function e(e,t,a){return{signUploadS3:function(n){return e.post("/api/files/signUploadS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for signUploadS3")(e)})},addFileDB:function(n){return e.post("/api/files/addFileDB",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for addFileDB")(e)})},signDownloadS3:function(n){return e.get("/api/files/signDownloadS3?key="+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for signDownloadS3")(e)})},getFileListS3:function(){return e.get("/api/files/getFileListS3",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for getFileListS3")(e)})},getFileListDB:function(){return e.get("/api/files/getFileListDB",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for getFileListDB")(e)})},deleteFileS3:function(n){return e.post("/api/files/deleteFileS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for deleteFileS3")(e)})},deleteFileDB:function(n){return e.delete("/api/files/deleteFileDB?key="+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for deleteFileDB")(e)})},fileReadOneDB:function(n){return e.get("/api/files/fileReadOneDB?key="+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for fileReadOneDB")(e)})},objectAclS3:function(n){return e.post("/api/files/objectAclS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for objectAclS3")(e)})},objectAclDB:function(n){return e.post("/api/files/objectAclDB",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for objectAclDB")(e)})},syncDBwithS3:function(n){return e.post("/api/files/syncDBwithS3",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for syncDBwithS3")(e)})}}}angular.module("nativeQDAApp").service("filesService",e),e.$inject=["$http","authentication","exception"]}(),function(){function e(e,t,a){return{datasetCreate:function(n){return e.post("/api/analysis/data/create",n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for datasetCreate")(e)})},listDatasets:function(){return e.get("/api/analysis/data/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for listDatasets")(e)})},datasetReadOne:function(n){return e.get("/api/analysis/data/read/"+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for datasetReadOne")(e)})},datasetDeleteOne:function(n){return e.delete("/api/analysis/data/delete/"+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e}).catch(function(e){return a.catcher("XHR Failed for datasetDeleteOne")(e)})}}}angular.module("nativeQDAApp").service("datasetService",e),e.$inject=["$http","authentication","exception"]}(),function(){function e(e,t,a){function n(e){t.localStorage["nativeQDA-token"]=e}function o(){return t.localStorage["nativeQDA-token"]}function i(){var e=o();return!!e&&JSON.parse(t.atob(e.split(".")[1])).exp>Date.now()/1e3}return{currentUser:function(){if(i()){var e=o(),a=JSON.parse(t.atob(e.split(".")[1]));return{email:a.email,name:a.name}}},saveToken:n,getToken:o,isLoggedIn:i,register:function(t){return e.post("/api/register",t).then(function(e){n(e.data.token)}).catch(function(e){return a.catcher("Registration Failed")(e)})},login:function(t){return e.post("/api/login",t).then(function(e){n(e.data.token)}).catch(function(e){return a.catcher("Login Failed")(e)})},logout:function(a){return t.localStorage.removeItem("nativeQDA-token"),e.post("/api/event",a)}}}angular.module("nativeQDAApp").service("authentication",e),e.$inject=["$http","$window","exception"]}(),function(){function e(e){return{event:function(t){return e.post("/api/event",t)}}}angular.module("nativeQDAApp").service("events",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){return{getPosition:function(t){navigator.geolocation?navigator.geolocation.getCurrentPosition(t,function(t){1==t.code?e.warning(t.message,t,"Warning"):e.error(t.message,t,"Error")}):e.error("Geolocation is not supported by this browser","Error","Error")}}}angular.module("nativeQDAApp").service("mapService",e),e.$inject=["logger"]}(),function(){function e(e,t,a){var n=this;n.logout=function(){t.logout({email:t.currentUser().email,desc:"Logout"}),e.path("/login")},n.currentPath=e.path(),n.isLoggedIn=t.isLoggedIn(),n.currentUser=t.currentUser(),a.event({email:t.currentUser().email})}angular.module("nativeQDAApp").controller("navigationCtrl",e),e.$inject=["$location","authentication","events"]}(),function(){angular.module("nativeQDAApp").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}})}(),function(){angular.module("nativeQDAApp").directive("footerGeneric",function(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}})}(),function(){angular.module("nativeQDAApp").directive("pageHeader",function(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}})}(),function(){angular.module("nativeQDAApp").filter("formatDistance",function(){return function(t){var a,n=t/1e3;return t&&e(t)?(n>1?(n=parseFloat(n).toFixed(1),a=" km"):(n=parseInt(1e3*n,10).toFixed(1),a=" m"),n+a):"?"}});var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)}}(),function(){angular.module("nativeQDAApp").filter("addHtmlLineBreaks",function(){return function(e){return e.replace(/\n/g,"<br/>")}})}(),function(){angular.module("nativeQDAApp").filter("formatFileSize",function(){return function(e,t){if(0===e||isNaN(parseFloat(e))||!isFinite(e))return"-";void 0===t&&(t=1);var a=["bytes","kB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(n))).toFixed(t)+" "+a[n]}})}(),function(){"use strict";function e(e,t,a,n,o,i,r,l){function s(t,a){var n=new google.maps.LatLng(t,a),o=document.getElementById("map-homepage"),i={center:n,zoom:4,panControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};L=new google.maps.Map(o,i),e.getPosition(c),g()}function c(e){v=e.coords.latitude,w=e.coords.longitude,u()}function u(){var e=new google.maps.LatLng(v,w);new google.maps.Marker({position:e,map:L,title:"Your Position"});L.setZoom(13),L.panTo(e)}function g(){t.getFileListDB().then(function(e){y=e.data,p(),m()})}function p(){for(e=0;e<k.length;e++)k[e].setMap(null);for(e=0;e<D.length;e++)D[e].setMap(null);for(var e=0;e<b.length;e++)b[e].setMap(null);k=[],D=[],b=[],A&&A.clearMarkers(),C&&C.clearMarkers(),M&&M.clearMarkers()}function m(){var e={australia:{icon:"/images/map/icons/kangaroo-markers/kangaroo-marker.png"},newZealand:{icon:"/images/map/icons/kiwi-markers/kiwi-marker.png"},newCaledonia:{icon:"/images/map/icons/kagu-markers/kagu-marker.png"}},t=new google.maps.InfoWindow;y.forEach(function(i){var r=new google.maps.Marker({position:new google.maps.LatLng(i.coords.lat,i.coords.lng),icon:e.australia.icon,title:i.name}),l='<div class="info-window"><h3>'+i.name+"</h3><p>Created By: "+i.createdBy+"</p><p>Size: "+n("formatFileSize")(i.size,2)+"</p><p>Last Modified: "+n("date")(i.lastModified,"dd MMMM, yyyy h:mm a")+"</p>";0!=i.tags.length&&(l+="<p>Tags: </p><ul>",i.tags.forEach(function(e){l+="<li>"+e+"</li>"}),l+="</ul>"),l+="<a ng-click=\"vm.viewFile('"+i.key+'\')" class="btn btn-success" role="button">View</a> <a ng-click="vm.popupFileDetails(\''+i.key+'\')" class="btn btn-primary" role="button">Details</a> <a ng-click="vm.confirmDelete(\''+i.key+"', '"+i.name+'\')" class="btn btn-danger" role="button">Delete</a></div>';var s=o(l)(a);r.addListener("click",function(){t.setContent(s[0]),t.open(L,r)}),"/images/map/icons/kangaroo-markers/kangaroo-marker.png"==r.icon?k.push(r):"/images/map/icons/kiwi-markers/kiwi-marker.png"==r.icon?D.push(r):"/images/map/icons/kagu-markers/kagu-marker.png"==r.icon&&b.push(r)}),A=new MarkerClusterer(L,k,{imagePath:"/images/map/icons/kangaroo-markers/m"}),C=new MarkerClusterer(L,D,{imagePath:"/images/map/icons/kiwi-markers/m"}),M=new MarkerClusterer(L,b,{imagePath:"/images/map/icons/kagu-markers/m"})}function d(e,a){t.deleteFileDB(e).then(function(t){f(e,a)})}function f(e,a){t.deleteFileS3({key:e}).then(function(e){l.success("File "+a+" deleted successfully","","Success"),g()})}var h=this;h.getFileList=g,h.viewFile=function(e){t.signDownloadS3(e).then(function(e){i.open(e.data,"_blank")})},h.popupFileDetails=function(e){r.open({templateUrl:"/pages/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}}).result.then(function(){})},h.confirmDelete=function(e,t){i.confirm("Are you sure you want to delete "+t+"?")&&d(e,t)};var v=-34.4054039,w=150.87842999999998,y=null,L=null,k=[],D=[],b=[],A=null,C=null,M=null;h.pageHeader={title:"Dashboard",strapline:"summary of recent activity"},s(v,w)}angular.module("nativeQDAApp").controller("homeCtrl",e),e.$inject=["mapService","filesService","$scope","$filter","$compile","$window","$uibModal","logger"]}(),function(){function e(e,t,a,n){function o(){a.event({email:i.credentials.email,desc:"Login"}),t.login(i.credentials).then(function(t){e.search("page",null),e.path(i.returnPage)})}var i=this;i.onSubmit=function(){if(!i.credentials.email||!i.credentials.password)return n.error("All fields required, please try again","Error","Error"),!1;o()},i.login=o,i.credentials={email:"",password:""},i.pageHeader={title:"Sign in to nativeQDA"},i.returnPage=e.search().page||"/"}angular.module("nativeQDAApp").controller("loginCtrl",e),e.$inject=["$location","authentication","events","logger"]}(),function(){function e(e,t,a){function n(){t.register(o.credentials).then(function(){e.search("page",null),e.path(o.returnPage)})}var o=this;o.onSubmit=function(){if(!(o.credentials.name&&o.credentials.email&&o.credentials.password))return a.error("All fields required, please try again","","Error"),!1;n()},o.register=n,o.credentials={name:"",email:"",password:""},o.pageHeader={title:"Create a new NativeQDA account"},o.returnPage=e.search().page||"/"}angular.module("nativeQDAApp").controller("registerCtrl",e),e.$inject=["$location","authentication","logger"]}(),function(){function e(e,t){var a=this;a.onSubmit=function(){if(a.formError="",!a.email)return t.error("All fields required, please try again","","Error"),!1;t.info("TODO: verify user's email and send link to reset password","","TODO")},a.email="",a.pageHeader={title:"Forgot Password"}}angular.module("nativeQDAApp").controller("forgotPassCtrl",e),e.$inject=["authentication","logger"]}(),function(){function e(e,t,a,n,o,i,r){function l(e){mapOptions={center:[-34.4054039,150.87842999999998],zoom:4},h.map=L.map("map",mapOptions);var t=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}).addTo(h.map),l=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22})),c=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),p=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),m=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:"pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",maxZoom:22}),f=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),v=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),w=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),y=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),k=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});k.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":t,"Mapbox Dark":a,"Mapbox Satellite":n,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":i,"Mapbox Streets Basic":r,"Mapbox Outdoors":l,"Mapbox Run Bike Hike":c,"Mapbox Pencil":u,"Mapbox Pirates":p,"Mapbox Emerald":m,"Mapbox High Contrast":d,"Google Roadmap":f,"Google Aerial":v,"Google Terrain":w,"Google Hybrid":y,"Google Traffic":k},{},{collapsed:!0}).addTo(h.map),s(),g()}function s(e){h.map.on("locationfound",c),h.map.on("locationerror",u),h.map.locate({setView:!0,maxZoom:15})}function c(e){var t=e.accuracy/2,n=e.latlng,o=L.marker(n,{icon:y,title:"Your Position"}).addTo(h.map).bindPopup("You are within "+a("formatDistance")(t)+" meters from this point"),i=L.circle(n,{radius:t,color:"#cb2529"});o.on("popupopen",function(){i.addTo(h.map),h.map.setView(n,18)}),o.on("popupclose",function(){h.map.removeLayer(i)}),r.success("User's location found",e,"Success")}function u(e){r.error(e.message,e,"Error")}function g(){e.getFileListDB().then(function(e){p(e.data)})}function p(e){h.markers=L.markerClusterGroup({showCoverageOnHover:!1}),e.forEach(function(e){var o=L.marker([e.coords.lat,e.coords.lng],{icon:w,title:e.name}),i='<div class="info-window"><h3>'+e.name+"</h3><p>Created By: "+e.createdBy+"</p><p>Size: "+a("formatFileSize")(e.size,2)+"</p><p>Last Modified: "+a("date")(e.lastModified,"dd MMMM, yyyy h:mm a")+"</p>";0!=e.tags.length&&(i+="<p>Tags: </p><ul>",e.tags.forEach(function(e){i+="<li>"+e+"</li>"}),i+="</ul>"),i+="<a ng-click=\"vm.viewFile('"+e.key+'\')" class="btn btn-success" role="button">View</a> <a ng-click="vm.popupFileDetails(\''+e.key+'\')" class="btn btn-primary" role="button">Details</a> <a ng-click="vm.confirmDelete(\''+e.key+"', '"+e.name+'\')" class="btn btn-danger" role="button">Delete</a></div>';var r=n(i)(t);o.bindPopup(r[0]),o.on("popupopen",function(){h.currentMarker=this}),h.markers.addLayer(o)}),h.map.addLayer(h.markers)}function m(t,a){e.deleteFileDB(t).then(function(e){d(t,a)})}function d(t,a){e.deleteFileS3({key:t}).then(function(e){r.success("File "+a+" deleted successfully","","Success"),f()})}function f(){h.markers.removeLayer(h.currentMarker)}var h=this;h.getFileList=g,h.viewFile=function(t){e.signDownloadS3(t).then(function(e){o.open(e.data,"_blank")})},h.popupFileDetails=function(e){i.open({templateUrl:"/pages/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}}).result.then(function(){})},h.confirmDelete=function(e,t){o.confirm("Are you sure you want to delete "+t+"?")&&m(e,t)},h.map=null,h.markers=[],h.currentMarker=null;var v=L.Icon.extend({options:{shadowUrl:"assets/img/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),w=new v({iconUrl:"assets/img/markers/marker-icon-2x.png"}),y=new v({iconUrl:"assets/img/markers/marker-icon-pos.png"});l()}e.$inject=["filesService","$scope","$filter","$compile","$window","$uibModal","logger"],angular.module("nativeQDAApp").controller("mapCtrl",e)}(),function(){function e(e,t,a,n,o,i){function r(){o.listDatasets().then(function(e){u.dataset=e.data,l()})}function l(){u.tableParams=new n({sorting:{dateCreated:"desc"}},{dataset:u.dataset})}function s(e,t){o.datasetDeleteOne(t).then(function(a){i.success("Dataset "+e+" was successfully deleted","","Success"),c(t)})}function c(e){var t=u.dataset.findIndex(function(t){return t._id==e});t>-1&&u.dataset.splice(t,1),l()}var u=this;u.getDatasetList=r,u.confirmDelete=function(t,a){e.confirm("Are you sure you want to delete "+t+"?")&&s(t,a)},u.popupViewDataset=function(e){a.open({templateUrl:"/pages/analysis/data/viewDataset/viewDataset.view.html",controller:"viewDatasetCtrl as vm",size:"lg",resolve:{datasetId:function(){return e}}}).result.then(function(){})},u.popupEditDataset=function(e,t){a.open({templateUrl:"/pages/analysis/data/editDataset/editDataset.view.html",controller:"editDatasetCtrl as vm",size:"xl"}).result.then(function(){})},u.popupNewDataset=function(){a.open({templateUrl:"/pages/analysis/data/newDataset/newDataset.view.html",controller:"newDatasetCtrl as vm",size:"xl"}).result.then(function(e){u.dataset.push(e),l()})},u.dataset=[],u.pageHeader={title:"Data",strapline:"where the Datasets live"},r()}angular.module("nativeQDAApp").controller("dataCtrl",e),e.$inject=["$window","$sce","$uibModal","NgTableParams","datasetService","logger"]}(),function(){function e(e,t,a){function n(e){t.datasetCreate({name:o.formData.datasetName,desc:o.formData.description}).then(function(e){a.success("New Dataset "+o.formData.datasetName+" was created successfully","","Success"),o.modal.close(e.data)})}var o=this;o.onSubmit=function(){angular.isDefined(o.formData)&&o.formData.datasetName&&o.formData.description?n(o.formData):a.error("All fields required, please try again","","Error")},o.doCreateDataset=n,o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("newDatasetCtrl",e),e.$inject=["$uibModalInstance","datasetService","logger"]}(),function(){function e(e,t,a){var n=this;t.datasetReadOne(a).then(function(e){n.data=e.data}),n.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("viewDatasetCtrl",e),e.$inject=["$uibModalInstance","datasetService","datasetId"]}(),function(){function e(e,t){this.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("editDatasetCtrl",e),e.$inject=["$uibModalInstance","datasetService"]}(),function(){function e(e,t,a,n,o){function i(){c.visuals=[{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",_id:"1"},{visual:"Word Cloud",visualThumb:"word-cloud-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/01/12",_id:"2"},{visual:"Chord Diagram",visualThumb:"chord-diagram-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2016/03/29",_id:"3"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/09/15",_id:"4"},{visual:"Concept Map",visualThumb:"concept-map-thumb.png",dataSet:"English vs French",createdBy:"Anu",dateCreated:"2017/04/25",_id:"5"},{visual:"Word Frequency Chart",visualThumb:"bar-chart-thumb.png",dataSet:"Kanaks - Drehu",createdBy:"Michael",dateCreated:"2016/01/12",_id:"6"},{visual:"Word Tree",visualThumb:"word-tree-thumb.png",dataSet:"Qualitative study of the Moriori language",createdBy:"Michael",dateCreated:"2017/03/29",_id:"7"}],r()}function r(){c.tableParams=new a({sorting:{dateCreated:"desc"}},{dataset:c.visuals})}function l(e){s(e)}function s(e){var t=c.visuals.findIndex(function(t){return t._id==e});t>-1&&c.visuals.splice(t,1),r()}var c=this;c.getVisualsList=i,c.confirmDelete=function(e,a){t.confirm("Are you sure you want to delete "+e+"?")&&l(a)},c.popupNewVisual=function(){o.open({templateUrl:"/pages/analysis/visualisation/newVisualisation/newVisualisation.view.html",controller:"newVisualisationCtrl as vm",size:"xl"}).result.then(function(){})},c.visuals=[],c.pageHeader={title:"Visualisation",strapline:"visualise datasets here"},i()}angular.module("nativeQDAApp").controller("visualisationCtrl",e),e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"]}(),function(){function e(e){var t=this;t.onSubmit=function(){return t.formError="",angular.isDefined(t.formData)&&t.formData.visualisationName?void console.log("Create Visualisation!"):(t.formError="All fields required, please try again",!1)},t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("newVisualisationCtrl",e),e.$inject=["$uibModalInstance"]}(),function(){angular.module("nativeQDAApp").controller("CompleteSurveyCtrl",function(){var e=this;e.surveyCode="",e.onSubmit=function(){if(e.formError="",!e.surveyCode)return e.formError="All fields required, please try again",!1;console.log("Find survey and display to user!")}})}(),function(){function e(e,t,a,n,o){var i=this;i.pageHeader={title:"Surveys",strapline:"for the masses"},i.popupNewSurveyForm=function(){o.open({templateUrl:"/pages/survey/newSurvey/newSurvey.view.html",controller:"newSurveyCtrl as vm",size:"xl"}).result.then(function(){})};var r=[{survey:"Survey",createdBy:"Anu",responses:12,dateCreated:"2017/05/26",command:"id1"},{survey:"Survey2",createdBy:"Michael",responses:50,dateCreated:"2017/05/02",command:"id1"},{survey:"Survey3",createdBy:"Michael",responses:23,dateCreated:"2017/02/12",command:"id1"},{survey:"Survey4",createdBy:"Anu",responses:50,dateCreated:"2017/02/15",command:"id1"},{survey:"Survey5",createdBy:"Holly",responses:11,dateCreated:"2017/04/02",command:"id1"},{survey:"Survey6",createdBy:"Anu",responses:1,dateCreated:"2017/01/11",command:"id1"},{survey:"Survey7",createdBy:"Michael",responses:100,dateCreated:"2017/01/23",command:"id1"}];i.tableParams=new a({},{dataset:r}),e.confirmDelete=function(){t.confirm("Are ya sure?")}}angular.module("nativeQDAApp").controller("surveyCtrl",e),e.$inject=["$scope","$window","NgTableParams","$sce","$uibModal"]}(),function(){function e(e){var t=this;t.onSubmit=function(){return t.formError="",angular.isDefined(t.formData)&&t.formData.surveyName?void console.log("Create Survey!"):(t.formError="All fields required, please try again",!1)},t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("newSurveyCtrl",e),e.$inject=["$uibModalInstance"]}(),function(){function e(e,t,a,n,o){var i=this,r=10;o.event({email:n.currentUser().email}),i.bothOver=!0,i.fatherOver=!0,i.MotherOver=!0,i.bothAus=!0,function(e,t){a.mapsInitialised.then(function(){var a=new google.maps.LatLng(e,t),n=document.getElementById("map"),o={center:a,zoom:r,panControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}},l=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:9029},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:358},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:3235},{location:new google.maps.LatLng(-33.76288,150.99212),weight:7427},{location:new google.maps.LatLng(-33.771,150.9063),weight:21538},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:4163},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:8865},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:1618},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:5627},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:3383},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:27386},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:11435},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:1552},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:979},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}],s=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:187},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:18},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:64},{location:new google.maps.LatLng(-33.76288,150.99212),weight:141},{location:new google.maps.LatLng(-33.771,150.9063),weight:224},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:130},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:202},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:96},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:132},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:165},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:179},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:123},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:107},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:128},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}],c=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:129},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:15},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:53},{location:new google.maps.LatLng(-33.76288,150.99212),weight:127},{location:new google.maps.LatLng(-33.771,150.9063),weight:151},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:106},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:173},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:60},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:83},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:98},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:145},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:98},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:59},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:95},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}],u=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:68},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:13},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:45},{location:new google.maps.LatLng(-33.76288,150.99212),weight:66},{location:new google.maps.LatLng(-33.771,150.9063),weight:99},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:62},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:116},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:65},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:69},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:96},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:84},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:43},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:47},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:106},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110}],g=new google.maps.Map(n,o),p=new google.maps.visualization.HeatmapLayer,m=null;i.radiusSlider={value:100,options:{floor:0,ceil:200,onChange:function(){p.set("radius",i.radiusSlider.value)}}},i.opacitySlider={value:.6,options:{floor:0,ceil:1,step:.01,precision:10,onChange:function(){p.set("opacity",i.opacitySlider.value)}}},i.updateMap=function(){p&&p.setMap(null);var e=[];i.bothOver&&Array.prototype.push.apply(e,l),i.fatherOver&&Array.prototype.push.apply(e,s),i.MotherOver&&Array.prototype.push.apply(e,c),i.bothAus&&Array.prototype.push.apply(e,u),p.setData(e),p.setOptions({radius:i.radiusSlider.value,opacity:i.opacitySlider.value,gradient:m}),p.setMap(g)},i.removeGrtSyd=function(){i.rmGrtSyd?(l.pop(),s.pop(),c.pop(),u.pop()):(l.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}),s.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}),c.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}),u.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110})),i.updateMap()},i.changeGradient=function(){m=i.changeGrad?["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]:null,i.updateMap()},i.updateMap()})}(-33.848192,151.061857)}angular.module("nativeQDAApp").controller("heatmapCtrl",e),e.$inject=["$scope","geolocation","GoogleMapsInitialiser","authentication","events"]}(),function(){"use strict";function e(e,t,a,n,o,i,r,l,s,c){function u(){var t=new google.maps.LatLng(v.lat,v.lng),a=document.getElementById("map-files-page"),o={center:t,zoom:4,panControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}};v.map=new google.maps.Map(a,o),v.marker=new google.maps.Marker({draggable:!0,position:t,map:v.map,title:"Latitude: "+v.lat+"\nLongitude: "+v.lng}),google.maps.event.addListener(v.marker,"dragend",function(e){v.lat=e.latLng.lat(),v.lng=e.latLng.lng(),v.marker.setTitle("Latitude: "+v.lat+"\nLongitude: "+v.lng),n.$apply()}),google.maps.event.addListener(v.map,"click",function(e){v.lat=e.latLng.lat(),v.lng=e.latLng.lng(),v.marker.setPosition(e.latLng),v.marker.setTitle("Latitude: "+v.lat+"\nLongitude: "+v.lng),n.$apply()}),e.getPosition(g)}function g(e){v.lat=e.coords.latitude,v.lng=e.coords.longitude,p()}function p(){var e=new google.maps.LatLng(v.lat,v.lng);v.marker.setPosition(e),v.marker.setTitle("Latitude: "+v.lat+"\nLongitude: "+v.lng),v.map.setZoom(13),v.map.panTo(e),n.$apply()}function m(){l.getFileListDB().then(function(e){v.fileList=e.data,d()})}function d(){v.tableParams=new r({sorting:{lastModified:"desc"}},{dataset:v.fileList})}function f(e,t){l.deleteFileDB(t).then(function(a){h(e,t)})}function h(e,t){l.deleteFileS3({key:t}).then(function(t){c.success("File "+e+" deleted successfully","","Success"),m()})}var v=this;v.geocodeAddress=function(){(new google.maps.Geocoder).geocode({address:v.address},function(e,t){"OK"===t?(v.lat=e[0].geometry.location.lat(),v.lng=e[0].geometry.location.lng(),v.formattedAddress=e[0].formatted_address,v.marker.setPosition(e[0].geometry.location),v.marker.setTitle("Latitude: "+v.lat+"\nLongitude: "+v.lng),v.map.panTo(new google.maps.LatLng(v.lat,v.lng)),n.$apply()):"ZERO_RESULTS"===t?toastr.warning("Warning: Address not found","Warning",{positionClass:"toast-top-center"}):toastr.error("Geocode failed: "+t,"Error",{positionClass:"toast-top-center"})})},v.getFileListS3=function(){l.getFileListS3().then(function(e){doListFilesS3(e.data.Contents)},function(e){console.log(e)})},v.viewFile=function(e){l.signDownloadS3(e).then(function(e){a.open(e.data,"_blank")})},v.onFileSelect=function(e){if(e.length>0){var t=e[0].name,a=e[0].type,n={filename:t,type:a};l.signUploadS3(n).then(function(a){i.upload({method:"POST",url:a.data.url,fields:a.data.fields,file:e[0]}).progress(function(e){v.currentPercentage=parseInt(100*e.loaded/e.total)}).then(function(e){console.log(e.config.file.name+" successfully uploaded to S3"),$.parseXML(e.data);var n=v.tags.map(function(e){return e.text}),o=a.data.fields.key,i=a.data.url+"/"+o,r={name:t,key:o,size:e.config.file.size,url:i,createdBy:s.currentUser().name,lat:v.lat,lng:v.lng,tags:n};l.addFileDB(r).then(function(e){console.log(t+" successfully added to DB"),c.success(t+" successfully uploaded","","Success"),m()})},function(e){var t=$.parseXML(e.data);c.error($(t).find("Message").text(),"","Error")})})}},v.confirmDelete=function(e,t){a.confirm("Are you sure you want to delete "+e+"?")&&f(e,t)},v.popupFileDetails=function(e){o.open({templateUrl:"/pages/files/fileDetails/fileDetails.view.html",controller:"fileDetails as vm",size:"lg",resolve:{key:function(){return e}}}).result.then(function(){})},v.map=null,v.marker=null,v.fileList=[],v.lat=-34.4054039,v.lng=150.87842999999998,v.tags=[],v.address="",v.formattedAddress="",v.currentPercentage="0",u(),m()}angular.module("nativeQDAApp").controller("filesCtrl",e),e.$inject=["mapService","$http","$window","$scope","$uibModal","Upload","NgTableParams","filesService","authentication","logger"]}(),function(){function e(e,t,a,n){function o(e,t){n.objectAclDB({key:e,acl:t}).then(function(e){i.resultButton="success",i.file.acl=t},function(e){i.resultButton="error"})}var i=this;i.updateAclS3=function(e,t){i.isSubmittingButton=!0,n.objectAclS3({key:e,acl:t}).then(function(a){o(e,t)},function(e){i.resAclBtn="error"})},i.isSubmittingButton=null,i.resultButton=null,i.makePublicOptions={buttonDefaultText:"Make Public",animationCompleteTime:1e3},i.makePrivateOptions={buttonDefaultText:"Make Private",animationCompleteTime:1e3},n.fileReadOneDB(a).then(function(e){i.file=e.data}),i.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}angular.module("nativeQDAApp").controller("fileDetails",e),e.$inject=["$uibModalInstance","$window","key","filesService"]}(),function(){angular.module("nativeQDAApp").controller("settingsCtrl",function(){this.pageHeader={title:"Settings",strapline:"change how things work"}})}();